if(typeof InkTool==="undefined"){var InkTool={};InkTool.InkFlags=(function(){return {InkTool:false,InkFep:false,InkPDF:false,InkCoach:false};})();}InkTool.InkFlags.InkTool=true;if(typeof InkTool==="undefined"){var InkTool={};InkTool.InkFlags=(function(){return {InkTool:false,InkFep:false,InkPDF:false};})();InkTool.InkFlags.InkTool=true;}if(!Date.now){Date.now=function now(){return new Date().getTime();};}if(typeof InkTool.InkLib==="undefined"){InkTool.InkLib=(function(){var _1=document;var _2=function(){};var _3={log:function(){},debug:function(){},dummy:function(){}};var _4=null;var _5={};return {Browser:(function(){var ua=navigator.userAgent.toLowerCase();return {IE:ua.indexOf("msie")>-1,IE11:ua.indexOf("trident/7")>-1,Edge:ua.indexOf("edge")>-1,Opera:ua.indexOf("opera")>-1||ua.indexOf("opr")>-1,WebKit:ua.indexOf("applewebkit/")>-1,Gecko:ua.indexOf("gecko")>-1&&ua.indexOf("khtml")===-1,MobileSafari:/apple.*mobile/.test(ua),Chrome:ua.indexOf("chrome")>-1,Firefox:ua.indexOf("firefox")>-1,Safari:ua.indexOf("safari")>-1&&ua.indexOf("chrome")===-1&&ua.indexOf("mobile")===-1};})(),BrowserVersion:(function(){var av=navigator.appVersion.toLowerCase();return {IE:(function(){var _6=av.indexOf("msie ");if(_6<0){return 0;}_6+=5;var _7=av.indexOf(".",_6);if(_7<0){return 0;}return parseInt(av.substring(_6,_7),10);})(),Others:0};})(),Platform:(function(){return window.navigator.platform;})(),SupportsTouches:(("createTouch" in document)||("ontouchstart" in document)),EventHandlerCounter:0,EventHandlers:{},Class:(function(){function _8(){};function _9(_a,_b){if(_a==null){_a=InkTool.Base;}function _c(){this.initialize.apply(this,arguments);};if(_a!=null){_8.prototype=_a.prototype;_c.prototype=new _8;_a.subclasses.push(_c);}for(var _d in _b){_c.prototype[_d]=_b[_d];}_c.superclass=_a;_c.subclasses=[];_c.prototype.constructor=_c;return _c;};function _e(_f,_10){for(var _11 in _10){_f.prototype[_11]=_10[_11];}return _f;};function _12(_13){var _14=new Object();for(var _15 in _13){if(typeof _13[_15].clone=="function"){_14[_15]=_13[_15].clone();}else{_14[_15]=_13[_15];}}return _14;};return {create:_9,extend:_e,clone:_12};})(),Debug:{level:0,console:_3,alert:_2,info:{}},setDebugLevel:function(_16){var _17=InkTool.InkLib.Debug;_17.level=_16;if(_16>0){_17.console=(typeof window.console!=="undefined")?window.console:_3;_17.alert=function(){window.alert.apply(window,arguments);};}else{_17.console=_3;_17.alert=_2;}},getDebugLevel:function(){return InkTool.InkLib.Debug.level;},setDebugInfo:function(key,val){var _18=InkTool.InkLib.Debug;_18.info[key]=val;},getDebugInfo:function(key,_19){var _1a=InkTool.InkLib.Debug;var _1b=_1a.info[key];if(_1b===null||_1b===undefined){return _19;}else{return _1b;}},addDebugInfo:function(key,_1c,_1d){var _1e=InkTool.InkLib.getDebugInfo(key,_1c);var val=0+_1e+_1d;InkTool.InkLib.setDebugInfo(key,val);},StartTime:(function(){return Date.now();})(),getPerformance:function(){if(!window.performance||!performance.now){return Date.now();}else{var _1f=performance.now();return InkTool.InkLib.StartTime+_1f;}},needsEmulateCanvas:function(){return (InkTool.InkLib.Browser.IE&&InkTool.InkLib.BrowserVersion.IE<=8);},getBrowserTypeName:function(){var _20=InkTool.InkLib.Browser;var _21=InkTool.InkLib.BrowserVersion;if(_20.IE){return "IE"+_21.IE;}else{if(_20.IE11){return "IE11";}else{if(_20.Edge){return "Edge";}else{if(_20.Firefox){return "Firefox";}else{if(_20.Opera){return "Opera";}else{if(_20.Chrome){return "Chorme";}else{if(_20.Safari){return "Safari";}else{if(_20.MobileSafari){return "MobileSafari";}else{if(_20.Gecko){return "Gecko";}else{if(_20.Webkit){return "Webkit";}else{return "Unknown Browser";}}}}}}}}}}},deepCopy:function(_22){var _23=InkTool.InkLib;var _24;if(_23.typeis("Object",_22)){_24={};for(var key in _22){_24[key]=_23.deepCopy(_22[key]);}}else{if(_23.typeis("Array",_22)){_24=[];for(var idx=0;idx<_22.length;idx++){_24[idx]=_23.deepCopy(_22[idx]);}}else{_24=_22;}}return _24;},typeis:function(_25,obj){var _26=Object.prototype.toString.call(obj).slice(8,-1);return (obj!==undefined&&obj!==null&&_26===_25);},deepEquals:function(_27,_28){var _29=InkTool.InkLib;if(_29.typeis("Object",_28)){if(_29.typeis("Object",_27)==false){return false;}for(var key in _28){if(_29.deepEquals(_27[key],_28[key])==false){return false;}}}else{if(_29.typeis("Array",_28)){if(_29.typeis("Array",_27)==false){return false;}if(_27.length!=_28.length){return false;}for(var idx=0;idx<_28.length;idx++){if(_29.deepEquals(_27[idx],_28[idx])==false){return false;}}}else{if(_27!=_28){return false;}}}return true;},isNaN:function(obj){if(Number.isNaN){return Number.isNaN(obj);}else{return (typeof obj==="number"&&isNaN(obj));}},parseNumber:function(obj){if(typeof obj==="number"){return obj;}else{if(typeof obj==="string"){if(obj.length==0){return Number.NaN;}else{return Number(obj);}}else{return Number.NaN;}}},getObjectKeyLength:function(obj){var _2a=InkTool.InkLib;if(_2a.typeis("Object",obj)==false){return 0;}else{if(_2a.typeis("Function",Object.keys)==true){return Object.keys(obj).length;}else{var num=0;for(var key in obj){num++;}return num;}}},getObjectKeys:function(obj){var _2b=InkTool.InkLib;if(_2b.typeis("Object",obj)==false){return [];}else{if(_2b.typeis("Function",Object.keys)==true){return Object.keys(obj);}else{var _2c=[];for(var key in obj){_2c.push(key);}return _2c;}}},setObjectProperty:function(obj,_2d,val){if(obj==null||_2d==null){return false;}var _2e=InkTool.InkLib;var _2f=_2d.split(".");if(_2f.length==0){return false;}var _30=obj;for(var ct=0;ct<_2f.length;ct++){var _31=_2e.getObjectKeys(_30);var _32=false;for(var pct=0;pct<_31.length;pct++){if(_2f[ct]==_31[pct]){_32=true;break;}}if(!_32){return false;}if(ct==_2f.length-1){_30[_2f[ct]]=val;}else{_30=_30[_2f[ct]];}}return true;},getObjectProperty:function(obj,_33,_34){if(obj==null||_33==null){return _34;}var _35=InkTool.InkLib;var _36=_33.split(".");if(_36.length==0){return _34;}var _37=obj;var _38=_34;for(var ct=0;ct<_36.length;ct++){var _39=_35.getObjectKeys(_37);var _3a=false;for(var pct=0;pct<_39.length;pct++){if(_36[ct]==_39[pct]){_3a=true;break;}}if(!_3a){return _34;}if(ct==_36.length-1){_38=_37[_36[ct]];}else{_37=_37[_36[ct]];}}return _38;},getElementById:function(id){if(id===undefined||id===null||id===""){return null;}else{if(_1.getElementById){return _1.getElementById(id);}else{if(_1.all){return _1.all(id);}else{if(_1.layers){return _1.layers[id];}else{return null;}}}}},camelizeString:function(str){var _3b=str.split("-");if(_3b.length==1){return _3b[0];}var _3c=(str.indexOf("-")==0)?_3b[0].charAt(0).toUpperCase()+_3b[0].substring(1):_3b[0];for(var i=1,len=_3b.length;i<len;i++){var s=_3b[i];_3c+=s.charAt(0).toUpperCase()+s.substring(1);}return _3c;},trimString:function(str){var _3d,ch,_3e;_3e=-1;for(_3d=0;_3d<str.length;_3d++){ch=str.charAt(_3d);if(ch!=" "){_3e=_3d;}}return str.substring(0,_3e+1);},trimWhiteSpace:function(str){var _3f,ch,_40,_41;_40=-1;_41=-1;for(_3f=0;_3f<str.length;_3f++){ch=str.charAt(_3f);if(ch!=" "&&ch!="\t"&&ch!="\r"&&ch!="\n"){if(_40<0){_40=_3f;}_41=_3f;}}return str.substring(_40,_41+1);},diffString:function(_42,_43,max){var _44=InkTool.InkLib.doDiffString(_42,_43,max);if(_44==null){return null;}else{return _44.best.map;}},doDiffString:function(_45,_46,max){if(_45==null||_46==null){return null;}if(max===undefined||max===null){max=0;}var _47={best:{score:-1,map:[]},crnt:{score:-1,map:[]},sflag:[],count:0,cut:0,max:max};var _48=_46.length;var _49=_45.length;_47.best.score=_49*5;_47.crnt.score=0;for(var idx=0;idx<_49;idx++){_47.best.map.push(-1);_47.crnt.map.push(-1);}for(var idx=0;idx<_48;idx++){_47.sflag.push(-1);}InkTool.InkLib.rcDiffString(_47,_45,_46,0);return _47;},rcDiffString:function(_4a,_4b,_4c,_4d){if(_4a.max>0&&_4a.count>=_4a.max){return;}if(_4d==_4b.length){if(_4a.crnt.score<_4a.best.score){_4a.best.score=_4a.crnt.score;for(var idx=0;idx<_4a.crnt.map.length;idx++){_4a.best.map[idx]=_4a.crnt.map[idx];}}return;}var obj=_4b.substring(_4d,_4d+1);var _4e=false;var _4f=false;for(var idx=0;idx<_4c.length;idx++){var src=_4c.substring(idx,idx+1);if(_4a.sflag[idx]>=0){if(obj!=src){continue;}var _50=_4a.sflag[idx];var _51=_4a.crnt.map[_50];var _52=(_50==0)?-1:_4a.crnt.map[_50-1];var _53=_4a.crnt.map[_50+1];var _54=0;if(_52+1!=_51){_54++;}if(_51+1!=_53){_54++;}if(_54<2){continue;}var _55=(_4d==0)?-1:_4a.crnt.map[_4d-1];var _56=-1;if(_4d<_4b.length-1){var _57=_4b.substring(_4d+1,_4d+2);if(idx<_4c.length-1){var _58=_4c.substring(idx+1,idx+2);if(_57==_58&&_4a.sflag[idx+1]<0){_56=idx+1;}}}if(_55+1!=idx&&idx+1!=_56){continue;}var _59=idx;var _5a=(_55+1==idx)?1:2;if(_4a.crnt.score+_5a>_4a.best.score){_4a.cut++;continue;}_4a.count++;_4a.crnt.map[_50]=-1;_4a.crnt.map[_4d]=idx;_4a.crnt.score+=_5a;_4a.sflag[_59]=_4d;InkTool.InkLib.rcDiffString(_4a,_4b,_4c,_4d+1);_4a.sflag[_59]=_50;_4a.crnt.score-=_5a;_4a.crnt.map[_4d]=-1;_4a.crnt.map[_50]=_51;_4f=true;}else{if(obj==src){var _59=idx;var _55=(_4d==0)?-1:_4a.crnt.map[_4d-1];var _5a=(idx==_55+1)?0:1;if(_4a.crnt.score+_5a>_4a.best.score){_4a.cut++;continue;}_4a.count++;_4a.crnt.map[_4d]=_59;_4a.crnt.score+=_5a;_4a.sflag[_59]=_4d;InkTool.InkLib.rcDiffString(_4a,_4b,_4c,_4d+1);_4a.sflag[_59]=-1;_4a.crnt.score-=_5a;_4a.crnt.map[_4d]=-1;_4f=true;}else{_4e=true;}}}if(_4e==true||_4f==false){if(_4f==true){var _5b=false;for(var idx=_4d+1;idx<_4b.length;idx++){var _5c=_4b.substring(idx,idx+1);if(obj==_5c){_5b=true;break;}}if(_5b==false){return;}}var _59=-1;var _5a=2;if(_4a.crnt.score+_5a>_4a.best.score){_4a.cut++;return;}_4a.count++;_4a.crnt.map[_4d]=_59;_4a.crnt.score+=_5a;InkTool.InkLib.rcDiffString(_4a,_4b,_4c,_4d+1);_4a.crnt.score-=_5a;_4a.crnt.map[_4d]=-1;}},stringToUtf8Bytes:function(_5d){var _5e=[];if(_5d==null){return _5e;}for(var i=0;i<_5d.length;i++){var c=_5d.charCodeAt(i);if(c<=127){_5e.push(c);}else{if(c<=2047){_5e.push(((c>>6)&31)|192);_5e.push((c&63)|128);}else{_5e.push(((c>>12)&15)|224);_5e.push(((c>>6)&63)|128);_5e.push((c&63)|128);}}}return _5e;},utf8BytesToString:function(arr){if(arr==null){return null;}var _5f="";var i;while(i=arr.shift()){if(i<=127){_5f+=String.fromCharCode(i);}else{if(i<=223){var c=((i&31)<<6);c+=arr.shift()&63;_5f+=String.fromCharCode(c);}else{if(i<=224){var c=((arr.shift()&31)<<6)|2048;c+=arr.shift()&63;_5f+=String.fromCharCode(c);}else{var c=((i&15)<<12);c+=(arr.shift()&63)<<6;c+=arr.shift()&63;_5f+=String.fromCharCode(c);}}}}return _5f;},getLengthOfCode:function(_60){var str=""+_60;var len=0;for(var idx=0;idx<str.length;idx++){var ch=str.charAt(idx);if(ch!=" "&&ch!="\r"&&ch!="\n"&&ch!="\t"){len++;}}return len;},getNameOfFunction:function(_61){var str=""+_61;var end=str.length;for(var idx=0;idx<str.length;idx++){var ch=str.charAt(idx);if(ch==" "||ch=="("||ch==":"||ch=="\r"||ch=="\n"||ch=="\t"){end=idx;break;}}return str;},getStyleOfElement:function(_62,_63,_64){if(_62.currentStyle){return _62.currentStyle[InkTool.InkLib.camelizeString(_63)];}else{if(getComputedStyle){return getComputedStyle(_62,"").getPropertyValue(_63);}else{if(_1.defaultView){return _1.defaultView.getComputedStyle(_62,"").getPropertyValue(_63);}else{return _64;}}}},getStyleById:function(id,_65,_66){var _67=InkTool.InkLib.getElementById(id);if(_67==null){return _66;}else{return InkTool.InkLib.getStyleOfElement(_67,_65,_66);}},getScrollX:function(){if(_1.scrollingElement){return _1.scrollingElement.scrollLeft;}else{if(window.scrollX){return window.scrollX;}else{if(window.pageXOffset){return window.pageXOffset;}else{if(_1.documentElement&&_1.documentElement.scrollLeft){return _1.documentElement.scrollLeft;}else{if(_1.body&&_1.body.scrollLeft){return _1.body.scrollLeft;}else{if(_1.html&&_1.html.scrollLeft){return _1.html.scrollLeft;}else{return 0;}}}}}}},getScrollY:function(){if(_1.scrollingElement){return _1.scrollingElement.scrollTop;}else{if(window.scrollY){return window.scrollY;}else{if(window.pageYOffset){return window.pageYOffset;}else{if(_1.documentElement&&_1.documentElement.scrollTop){return _1.documentElement.scrollTop;}else{if(_1.body&&_1.body.scrollTop){return _1.body.scrollTop;}else{if(_1.html&&_1.html.scrollTop){return _1.html.scrollTop;}else{return 0;}}}}}}},getClientX:function(){if(_1.documentElement&&_1.documentElement.clientLeft){return _1.documentElement.clientLeft;}else{if(_1.body&&_1.body.clientLeft){return _1.body.clientLeft;}else{return 0;}}},getClientY:function(){if(_1.documentElement&&_1.documentElement.clientTop){return _1.documentElement.clientTop;}else{if(_1.body&&_1.body.clientTop){return _1.body.clientTop;}else{return 0;}}},getOffsetX:function(_68){if(typeof window.crypto!="undefined"&&typeof window.getComputedStyle!="undefined"&&obj.style.left){return InkTool.InkLib.getClientX()+parseInt(_68.style.left);}else{return InkTool.InkLib.getClientX()+(_1.layers?_68.left:(_68.offsetLeft||_68.style.pixelLeft||0));}},getOffsetY:function(_69){if(typeof window.crypto!="undefined"&&typeof window.getComputedStyle!="undefined"&&obj.style.top){return InkTool.InkLib.getClientY()+parseInt(_69.style.top);}else{return InkTool.InkLib.getClientY()+(_1.layers?_69.top:(_69.offsetTop||_69.style.pixelTop||0));}},getEventX:function(_6a,_6b){sx=InkTool.InkLib.getScrollX();if(_6b!=null){ox=InkTool.InkLib.getOffsetX(_6b);}else{ox=0;}return _6a.clientX-ox+sx;},getEventY:function(_6c,_6d){sy=InkTool.InkLib.getScrollY();if(_6d!=null){oy=InkTool.InkLib.getOffsetY(_6d);}else{oy=0;}return _6c.clientY-oy+sy;},getClientWidth:function(){if(_1.documentElement.clientWidth){return _1.documentElement.clientWidth;}else{if(_1.body.clientWidth){return _1.body.clientWidth;}else{return window.innerWidth;}}},getClientHeight:function(){if(_1.documentElement.clientHeight){return _1.documentElement.clientHeight;}else{if(_1.body.clientHeight){return _1.body.clientHeight;}else{return window.innerHeight;}}},getPageWidth:function(){var _6e=InkTool.InkLib;var max=null;max=_6e.max(max,document.body.clientWidth);max=_6e.max(max,document.body.scrollWidth);max=_6e.max(max,document.documentElement.clientWidth);max=_6e.max(max,document.documentElement.scrollWidth);return max;},getPageHeight:function(){var _6f=InkTool.InkLib;var max=null;max=_6f.max(max,document.body.clientHeight);max=_6f.max(max,document.body.scrollHeight);max=_6f.max(max,document.documentElement.clientHeight);max=_6f.max(max,document.documentElement.scrollHeight);return max;},getElementSize:function(_70){if(_70==null){return {width:InkTool.InkLib.getClientWidth(),height:InkTool.InkLib.getClientHeight()};}if(InkTool.InkLib.getStyleOfElement(_70,"display","")!="none"){return {width:_70.offsetWidth,height:_70.offsetHeight};}var _71=_70.style.visibility;var _72=_70.style.position;_70.style.visibility="hidden";_70.style.position="absolute";_70.style.display="";var _73=_70.clientWidth;var _74=_70.clientHeight;_70.style.display="none";_70.style.position=_72;_70.style.visibility=_71;return {width:_73,height:_74};},getElementLocationOld:function(_75){var _76=InkTool.InkLib;var _77=_75;var xp=0;var yp=0;while(_77){xp+=_77.offsetLeft;yp+=_77.offsetTop;_77=_77.offsetParent;if(_77==null){break;}var pos=_76.getStyleOfElement(_77,"position","");if(_76.Browser.IE){if(pos!="absolute"&&pos!="fixed"){xp+=(parseInt(_76.getStyleOfElement(_77,"border-left-width","0"))||0);yp+=(parseInt(_76.getStyleOfElement(_77,"border-top-width","0"))||0);}else{if(_76.BrowserVersion.IE>=9){xp+=(parseInt(_76.getStyleOfElement(_77,"border-left-width","0"))||0);yp+=(parseInt(_76.getStyleOfElement(_77,"border-top-width","0"))||0);}if(pos=="fixed"){var _78=_76.getScrollX();var _79=_76.getScrollY();xp+=_78;yp+=_79;}}}else{if(pos=="absolute"||pos=="fixed"){xp+=(parseInt(_76.getStyleOfElement(_77,"border-left-width","0"))||0);yp+=(parseInt(_76.getStyleOfElement(_77,"border-top-width","0"))||0);if(pos=="fixed"){var _78=_76.getScrollX();var _79=_76.getScrollY();xp+=_78;yp+=_79;}}}}if(_76.Browser.Gecko){var bd=_1.getElementsByTagName("BODY")[0];xp+=2*(parseInt(_76.getStyleOfElement(bd,"border-left-width","0"))||0);yp+=2*(parseInt(_76.getStyleOfElement(bd,"border-top-width","0"))||0);}return {left:xp,top:yp};},getElementLocation:function(_7a){var _7b=InkTool.InkLib;var _7c=_7a;if(_7c.getBoundingClientRect){var _7d=_7c.getBoundingClientRect();var _7e=_7b.getScrollX();var _7f=_7b.getScrollY();return {left:Math.round(_7e+_7d.left),top:Math.round(_7f+_7d.top)};}var xp=0;var yp=0;while(_7c){xp+=_7c.offsetLeft;yp+=_7c.offsetTop;_7c=_7c.offsetParent;if(_7c==null){break;}var pos=_7b.getStyleOfElement(_7c,"position","");if(_7b.Browser.IE){if(pos!="absolute"&&pos!="fixed"){xp+=(parseInt(_7b.getStyleOfElement(_7c,"border-left-width","0"))||0);yp+=(parseInt(_7b.getStyleOfElement(_7c,"border-top-width","0"))||0);}else{if(_7b.BrowserVersion.IE>=9){xp+=(parseInt(_7b.getStyleOfElement(_7c,"border-left-width","0"))||0);yp+=(parseInt(_7b.getStyleOfElement(_7c,"border-top-width","0"))||0);}if(pos=="fixed"){var _7e=_7b.getScrollX();var _7f=_7b.getScrollY();xp+=_7e;yp+=_7f;}}}else{if(pos=="absolute"||pos=="fixed"){xp+=(parseInt(_7b.getStyleOfElement(_7c,"border-left-width","0"))||0);yp+=(parseInt(_7b.getStyleOfElement(_7c,"border-top-width","0"))||0);if(pos=="fixed"){var _7e=_7b.getScrollX();var _7f=_7b.getScrollY();xp+=_7e;yp+=_7f;}}}}if(_7b.Browser.Gecko){var bd=_1.getElementsByTagName("BODY")[0];xp+=2*(parseInt(_7b.getStyleOfElement(bd,"border-left-width","0"))||0);yp+=2*(parseInt(_7b.getStyleOfElement(bd,"border-top-width","0"))||0);}return {left:xp,top:yp};},getElementLocationWithoutScroll:function(_80){var _81=InkTool.InkLib;var _82=_80;var _83=_81.Browser;if(_82.getBoundingClientRect&&(_83.IE||_83.IE11)){return _81.getElementLocationOld(_80);}else{return _81.getElementLocation(_80);}},getElementAbsoluteLocation:function(_84){var _85=_84;var xp=0;var yp=0;while(_85){xp+=_85.offsetLeft;yp+=_85.offsetTop;_85=_85.offsetParent;if(_85==null){break;}var pos=InkTool.InkLib.getStyleOfElement(_85,"position","");if(pos!=""&&pos!="static"){if(InkTool.InkLib.Browser.IE&&InkTool.InkLib.BrowserVersion.IE<9){xp-=(parseInt(InkTool.InkLib.getStyleOfElement(_85,"border-left-width","0"))||0);yp-=(parseInt(InkTool.InkLib.getStyleOfElement(_85,"border-top-width","0"))||0);}break;}if(InkTool.InkLib.Browser.IE){xp+=(parseInt(InkTool.InkLib.getStyleOfElement(_85,"border-left-width","0"))||0);yp+=(parseInt(InkTool.InkLib.getStyleOfElement(_85,"border-top-width","0"))||0);}}if(InkTool.InkLib.Browser.Gecko&&(_85==null)){var bd=_1.getElementsByTagName("BODY")[0];xp+=2*(parseInt(InkTool.InkLib.getStyleOfElement(bd,"border-left-width","0"))||0);yp+=2*(parseInt(InkTool.InkLib.getStyleOfElement(bd,"border-top-width","0"))||0);}return {left:xp,top:yp};},getElementOfEventPosition:function(evt){var _86;if(evt.target){_86=evt.target;}else{if(window.navigator.pointerEnabled||window.navigator.msPointerEnabled){var xp=evt.clientX;var yp=evt.clientY;_86=document.elementFromPoint(xp,yp);}else{var _87=InkTool.InkLib.getEventPosition(evt);var _88=InkTool.InkLib.convertPositionEventToAbsolute(_87);_86=document.elementFromPoint(_88.left,_88.top);}}return _86;},getElementIdOfEventPosition:function(evt){var _89;if(evt.target){return evt.target.id;}else{if(window.navigator.pointerEnabled||window.navigator.msPointerEnabled){var xp=evt.clientX;var yp=evt.clientY;_89=document.elementFromPoint(xp,yp);}else{var _8a=InkTool.InkLib.getEventPosition(evt);var _8b=InkTool.InkLib.convertPositionEventToAbsolute(_8a);_89=document.elementFromPoint(_8b.left,_8b.top);}}return _89?_89.id:"";},getElementOfTouchEventPosition:function(evt,_8c){if(evt.touches&&_8c>=0&&_8c<evt.touches.length){return InkTool.InkLib.getElementOfEventPosition(evt.touches[_8c]);}else{return null;}},getElementIdOfTouchEventPosition:function(evt,_8d){if(evt.touches&&_8d>=0&&_8d<evt.touches.length){return InkTool.InkLib.getElementIdOfEventPosition(evt.touches[_8d]);}else{return "";}},isElementFixed:function(_8e){var _8f=_8e;while(_8f){var pos=InkTool.InkLib.getStyleOfElement(_8f,"position","");if(pos=="fixed"){return true;}else{if(pos=="absolute"){return false;}}_8f=_8f.offsetParent;}return false;},addElementAfter:function(_90,_91){if(_90.nextSibling){_90.parentNode.insertBefore(_91,_90.nextSibling);}else{_90.parentNode.appendChild(_91);}},getMaxZIndex:function(){var _92=0;var _93=document.defaultView;var _94=function(_95){var _96=document.getElementsByTagName(_95);for(var _97=0;_97<_96.length;_97++){var _98=_96[_97];var _99=InkTool.InkLib.getStyleOfElement(_98,"z-index","0");_99-=0;if(_92<_99){_92=_99;}}};if(arguments.length==0){_94("*");}else{for(var ct=0;ct<arguments.length;ct++){_94(arguments[ct]);}}return _92;},showElement:function(_9a){if(_9a!=null){_9a.style.visibility="visible";}},hideElement:function(_9b){if(_9b!=null){_9b.style.visibility="hidden";}},showElementById:function(id){InkTool.InkLib.showElement(InkTool.InkLib.getElementById(id));},hideElementById:function(id){InkTool.InkLib.hideElement(InkTool.InkLib.getElementById(id));},showPopup:function(_9c,_9d){InkTool.InkLib.showPopupBottom(_9c,_9d);},showPopupById:function(_9e,_9f){var _a0=InkTool.InkLib.getElementById(_9e);var _a1=InkTool.InkLib.getElementById(_9f);InkTool.InkLib.showPopup(_a0,_a1);},showPopupBottom:function(_a2,_a3){if(_a2==null||_a3==null){return;}var _a4=InkTool.InkLib;var pos=_a4.getElementLocationWithoutScroll(_a2);var _a5=_a4.getElementSize(_a2);var _a6;if(_a4.isElementFixed(_a2)==true){_a6="fixed";}else{_a6="absolute";}var xp=pos.left;var yp=pos.top+_a5.height;var _a7=_a4.getElementSize(_a3);var _a8=_a4.getScrollX();var _a9=_a4.getScrollY();var _aa=_a4.getClientWidth();if(xp+_a7.width>_a8+_aa){xp=_a8+_aa-_a7.width;if(xp<_a8){xp=_a8;}}if(_a6=="fixed"){xp-=_a8;yp-=_a9;}_a3.style.position=_a6;_a3.style.left=""+xp+"px";_a3.style.top=""+yp+"px";_a4.showElement(_a3);},showPopupBottomById:function(_ab,_ac){var _ad=InkTool.InkLib;var _ae=_ad.getElementById(_ab);var _af=_ad.getElementById(_ac);_ad.showPopupBottom(_ae,_af);},showPopupTop:function(_b0,_b1){if(_b0==null||_b1==null){return;}var _b2=InkTool.InkLib;var pos=_b2.getElementLocationWithoutScroll(_b0);var _b3=_b2.getElementSize(_b1);var _b4;if(_b2.isElementFixed(_b0)==true){_b4="fixed";}else{_b4="absolute";}var xp=pos.left;var yp=pos.top-_b3.height;var _b5=_b2.getClientWidth();var _b6=_b2.getScrollX();var _b7=_b2.getScrollY();if(xp+_b3.width>_b6+_b5){xp=_b6+_b5-_b3.width;if(xp<_b6){xp=_b6;}}if(_b4=="fixed"){xp-=_b6;yp-=_b7;}_b1.style.position=_b4;_b1.style.left=""+xp+"px";_b1.style.top=""+yp+"px";_b2.showElement(_b1);},showPopupTopById:function(_b8,_b9){var _ba=InkTool.InkLib;var _bb=_ba.getElementById(_b8);var _bc=_ba.getElementById(_b9);_ba.showPopupTop(_bb,_bc);},showPopupAuto:function(_bd,_be){if(_bd==null||_be==null){return;}var _bf=InkTool.InkLib;var pos=_bf.getElementLocationWithoutScroll(_bd);var _c0=_bf.getElementSize(_bd);var _c1=_bf.getElementSize(_be);var _c2;if(_bf.isElementFixed(_bd)==true){_c2="fixed";}else{_c2="absolute";}var _c3=_bf.getScrollX();var _c4=_bf.getScrollY();var _c5=_bf.getClientWidth();var _c6=_bf.getClientHeight();var _c7=_bf.getPageWidth();var _c8=_bf.getPageHeight();var xp=pos.left;var yp;var _c9=pos.top+_c0.height;var _ca=pos.top-_c1.height;var _cb=0;if(_c9>=0&&_c9+_c1.height<_c8){_cb=1;}if(_c9>=_c4&&_c9+_c1.height<_c4+_c6){_cb=2;}var _cc=0;if(_ca>=0&&_ca+_c1.height<_c8){_cc=1;}if(_ca>=_c4&&_ca+_c1.height<_c4+_c6){_cc=2;}if(_cb>=_cc){yp=_c9;}else{yp=_ca;}if(xp+_c1.width>_c3+_c5){xp=_c3+_c5-_c1.width;if(xp<_c3){xp=_c3;}}if(_c2=="fixed"){xp-=_c3;yp-=_c4;}_be.style.position=_c2;_be.style.left=""+xp+"px";_be.style.top=""+yp+"px";_bf.showElement(_be);},showPopupAutoById:function(_cd,_ce){var _cf=InkTool.InkLib;var _d0=_cf.getElementById(_cd);var _d1=_cf.getElementById(_ce);_cf.showPopupAuto(_d0,_d1);},showPopupCenter:function(_d2,_d3,_d4){if(_d2==null){return;}var _d5=InkTool.InkLib;var _d6=_d5.getStyleOfElement(_d2,"position","");var _d7=_d5.getElementSize(_d2);var _d8=_d5.getScrollX();var _d9=_d5.getScrollY();var _da=_d5.getClientWidth();var _db=_d5.getClientHeight();var _dc=_d5.getPageWidth();var _dd=_d5.getPageHeight();if(_d3==true){if(_d6=="absolute"){var xp=(_dc-_d7.width)/2;_d2.style.left=""+xp+"px";}else{if(_d6=="fixed"){var xp=(_da-_d7.width)/2;_d2.style.left=""+xp+"px";}}}if(_d4==true){if(_d6=="absolute"){var yp=(_dd-_d7.height)/2;_d2.style.top=""+yp+"px";}else{if(_d6=="fixed"){var yp=(_db-_d7.height)/2;_d2.style.top=""+yp+"px";}}}_d5.showElement(_d2);},showPopupCenterById:function(_de,_df,_e0){var _e1=InkTool.InkLib;var _e2=_e1.getElementById(_de);_e1.showPopupCenter(_e2,_df,_e0);},addEvent:function(_e3,_e4,fn){if(_e3==null){if(document.addEventListener){document.addEventListener(_e4,fn,false);return true;}else{if(document.attachEvent){return document.attachEvent("on"+_e4,fn);}else{return false;}}}else{if(_e3.addEventListener){_e3.addEventListener(_e4,function(){return fn.apply(_e3,arguments);},false);return true;}else{if(_e3.attachEvent){return _e3.attachEvent("on"+_e4,function(){return fn.apply(_e3,arguments);});}else{return false;}}}},addDynamicEvent:function(_e5,_e6,fn){var _e7;if(_e5==null){_e5=document;_e7={"elem":_e5,"event":_e6,"func":fn};}else{_e7={"elem":_e5,"event":_e6,"func":function(){return fn.apply(_e5,arguments);}};}InkTool.InkLib.EventHandlerCounter++;var hid=""+InkTool.InkLib.EventHandlerCounter;if(_e5.addEventListener){_e5.addEventListener(_e6,_e7.func,false);InkTool.InkLib.EventHandlers[hid]=_e7;return hid;}else{if(_e5.attachEvent){if(_e5.attachEvent("on"+_e6,_e7.func)==true){InkTool.InkLib.EventHandlers[hid]=_e7;return hid;}}}return null;},removeDynamicEvent:function(hid){var _e8=InkTool.InkLib.EventHandlers[hid];if(_e8==null){return false;}var _e9=_e8.elem;var _ea=_e8.event;var _eb=_e8.func;delete InkTool.InkLib.EventHandlers[hid];if(_e9.removeEventListener){_e9.removeEventListener(_ea,_eb,false);return true;}else{if(_e9.detachEvent){return _e9.detachEvent("on"+_ea,_eb);}else{return false;}}},contains:function(_ec,_ed){for(var i,len=_ec.length;i<len;i++){if(_ec[i]===_ed){return true;}}return false;},max:function(_ee,_ef){var _f0=(_ee===null||_ee===undefined||_ee===NaN);var _f1=(_ef===null||_ef===undefined||_ef===NaN);if(_f0&&_f1){return null;}else{if(_f0){return _ef;}else{if(_f1){return _ee;}else{if(_ee>=_ef){return _ee;}else{return _ef;}}}}},min:function(_f2,_f3){var _f4=(_f2===null||_f2===undefined||_f2===NaN);var _f5=(_f3===null||_f3===undefined||_f3===NaN);if(_f4&&_f5){return null;}else{if(_f4){return _f3;}else{if(_f5){return _f2;}else{if(_f2<=_f3){return _f2;}else{return _f3;}}}}},getLastEvent:function(evt){if(window.event){return window.event;}else{return evt;}},getEventPosition:function(evt){if(window.navigator.pointerEnabled||window.navigator.msPointerEnabled){return {left:(evt.clientX+InkTool.InkLib.getScrollX()),top:(evt.clientY+InkTool.InkLib.getScrollY())};}else{return {left:(evt.pageX?evt.pageX:evt.clientX+InkTool.InkLib.getScrollX()),top:(evt.pageY?evt.pageY:evt.clientY+InkTool.InkLib.getScrollY())};}},getEventPointerType:function(evt){var _f6=evt.pointerType;if(_f6){switch(_f6){case 2:case "touch":return "touch";case 3:case "pen":return "pen";case 4:case "mouse":return "mouse";default:return "unknown";}}else{return "notype";}},getEventPressure:function(evt){if(evt.pressure){return evt.pressure;}else{return 0;}},getTouchEventPositionsLength:function(evt){if(evt.touches){return evt.touches.length;}else{return 0;}},getTouchEventPosition:function(evt,_f7){if(evt.touches&&_f7>=0&&_f7<evt.touches.length){return InkTool.InkLib.getEventPosition(evt.touches[_f7]);}else{return null;}},getTouchEventId:function(evt,_f8){if(evt.touches&&_f8>=0&&_f8<evt.touches.length){return evt.touches[_f8].identifier;}else{return null;}},getTouchEventPressure:function(evt,_f9){if(evt.touches&&_f9>=0&&_f9<evt.touches.length){var _fa=evt.touches[_f9];if(_fa.force){return _fa.force;}else{if(_fa.webkitForce){return _fa.webkitForce;}else{return 0;}}}else{return 0;}},getTargetTouchEventPositionsLength:function(evt){if(evt.targetTouches){return evt.targetTouches.length;}else{return 0;}},getTargetTouchEventPosition:function(evt,_fb){if(evt.targetTouches&&_fb>=0&&_fb<evt.targetTouches.length){return InkTool.InkLib.getEventPosition(evt.targetTouches[_fb]);}else{return null;}},getTargetTouchEventId:function(evt,_fc){if(evt.targetTouches&&_fc>=0&&_fc<evt.targetTouches.length){return evt.targetTouches[_fc].identifier;}else{return null;}},getTargetTouchEventPressure:function(evt,_fd){if(evt.targetTouches&&_fd>=0&&_fd<evt.targetTouches.length){var _fe=evt.targetTouches[_fd];if(_fe.force){return _fe.force;}else{if(_fe.webkitForce){return _fe.webkitForce;}else{return 0;}}}else{return 0;}},getChangedTouchEventPositionsLength:function(evt){if(evt.changedTouches){return evt.changedTouches.length;}else{return 0;}},getChangedTouchEventPosition:function(evt,_ff){if(evt.changedTouches&&_ff>=0&&_ff<evt.changedTouches.length){return InkTool.InkLib.getEventPosition(evt.changedTouches[_ff]);}else{return null;}},getChangedTouchEventId:function(evt,_100){if(evt.changedTouches&&_100>=0&&_100<evt.changedTouches.length){return evt.changedTouches[_100].identifier;}else{return null;}},getChangedTouchEventPressure:function(evt,_101){if(evt.changedTouches&&_101>=0&&_101<evt.changedTouches.length){var _102=evt.changedTouches[_101];if(_102.force){return _102.force;}else{if(_102.webkitForce){return _102.webkitForce;}else{return 0;}}}else{return 0;}},getPointerEventId:function(evt){return evt.pointerId;},convertPositionDocumentToElement:function(pos,elem){var ipos=InkTool.InkLib.getElementLocation(elem);return {left:pos.left-ipos.left,top:pos.top-ipos.top};},convertPositionEventToAbsolute:function(pos){return {left:pos.left-InkTool.InkLib.getScrollX(),top:pos.top-InkTool.InkLib.getScrollY()};},getEventPositionOfElement:function(evt,elem){var epos=InkTool.InkLib.getEventPosition(evt);var ipos=InkTool.InkLib.getElementLocation(elem);return {left:epos.left-ipos.left,top:epos.top-ipos.top};},preventDefaultActionOfEvent:function(evt,_103,_104){if(_103){if(evt.preventDefault){evt.preventDefault();}else{evt.returnValue=false;}}if(_104){if(InkTool.InkLib.Browser.IE){evt.cancelBubble=true;}else{evt.stopPropagation();}}},getButtonPushed:function(_105,code){var _106=InkTool.InkLib.Browser;if(_106.IE){var _107={0:1,1:4,2:2};return (_105.button===_107[code]);}else{if(_106.WebKit){switch(code){case 0:return _105.which==1&&!_105.metaKey;case 1:return _105.which==2||(_105.which==1&&_105.metaKey);case 2:return _105.which==3;default:return false;}}else{return _105.which?(_105.which===code+1):(_105.button===code);}}},getButtonStatus:function(_108){if(InkTool.InkLib.getButtonPushed(_108,0)){return 1;}else{if(InkTool.InkLib.getButtonPushed(_108,1)){return 2;}else{if(InkTool.InkLib.getButtonPushed(_108,2)){return 3;}else{return 0;}}}},preLoadImage:function(file){var img=new Image();img.src=file+"?"+Date.now();return img;},setSelectionToElement:function(elem,_109,end){if(elem.setSelectionRange){elem.setSelectionRange(_109,end);}else{var _10a=-(elem.value.length-end);var _10b=elem.createTextRange();_10b.moveStart("character",_109);_10b.moveEnd("character",_10a);_10b.select();}},selectAllOfElement:function(elem){InkTool.InkLib.setSelectionToElement(elem,0,elem.value.length);},insertTextToElement:function(elem,text){elem.focus();if((elem.selectionStart||elem.selectionStart==0)&&(elem.selectionEnd||elem.selectionEnd==0)){var _10c=elem.value;elem.value=_10c.substring(0,elem.selectionStart)+text+_10c.substring(elem.selectionEnd,_10c.length);}else{var _10d=_1.selection.createRange();_10d.text=text;}},disableSelection:function(elem){if(typeof elem.onselectstart!="undefined"){elem.onselectstart=function(){return false;};}else{if(typeof elem.style.MozUserSelect!="undefined"){elem.style.MozUserSelect="none";}else{elem.onmousedown=function(){return false;};}}elem.style.cursor="default";},setCookie:function(_10e,_10f){for(var key in _10e){var str=""+key+"="+encodeURIComponent(_10e[key]);if(_10f!=null&&_10f!=undefined){var _110=new Date();_110.setTime(_110.getTime()+_10f);str+=" ;expires="+_110.toUTCString();}document.cookie=str;}},getCookie:function(){var _111=new Object();var _112=document.cookie;if(_112!=""){var _113=_112.split(";");for(var _114=0;_114<_113.length;_114++){var _115=_113[_114].split("=");var key=InkTool.InkLib.trimWhiteSpace(_115[0]);var val=InkTool.InkLib.trimWhiteSpace(decodeURIComponent(_115[1]));_111[key]=val;}}return _111;},getCookieValue:function(_116,key,_117){if(_116==null){return _117;}var resp=_116[key];if(resp!=null&&resp!=undefined){if(typeof (_117)=="number"){return Number(resp);}else{if(typeof (_117)=="boolean"){if(resp=="false"){return false;}else{return Boolean(resp);}}else{return resp;}}}else{return _117;}},setReceiving:function(_118){_4=_118;},setFetch:function(info){_5=info;},getFetch:function(){return _5;},sendString:function(str,url,_119,_11a,_11b){return InkTool.InkLib.sendStringWithHeaders(null,str,url,_119,_11a,_11b);},sendStringWithHeaders:function(_11c,str,url,_11d,_11e,_11f){var _120=InkTool.InkLib.getXmlHttpObject();var _121={"httpobj":_120,"url":url,"trynum":_11d,"tried":0,"interval":_11e,"canceled":false,"error":false,"inside":false};_120.onreadystatechange=function(){if(_4!=null){_4(_121,_120,true);}if(_120.readyState==4){if(_120.status==200){_121.tried++;_121.error=false;if(typeof (_11f)==="function"){_11f(_121,_120.responseText);}else{alert("resp="+_120.responseText);}}else{_121.tried++;_121.error=true;if(typeof (_11f)==="function"){_11f(_121,_120.responseText);}else{alert("status error:"+_120.status+":resp="+_120.responseText);}if(_121.canceled!=true&&(_121.trynum<=0||_121.tried<_121.trynum)){setTimeout(function(){try{_120.open("POST",url,true);if(_11c==null){_120.setRequestHeader("CONTENT-TYPE","application/x-www-form-urlencoded");}else{for(var name in _11c){_120.setRequestHeader(name,_11c[name]);}}_120.send(str);}catch(e){alert("http send error:"+e);_121.error=true;}},_121.interval);}}}if(_4!=null){_4(_121,_120,false);}};try{_120.open("POST",url,true);if(_11c==null){_120.setRequestHeader("CONTENT-TYPE","application/x-www-form-urlencoded");}else{for(var name in _11c){_120.setRequestHeader(name,_11c[name]);}}_120.send(str);}catch(e){alert("http send error:"+e);_121.error=true;}return _121;},getObject:function(url,_122,_123,_124){return InkTool.InkLib.getObjectWithHeaders(null,url,_122,_123,_124);},getObjectWithHeaders:function(_125,url,_126,_127,_128){var _129=InkTool.InkLib.getXmlHttpObject();var _12a={"httpobj":_129,"url":url,"trynum":_126,"tried":0,"interval":_127,"canceled":false,"error":false};_129.onreadystatechange=function(){if(_4!=null){_4(_12a,_129,true);}if(_129.readyState==4){if(_129.status==200){_12a.tried++;_12a.error=false;if(typeof (_128)==="function"){_128(_12a,_129.responseText);}else{alert("resp="+_129.responseText);}}else{_12a.tried++;_12a.error=true;if(typeof (_128)==="function"){_128(_12a,_129.responseText);}else{alert("status error:"+_129.status+":resp="+_129.responseText);}if(_12a.canceled!=true&&(_12a.trynum<=0||_12a.tried<_12a.trynum)){setTimeout(function(){try{_129.open("GET",url,true);if(_125==null){}else{for(var name in _125){_129.setRequestHeader(name,_125[name]);}}_129.send();}catch(e){alert("http send error:"+e);_12a.error=true;}},_12a.interval);}}}if(_4!=null){_4(_12a,_129,false);}};try{_129.open("GET",url,true);if(_125==null){}else{for(var name in _125){_129.setRequestHeader(name,_125[name]);}}_129.send();}catch(e){alert("http send error:"+e);_12a.error=true;}return _12a;},sendToServer:function(url,_12b,_12c,_12d,_12e,str,_12f){if(_12d){if(_12e==null){return InkTool.InkLib.sendString(str,url,_12b,_12c,_12f);}else{return InkTool.InkLib.sendStringWithHeaders(_12e,str,url,_12b,_12c,_12f);}}else{if(_12e==null){return InkTool.InkLib.getObject(url,_12b,_12c,_12f);}else{return InkTool.InkLib.getObjectWithHeaders(_12e,url,_12b,_12c,_12f);}}},getXmlHttpObject:function(){var _130=null;try{_130=new XMLHttpRequest();}catch(e){try{_130=new ActiveXObject("Msxml2.XMLHTTP");}catch(e){_130=new ActiveXObject("Microsoft.XMLHTTP");}}return _130;},checkActiveX:function(_131){var _132;try{if(_131!=null&&_131!=""){_132=new ActiveXObject(_131);}else{_132=null;}}catch(e){_132=null;}var resp=(_132!=null);if(_132!=null){delete _132;_132=null;}return resp;},getAbsoluteURL:function(_133){var idx=_133.indexOf("://");if(idx>=0){return _133;}idx=_133.indexOf("/");if(idx==0){var _134=location.protocol;var host=location.host;return _134+"//"+host+_133;}else{var _135=location.href;idx=_135.lastIndexOf("/");if(idx<0){return _135+"/"+_133;}else{return _135.substring(0,idx+1)+_133;}}},dummyFunction:function(){}};})();}if(typeof InkTool.Base==="undefined"){InkTool.Base=function(){};InkTool.Base.superclass=null;InkTool.Base.subclasses=[];InkTool.Base.prototype={initialize:function(){},clone:function(){var dest=new Object();for(var _136 in this){dest[_136]=this.doClone(this[_136]);}return dest;},doClone:function(prop){if(prop instanceof InkTool.Base){return prop.clone();}else{if(prop instanceof Array){var _137=new Array();var _138=prop.length;for(var _139=0;_139<_138;_139++){_137.push(this.doClone(prop[_139]));}return _137;}else{if(typeof prop=="object"){var obj=new Object();for(var key in prop){obj[key]=this.doClone(prop[key]);}return obj;}else{return prop;}}}},extend:function(_13a){for(var _13b in _13a){this.prototype[_13b]=_13a[_13b];}}};}if(typeof InkTool.InkGeolocationLib==="undefined"){InkTool.InkGeolocationLib={Version:"1.00",Position:null,Error:null,Started:false,Getting:false,Watching:false,WatchId:null,TryNum:0,RetryInterval:5000,TraceInterval:120000,TimerId:null,SuccessCount:0,ErrorCount:0,RetryCount:0,RetryCancel:false,PositionData:null,CommingData:null,SuspendCount:0,UserSuccessCallback:null,UserErrorCallback:null,PositionOptions:{enableHighAccuracy:true,timeout:120000,maximumAge:0},getVersion:function(){var _1=InkTool.InkGeolocationLib;return _1.Version;},setHandler:function(_2,_3){var _4=InkTool.InkGeolocationLib;if(_2=="success"){_4.UserSuccessCallback=_3;}else{if(_2=="error"){_4.UserErrorCallback=_3;}}},setHighAccuracy:function(_5){var _6=InkTool.InkGeolocationLib;_6.PositionOptions.enableHighAccuracy=_5;},getHighAccuracy:function(){var _7=InkTool.InkGeolocationLib;return _7.PositionOptions.enableHighAccuracy;},setTimeout:function(_8){var _9=InkTool.InkGeolocationLib;_9.PositionOptions.timeout=_8;},getTimeout:function(){var _a=InkTool.InkGeolocationLib;return _a.PositionOptions.timeout;},setMaximumAge:function(_b){var _c=InkTool.InkGeolocationLib;_c.PositionOptions.maximumAge=_b;},getMaximumAge:function(){var _d=InkTool.InkGeolocationLib;return _d.PositionOptions.maximumAge;},setTryNum:function(_e){var _f=InkTool.InkGeolocationLib;_f.TryNum=_e;},getTryNum:function(){var _10=InkTool.InkGeolocationLib;return _10.TryNum;},setRetryInterval:function(_11){var _12=InkTool.InkGeolocationLib;_12.RetryInterval=_11;},getRetryInterval:function(){var _13=InkTool.InkGeolocationLib;return _13.RetryInterval;},setTraceInterval:function(_14){var _15=InkTool.InkGeolocationLib;_15.TraceInterval=_14;},getTraceInterval:function(){var _16=InkTool.InkGeolocationLib;return _16.TraceInterval;},isSupportedGeolocation:function(){if(navigator.geolocation){return true;}else{return false;}},isStarted:function(){var _17=InkTool.InkGeolocationLib;return (_17.Started);},isProcessing:function(){var _18=InkTool.InkGeolocationLib;return (_18.Getting||_18.Watching);},isSucceeded:function(){var _19=InkTool.InkGeolocationLib;return (_19.SuccessCount>0);},setPosition:function(_1a){var _1b=InkTool.InkGeolocationLib;_1b.doSetPosition(_1a);},getPosition:function(){var _1c=InkTool.InkGeolocationLib;return _1c.PositionData;},hasError:function(){var _1d=InkTool.InkGeolocationLib;return (_1d.ErrorCount>0);},getError:function(){var _1e=InkTool.InkGeolocationLib;return _1e.Error;},startCollectingPosition:function(){var _1f=InkTool.InkGeolocationLib;if(_1f.isSupportedGeolocation()==false){return -1;}if(_1f.Getting||_1f.Watching){return -2;}_1f.Started=true;_1f.Getting=true;_1f.RetryCount=0;_1f.RetryCancel=false;_1f.SuspendCount=0;navigator.geolocation.getCurrentPosition(_1f.innerSuccessHandler,_1f.innerErrorHandler,_1f.PositionOptions);return 0;},startWatchingPosition:function(){var _20=InkTool.InkGeolocationLib;if(_20.isSupportedGeolocation()==false){return -1;}if(_20.Getting||_20.Watching){return -2;}_20.Started=true;_20.Watching=true;_20.SuspendCount=0;_20.WatchId=navigator.geolocation.watchPosition(_20.innerSuccessHandler,_20.innerErrorHandler,_20.PositionOptions);return 0;},stopProcessing:function(){var _21=InkTool.InkGeolocationLib;if(_21.isSupportedGeolocation()==false){return -1;}if(!_21.Getting&&!_21.Watching){return -2;}if(_21.Getting){_21.RetryCancel=true;if(_21.TimerId!=null){clearTimeout(_21.TimerId);_21.TimerId=null;}_21.Getting=false;}else{navigator.geolocation.clearWatch(_21.WatchId);_21.Watching=false;}return 0;},doSetPosition:function(_22){var _23=InkTool.InkGeolocationLib;_23.Position=_22;if(_23.PositionData==null||_23.PositionData.coords.accuracy>=_22.coords.accuracy){_23.PositionData=_23.positionApiToInner(_22);_23.CommingData=null;_23.SuspendCount=0;}else{if(_23.TraceInterval>=0){var _24=_23.PositionData.timestamp;var _25=_22.timestamp;if(_25>=_24+(_23.TraceInterval+1)/2){if(_23.CommingData==null||_23.CommingData.coords.accuracy>=_22.coords.accuracy){_23.CommingData=_23.positionApiToInner(_22);}}if(_25>=_24+_23.TraceInterval){if(_23.CommingData!=null){if(_23.CommingData.coords.accuracy>=_23.PositionData.coords.accuracy*3&&_23.SuspendCount<3){_23.PositionData.timestamp=_23.CommingData.timestamp-(_23.TraceInterval+1)/2;_23.SuspendCount++;}else{_23.PositionData=_23.CommingData;_24=_23.PositionData.timestamp;if(_25>=_24+(_23.TraceInterval+1)/2){_23.CommingData=_23.positionApiToInner(_22);}else{_23.CommingData=null;}_23.SuspendCount=0;}}else{if(_22.coords.accuracy>=_23.PositionData.coords.accuracy*3&&_23.SuspendCount<3){_23.PositionData.timestamp=_25-(_23.TraceInterval+1)/2;_23.CommingData=_23.positionApiToInner(_22);_23.SuspendCount++;}else{_23.PositionData=_23.positionApiToInner(_22);_23.CommingData=null;_23.SuspendCount=0;}}}}}},positionApiToInner:function(_26){if(_26==null){return null;}var _27={latitude:_26.coords.latitude,longitude:_26.coords.longitude,altitude:_26.coords.altitude,accuracy:_26.coords.accuracy,altitudeAccuracy:_26.coords.altitudeAccuracy,heading:_26.coords.heading,speed:_26.coords.speed};var _28={coords:_27,timestamp:_26.timestamp};return _28;},innerSuccessHandler:function(_29){var _2a=InkTool.InkGeolocationLib;_2a.SuccessCount++;_2a.doSetPosition(_29);if(_2a.UserSuccessCallback!=null){try{_2a.UserSuccessCallback(_29);}catch(e){alert("user success callback error:"+e);}}if(_2a.Getting){_2a.nextCurrentPosition();}},innerErrorHandler:function(_2b){var _2c=InkTool.InkGeolocationLib;_2c.ErrorCount++;_2c.Error=_2b;if(_2c.UserErrorCallback!=null){try{_2c.UserErrorCallback(_2b);}catch(e){alert("user error callback error:"+e);}}if(_2c.Getting){_2c.nextCurrentPosition();}},nextCurrentPosition:function(){var _2d=InkTool.InkGeolocationLib;_2d.RetryCount++;if(_2d.RetryCancel==false&&(_2d.TryNum==0||_2d.RetryCount<_2d.TryNum)){_2d.TimerId=setTimeout(function(){_2d.TimerId=null;navigator.geolocation.getCurrentPosition(_2d.innerSuccessHandler,_2d.innerErrorHandler,_2d.PositionOptions);},_2d.RetryInterval);}else{_2d.Getting=false;}},positionInnerToInk:function(_2e,_2f,_30){var glc={};glc.cd=_2f;if(_30!=null){glc.ms=_30;}if(_2f==0||_2f==100){if(_2e==null){if(_2f==0){return null;}}else{glc.lt=_2e.coords.latitude;glc.ln=_2e.coords.longitude;if(_2e.coords.altitude!=null){glc.at=_2e.coords.altitude;}glc.ac=_2e.coords.accuracy;if(_2e.coords.altitudeAccuracy!=null){glc.aa=_2e.coords.altitudeAccuracy;}if(InkTool.InkLib.isNaN(_2e.coords.heading)){glc.hd="NaN";}else{if(_2e.coords.heading!=null){glc.hd=_2e.coords.heading;}}if(InkTool.InkLib.isNaN(_2e.coords.speed)){glc.sp="NaN";}else{if(_2e.coords.speed!=null){glc.sp=_2e.coords.speed;}}glc.tm=_2e.timestamp;}}return glc;},positionCodeByInk:function(glc){if(glc==null){return 0;}else{return glc.cd;}},positionMessageByInk:function(glc){if(glc==null){return null;}else{return glc.ms;}},positionInkToInner:function(glc){if(glc==null){return null;}if(("lt" in glc)==false||("ln" in glc)==false||("ac" in glc)==false||("tm" in glc)==false){return null;}var _31={latitude:glc.lt,longitude:glc.ln,altitude:("at" in glc)?glc.at:null,accuracy:glc.ac,altitudeAccuracy:("aa" in glc)?glc.aa:null,heading:("hd" in glc)?((glc.hd=="NaN")?Number.NaN:glc.hd):null,speed:("sp" in glc)?((glc.sp=="NaN")?Number.NaN:glc.sp):null};var _32={coords:_31,timestamp:glc.tm};return _32;},positionInnerToPublicInk:function(_33,_34,_35){var glc={};glc.code=_34;if(_35!=null){glc.message=_35;}if(_34==0||_34==10){if(_33==null){if(_34==0){return null;}}else{glc.latitude=_33.coords.latitude;glc.longitude=_33.coords.longitude;glc.accuracy=_33.coords.accuracy;glc.timestamp=_33.timestamp;}}return glc;},Dummy:null};}if(typeof InkTool.InkColor==="undefined"){InkTool.InkColor=InkTool.InkLib.Class.create(null,{initialize:function(_1){this.setColor(_1);},clearColor:function(_2){this.ok=_2;this.R=0;this.G=0;this.B=0;this.A=0;},setColor:function(_3){if(_3===null){this.clearColor(false);}else{if(typeof _3=="string"){this.setString(_3);}else{if(typeof _3=="number"){this.setNumber(_3);}else{this.copyColor(_3);}}}},setString:function(_4){this.clearColor(false);_4=_4.replace(/ /g,"");_4=_4.toLowerCase();var _5={aliceblue:"f0f8ff",antiquewhite:"faebd7",aqua:"00ffff",aquamarine:"7fffd4",azure:"f0ffff",beige:"f5f5dc",bisque:"ffe4c4",black:"000000",blanchedalmond:"ffebcd",blue:"0000ff",blueviolet:"8a2be2",brown:"a52a2a",burlywood:"deb887",cadetblue:"5f9ea0",chartreuse:"7fff00",chocolate:"d2691e",coral:"ff7f50",cornflowerblue:"6495ed",cornsilk:"fff8dc",crimson:"dc143c",cyan:"00ffff",darkblue:"00008b",darkcyan:"008b8b",darkgoldenrod:"b8860b",darkgray:"a9a9a9",darkgreen:"006400",darkkhaki:"bdb76b",darkmagenta:"8b008b",darkolivegreen:"556b2f",darkorange:"ff8c00",darkorchid:"9932cc",darkred:"8b0000",darksalmon:"e9967a",darkseagreen:"8fbc8f",darkslateblue:"483d8b",darkslategray:"2f4f4f",darkturquoise:"00ced1",darkviolet:"9400d3",deeppink:"ff1493",deepskyblue:"00bfff",dimgray:"696969",dodgerblue:"1e90ff",feldspar:"d19275",firebrick:"b22222",floralwhite:"fffaf0",forestgreen:"228b22",fuchsia:"ff00ff",gainsboro:"dcdcdc",ghostwhite:"f8f8ff",gold:"ffd700",goldenrod:"daa520",gray:"808080",green:"008000",greenyellow:"adff2f",honeydew:"f0fff0",hotpink:"ff69b4",indianred:"cd5c5c",indigo:"4b0082",ivory:"fffff0",khaki:"f0e68c",lavender:"e6e6fa",lavenderblush:"fff0f5",lawngreen:"7cfc00",lemonchiffon:"fffacd",lightblue:"add8e6",lightcoral:"f08080",lightcyan:"e0ffff",lightgoldenrodyellow:"fafad2",lightgrey:"d3d3d3",lightgreen:"90ee90",lightpink:"ffb6c1",lightsalmon:"ffa07a",lightseagreen:"20b2aa",lightskyblue:"87cefa",lightslateblue:"8470ff",lightslategray:"778899",lightsteelblue:"b0c4de",lightyellow:"ffffe0",lime:"00ff00",limegreen:"32cd32",linen:"faf0e6",magenta:"ff00ff",maroon:"800000",mediumaquamarine:"66cdaa",mediumblue:"0000cd",mediumorchid:"ba55d3",mediumpurple:"9370d8",mediumseagreen:"3cb371",mediumslateblue:"7b68ee",mediumspringgreen:"00fa9a",mediumturquoise:"48d1cc",mediumvioletred:"c71585",midnightblue:"191970",mintcream:"f5fffa",mistyrose:"ffe4e1",moccasin:"ffe4b5",navajowhite:"ffdead",navy:"000080",oldlace:"fdf5e6",olive:"808000",olivedrab:"6b8e23",orange:"ffa500",orangered:"ff4500",orchid:"da70d6",palegoldenrod:"eee8aa",palegreen:"98fb98",paleturquoise:"afeeee",palevioletred:"d87093",papayawhip:"ffefd5",peachpuff:"ffdab9",peru:"cd853f",pink:"ffc0cb",plum:"dda0dd",powderblue:"b0e0e6",purple:"800080",red:"ff0000",rosybrown:"bc8f8f",royalblue:"4169e1",saddlebrown:"8b4513",salmon:"fa8072",sandybrown:"f4a460",seagreen:"2e8b57",seashell:"fff5ee",sienna:"a0522d",silver:"c0c0c0",skyblue:"87ceeb",slateblue:"6a5acd",slategray:"708090",snow:"fffafa",springgreen:"00ff7f",steelblue:"4682b4",tan:"d2b48c",teal:"008080",thistle:"d8bfd8",tomato:"ff6347",turquoise:"40e0d0",violet:"ee82ee",violetred:"d02090",wheat:"f5deb3",white:"ffffff",whitesmoke:"f5f5f5",yellow:"ffff00",yellowgreen:"9acd32"};var _6=_5[_4];if(_6!=undefined){_4="#"+_6;}var _7=[{re:/^rgba\((\d{1,3}),\s*(\d{1,3}),\s*(\d{1,3}),\s*([0-9\.]*)\)$/,example:["rgba(123, 234, 45, 1.0)","rgba(255,234,245, 0.5)"],process:function(_8){return [parseInt(_8[1]),parseInt(_8[2]),parseInt(_8[3]),Math.floor(parseFloat(_8[4])*255+0.5)];}},{re:/^rgb\((\d{1,3}),\s*(\d{1,3}),\s*(\d{1,3})\)$/,example:["rgb(123, 234, 45)","rgb(255,234,245)"],process:function(_9){return [parseInt(_9[1]),parseInt(_9[2]),parseInt(_9[3]),255];}},{re:/^#([0-9a-fA-F]{2})([0-9a-fA-F]{2})([0-9a-fA-F]{2})([0-9a-fA-F]{2})$/,example:["#ff00ff00","80336699"],process:function(_a){return [parseInt(_a[2],16),parseInt(_a[3],16),parseInt(_a[4],16),parseInt(_a[1],16)];}},{re:/^#([0-9a-fA-F]{2})([0-9a-fA-F]{2})([0-9a-fA-F]{2})$/,example:["#00ff00","336699"],process:function(_b){return [parseInt(_b[1],16),parseInt(_b[2],16),parseInt(_b[3],16),255];}},{re:/^#(\w{1})(\w{1})(\w{1})$/,example:["#fb0","f0f"],process:function(_c){return [parseInt(_c[1]+_c[1],16),parseInt(_c[2]+_c[2],16),parseInt(_c[3]+_c[3],16),255];}}];for(var i=0;i<_7.length;i++){var re=_7[i].re;var _d=_7[i].process;var _e=re.exec(_4);if(_e){channels=_d(_e);this.R=channels[0];this.G=channels[1];this.B=channels[2];this.A=channels[3];this.ok=true;break;}}if(this.ok==true){function _f(val){return (isNaN(val)==false&&val>=0&&val<=255);};if(_f(this.R)==false||_f(this.G)==false||_f(this.B)==false||_f(this.A)==false){this.clearColor(false);}}},setNumber:function(_10){this.A=(_10>>>24);this.R=((_10&16711680)>>16);this.G=((_10&65280)>>8);this.B=(_10&255);this.ok=true;},copyColor:function(_11){this.A=_11.A;this.R=_11.R;this.G=_11.G;this.B=_11.B;this.ok=_11.ok;},getRGB:function(){return "rgb("+this.R+","+this.G+","+this.B+")";},getRGBA:function(){return "rgba("+this.R+","+this.G+","+this.B+","+(this.A/255).toFixed(3)+")";},getHex:function(){var r=this.R.toString(16);var g=this.G.toString(16);var b=this.B.toString(16);if(r.length==1){r="0"+r;}if(g.length==1){g="0"+g;}if(b.length==1){b="0"+b;}return "#"+r+g+b;},getNumber:function(){return (((this.A<<24)+(this.R<<16)+(this.G<<8)+this.B)>>>0);},});}if(typeof InkTool.InkPenType==="undefined"){InkTool.InkPenType={Old_None:4,Old_BallpointPen:0,Old_FeltPen:1,Old_BrushPen:1,Old_StrokeEraser:2,Old_NormalEraser:3,Old_MarkerPen:5,Old_FudePen:6,Old_AirbrushPen:7,Old_VariableBallpointPen:8,Old_VariableFudePen:9,Old_Pencil:10,Old_PencilEmulated:11,Old_VariableSignPen:12,Old_FeltPenV100:501,Old_KesSound:1001,Old_KesText:1002,None:100,PressSenseBallpointPen:101,PressSenseFeltPen:102,PressSenseMarkerPen:103,PressSenseFudePen:104,PressSenseAirbrushPen:105,PressSenseSignPen:106,PressSenseSchoolPen:107,SolidPen:150,SpeedSenseBallpointPen:151,SpeedSenseFeltPen:152,SepedSenseMarkerPen:153,SpeedSenseFudePen:154,SpeedSsenseAirbrushPen:155,SpeedSenseSignPen:156,SpeedSenseSchoolPen:157,StrokeEraser:201,PressSenseNormalEraser:202,SolidEraser:203,Pencil:10,PencilEmulated:11,FeltPenV100:21,KesSound:51,KesText:52,AutoSwitchBallpointPen:301,AutoSwitchFeltPen:302,AutoSwitchMarkerPen:303,AutoSwitchFudePen:304,AutoSwitchAirbrushPen:305,AutoSwitchSignPen:306,AutoSwitchSchoolPen:307,AutoSwitchEraser:401,Max:9999};}if(typeof InkTool.InkStationery==="undefined"){InkTool.InkStationery=InkTool.InkLib.Class.create(null,{initialize:function(){this.tp=InkTool.InkPenType.None;this.col=new InkTool.InkColor("black");this.w=1;this.minw=1;this.maxw=1;this.oldType=-1;this.activeXPen=null;this.html5Pen=null;},getInfo:function(){return "type="+this.tp+":color="+this.col.getRGBA()+":width="+this.w+"("+this.minw+"-"+this.maxw+")";},getPenType:function(){return this.tp;},setPenColor:function(_1){this.col=_1;},getPenColor:function(){return this.col;},setPenWidth:function(_2){this.w=_2;},getPenWidth:function(){return this.w;},setPenMinWidth:function(_3){this.minw=_3;},getPenMinWidth:function(){return this.minw;},setPenMaxWidth:function(_4){this.maxw=_4;},getPenMaxWidth:function(){return this.maxw;},drawStart:function(_5){},strokeDispatch:function(_6,_7,_8){if(_8==0){var _9=_7.m;var xp=_7.x;var yp=_7.y;var wd=_7.w;var tm=_7.t;if(_9==0){this.strokeStart(_6,xp,yp,wd,tm);}else{if(_9==1){this.strokeMove(_6,xp,yp,wd,tm);}else{if(_9==3){this.strokePause(_6,xp,yp,wd,tm);}else{if(_9==4){this.strokeMoveFeature(_6,xp,yp,wd,tm);}else{if(_9==5){this.strokeMoveBend(_6,xp,yp,wd,tm);}else{if(_9==6){this.strokeMoveToEnd(_6,xp,yp,wd,tm);}else{if(_9==2){this.strokeEnd(_6,xp,yp,wd,tm);}}}}}}}return;}var _9=_7.m;if(_9==0){_6.queueCells=[];_6.queueCells.push(_7);if(_8==1){var xp=_7.x;var yp=_7.y;var wd=_7.w;var tm=_7.t;this.strokeStart(_6,xp,yp,wd,tm);}_6.featureLast=_7;_6.featureLLast=null;_6.agingDist=2*2;var _a=_6.ftdtStraightDist2;if(_6.agingDist>_a){_6.agingDist=_a;}}else{var _b=_6.ftdtBendDist;if(_b==0){if(_8==1){var md=_7.m;var xp=_7.x;var yp=_7.y;var wd=_7.w;var tm=_7.t;if(md==1){this.strokeMove(_6,xp,yp,wd,tm);}else{if(md==3){this.strokePause(_6,xp,yp,wd,tm);}else{if(md==4){this.strokeMoveFeature(_6,xp,yp,wd,tm);}else{if(md==5){this.strokeMoveBendLater(_6,xp,yp,wd,tm);}else{if(md==6){this.strokeMoveToEnd(_6,xp,yp,wd,tm);}else{if(md==2){this.strokeEnd(_6,xp,yp,wd,tm);}}}}}}}}else{_6.queueCells.push(_7);var _c=this.findFeaturePoints(_6,_9);var _a=_6.ftdtStraightDist2;for(var _d=0;_d<_c.length;_d++){if(_8==1){var _e=_c[_d];var md=_e.m;var xp=_e.x;var yp=_e.y;var wd=_e.w;var tm=_e.t;if(md==1){this.strokeMove(_6,xp,yp,wd,tm);}else{if(md==3){this.strokePause(_6,xp,yp,wd,tm);}else{if(md==4){this.strokeMoveFeature(_6,xp,yp,wd,tm);}else{if(md==5){this.strokeMoveBendLater(_6,xp,yp,wd,tm);}else{if(md==6){this.strokeMoveToEnd(_6,xp,yp,wd,tm);}else{if(md==2){this.strokeEnd(_6,xp,yp,wd,tm);}}}}}}}if(_6.agingDist<_a){_6.agingDist*=4;if(_6.agingDist>_a){_6.agingDist=_a;}}}}}},findFeaturePoints:function(_f,_10){var _11=[];var _12=_f.ftdtBendDist2;var _13=_f.agingDist;var _14=_f.ftdtTimeDist;var _15=_f.ftdtSharpDist2;var _16=_f.queueCells.length-1;var pt1=_f.queueCells[0];var pt3=_f.queueCells[_16];var _17=-1;var _18=0;var _19=1;for(var idx=1;idx<_16;idx++){var pt2=_f.queueCells[idx];var _1a=this.getLineSegmentAndPointDistance2(pt1.x,pt1.y,pt3.x,pt3.y,pt2.x,pt2.y);if(_1a>_18){_17=idx;_18=_1a;_19=(_10==2)?6:4;}}if(_17<0||_18<_12){_17=-1;if(_10==1){var _1b=this.getEuclideanDistance2(pt1.x,pt1.y,pt3.x,pt3.y);var _1c=pt3.t-pt1.t;if(_1b>=_13){_17=_16;_19=(_10==2)?6:4;}else{if(_1c>=_14){_17=_16;_19=3;}}}}var _1d=1;if(_17>=0){for(var idx=1;idx<_17;idx++){var pt=_f.queueCells[idx];if(pt.m==1){pt.m=-1;}}var _1e=_f.queueCells[_17];if(_15>0&&_f.featureLLast!=null&&_f.featureLast!=null&&(_f.featureLast.m==4||_f.featureLast.m==3)){var _1f=_f.featureLLast;var _20=_f.featureLast;var _21=this.detectBendPoint(_1f,_20,_1e,_15,_1d);if(_21){_20.m=5;_11.push(_20);}}_1e.m=_19;_11.push(_1e);_f.featureLLast=_f.featureLast;_f.featureLast=_1e;}if(_10!=1){var _22=1;if(_17>=0){_22=_17+1;}for(var idx=_22;idx<_16;idx++){var pt=_f.queueCells[idx];if(pt.m==1){pt.m=-1;}}_17=_16;var _1e=_f.queueCells[_17];if(_15>0&&_f.featureLLast!=null&&_f.featureLast!=null&&(_f.featureLast.m==4||_f.featureLast.m==3)){var _1f=_f.featureLLast;var _20=_f.featureLast;var _21=this.detectBendPoint(_1f,_20,_1e,_15,_1d);if(_21){_20.m=5;_11.push(_20);}}_11.push(_1e);_f.featureLLast=_f.featureLast;_f.featureLast=_1e;}if(_17>=0){for(var idx=0;idx<_17;idx++){_f.queueCells.shift();}}return _11;},detectBendPoint:function(pt1,pt2,pt3,_23,_24){var _25=this.getAngleOfLineSegments(pt1.x,pt1.y,pt2.x,pt2.y,pt2.x,pt2.y,pt3.x,pt3.y);if(_25<Math.PI/3){return false;}var x1=(pt1.x+pt2.x)/2;var y1=(pt1.y+pt2.y)/2;var x2=pt2.x;var y2=pt2.y;var x3=(pt2.x+pt3.x)/2;var y3=(pt2.y+pt3.y)/2;var xd1=x1-x2;var yd1=y1-y2;var xd2=x3-x2;var yd2=y3-y2;var _26=xd1*xd1+yd1*yd1;var _27=xd2*xd1+yd2*yd1;var _28=xd2*xd2+yd2*yd2;var _29=Math.sqrt(_28/_26);var _2a=1/(Math.sqrt(_29)+1);var _2b=_24;for(var ct=0;ct<_24;ct++){var _2c=4*(_26+2*_27+_28)*_2a*_2a*_2a-12*(_26+_27)*_2a*_2a+4*(3*_26+_27)*_2a-4*_26;var _2d=12*(_26+2*_27+_28)*_2a*_2a-24*(_26+_27)*_2a+4*(3*_26+_27);if(_2d==0){break;}else{if(_2d<0){_2a+=0.1;if(_2b>0){_2b--;ct--;}}else{_2a=_2a-_2c/_2d;}}}var xp=x1*(1-_2a)*(1-_2a)+x2*2*_2a*(1-_2a)+x3*_2a*_2a;var yp=y1*(1-_2a)*(1-_2a)+y2*2*_2a*(1-_2a)+y3*_2a*_2a;var xd=xp-x2;var yd=yp-y2;var _2e=(xd*xd+yd*yd);return (_2e>=_23);},strokeStart:function(_2f,xp,yp,wd,tm){},strokeMove:function(_30,xp,yp,wd,tm){},strokePause:function(_31,xp,yp,wd,tm){this.strokeMove(_31,xp,yp,wd,tm);},strokeMoveFeature:function(_32,xp,yp,wd,tm){this.strokeMove(_32,xp,yp,wd,tm);},strokeMoveBend:function(_33,xp,yp,wd,tm){this.strokeMove(_33,xp,yp,wd,tm);this.strokeMove(_33,xp+0.1,yp+0.1,wd,tm);},strokeMoveBendLater:function(_34,xp,yp,wd,tm){this.strokeMove(_34,xp+0.1,yp+0.1,wd,tm);},strokeMoveToEnd:function(_35,xp,yp,wd,tm){this.strokeMove(_35,xp,yp,wd,tm);},strokeEnd:function(_36,xp,yp,wd,tm){},drawEnd:function(_37){},fullDrawStart:function(_38){},fullStrokeDispatch:function(_39,_3a){var _3b=_3a.getMode();var xp=_3a.getX();var yp=_3a.getY();var wd=_3a.getWidth();var tm=_3a.getTime();if(_3b==0){this.fullStrokeStart(_39,xp,yp,wd,tm);}else{if(_3b==1){this.fullStrokeMove(_39,xp,yp,wd,tm);}else{if(_3b==3){this.fullStrokePause(_39,xp,yp,wd,tm);}else{if(_3b==4){this.fullStrokeMoveFeature(_39,xp,yp,wd,tm);}else{if(_3b==5){this.fullStrokeMoveBend(_39,xp,yp,wd,tm);}else{if(_3b==6){this.fullStrokeMoveToEnd(_39,xp,yp,wd,tm);}else{if(_3b==2){this.fullStrokeEnd(_39,xp,yp,wd,tm);}}}}}}}},fullStrokeStart:function(_3c,xp,yp,wd,tm){},fullStrokeMove:function(_3d,xp,yp,wd,tm){},fullStrokePause:function(_3e,xp,yp,wd,tm){this.fullStrokeMove(_3e,xp,yp,wd,tm);},fullStrokeMoveFeature:function(_3f,xp,yp,wd,tm){this.fullStrokeMove(_3f,xp,yp,wd,tm);},fullStrokeMoveBend:function(_40,xp,yp,wd,tm){this.fullStrokeMove(_40,xp,yp,wd,tm);this.fullStrokeMove(_40,xp+0.1,yp+0.1,wd,tm);},fullStrokeMoveToEnd:function(_41,xp,yp,wd,tm){this.fullStrokeMove(_41,xp,yp,wd,tm);},fullStrokeEnd:function(_42,xp,yp,wd,tm){},fullDrawEnd:function(_43){},hasFullDrawMode:function(){return false;},isSpeedSensitive:function(){return false;},isPressureSensitive:function(){return false;},isAutomaticSwitchover:function(){return false;},getOldPenType:function(){return this.oldType;},getActiveXPen:function(){return this.activeXPen;},getHtml5Pen:function(){return this.html5Pen;},getSubInfo:function(){return "";},getEuclideanDistance:function(x1,y1,x2,y2){var dx=x2-x1;var dy=y2-y1;return Math.sqrt(dx*dx+dy*dy);},getEuclideanDistance2:function(x1,y1,x2,y2){var dx=x2-x1;var dy=y2-y1;return (dx*dx+dy*dy);},getLineSegmentAndPointDistance:function(x1,y1,x2,y2,xp,yp){var dx=x2-x1;var dy=y2-y1;var _44=dx*dx+dy*dy;var _45=dx*(x1-xp)+dy*(y1-yp);if(_44==0){return this.getEuclideanDistance(x1,y1,xp,yp);}else{var _46=-_45/_44;if(_46<=0){return this.getEuclideanDistance(x1,y1,xp,yp);}else{if(_46>=1){return this.getEuclideanDistance(x2,y2,xp,yp);}else{var tx=x1+dx*_46;var ty=y1+dy*_46;return this.getEuclideanDistance(tx,ty,xp,yp);}}}},getLineSegmentAndPointDistance2:function(x1,y1,x2,y2,xp,yp){var dx=x2-x1;var dy=y2-y1;var _47=dx*dx+dy*dy;var _48=dx*(x1-xp)+dy*(y1-yp);var xd,yd;if(_47==0){xd=xp-x1;yd=yp-y1;}else{var _49=-_48/_47;if(_49<=0){xd=xp-x1;yd=yp-y1;}else{if(_49>=1){xd=xp-x2;yd=yp-y2;}else{var tx=x1+dx*_49;var ty=y1+dy*_49;xd=xp-tx;yd=yp-ty;}}}return (xd*xd+yd*yd);},calcAngleOfVector:function(xp,yp){var _4a=xp*xp+yp*yp;if(_4a==0){return -100;}var _4b=Math.acos(xp/Math.sqrt(_4a));if(yp<0){_4b=2*Math.PI-_4b;}return _4b;},getAngleOfLineSegments:function(x1s,y1s,x1f,y1f,x2s,y2s,x2f,y2f){var _4c=this.calcAngleOfVector(x1f-x1s,y1f-y1s);var _4d=this.calcAngleOfVector(x2f-x2s,y2f-y2s);if(_4c==-100||_4d==-100){return 0;}var _4e=Math.abs(_4c-_4d);if(_4e>Math.PI){_4e=2*Math.PI-_4e;}return _4e;},getDLenByAlpha:function(_4f){var _50;_50=Math.pow(_4f,1.6)/27500;return _50;},dummy:function(){}});}if(typeof InkTool.DrawingContext==="undefined"){InkTool.DrawingContext=InkTool.InkLib.Class.create(null,{initialize:function(_51,_52,_53,_54){this.context=_51;this.offsetX=_52;this.offsetY=_53;this.zoomRatio=_54;this.ftdtBendDist=0.75;this.ftdtStraightDist=32;this.ftdtTimeDist=25;this.ftdtSharpDist=1.05;this.ftdtBendDist2=this.ftdtBendDist*this.ftdtBendDist;this.ftdtStraightDist2=this.ftdtStraightDist*this.ftdtStraightDist;this.ftdtSharpDist2=this.ftdtSharpDist*this.ftdtSharpDist;this.clipRect=null;this.canvasWidth=0;this.canvasHeight=0;this.queuePoints=new Array();},setContext:function(_55){this.context=_55;},getContext:function(){return this.context;},setOffset:function(_56,_57){this.offsetX=_56;this.offsetY=_57;},getOffsetX:function(){return this.offsetX;},getOffsetY:function(){return this.offsetY;},setZoomRatio:function(_58){this.zoomRatio=_58;},getZoomRatio:function(){return this.zoomRatio;},xpDataToDraw:function(xp){return ((xp-this.offsetX)*this.zoomRatio);},ypDataToDraw:function(yp){return ((yp-this.offsetY)*this.zoomRatio);},widthDataToDraw:function(_59){return (_59*this.zoomRatio);},heightDataToDraw:function(_5a){return (_5a*this.zoomRatio);},lengthDataToDraw:function(_5b){return (_5b*this.zoomRatio);},xpDrawToData:function(xp){return ((xp/this.zoomRatio)+this.offsetX);},ypDrawToData:function(yp){return ((yp/this.zoomRatio)+this.offsetY);},widthDrawToData:function(_5c){return (_5c/this.zoomRatio);},heightDrawToData:function(_5d){return (_5d/this.zoomRatio);},lengthDrawToData:function(_5e){return (_5e/this.zoomRatio);},setFeatureDetectingParams:function(_5f,_60,_61,_62){this.ftdtBendDist=_5f;this.ftdtStraightDist=_60;this.ftdtTimeDist=_61;this.ftdtSharpDist=_62;this.ftdtBendDist2=this.ftdtBendDist*this.ftdtBendDist;this.ftdtStraightDist2=this.ftdtStraightDist*this.ftdtStraightDist;this.ftdtSharpDist2=this.ftdtSharpDist*this.ftdtSharpDist;},getFeatureDetectingBendDist:function(){return this.ftdtBendDist;},getFeatureDetectingStraightDist:function(){return this.ftdtStraightDist;},getFeatureDetectingTimeDist:function(){return this.ftdtTimeDist;},getFeatureDetectingSharpDist:function(){return this.ftdtSharpDist;},calcClipRect:function(_63,_64){var _65=this.offsetX;var top=this.offsetY;var _66=Math.round(_63/this.zoomRatio);var _67=Math.round(_64/this.zoomRatio);this.clipRect={"left":_65,"top":top,"width":_66,"height":_67};this.canvasWidth=_63;this.canvasHeight=_64;},setClipRect:function(_68){this.clipRect=_68;},getClipRect:function(){return this.clipRect;},setCanvasSize:function(_69,_6a){this.canvasWidth=_69;this.canvasHeight=_6a;},getCanvasWidth:function(){return this.canvasWidth;},getCanvasHeight:function(){return this.canvasHeight;},isCircleInRect:function(cx,cy,_6b){return (this.canvasWidth==0||this.canvasHeight==0||(cx+_6b>=0&&cx-_6b<=this.canvasWidth&&cy+_6b>=0&&cy-_6b<=this.canvasHeight));},clone:function(){var _6c=new InkTool.DrawingContext(this.context,this.offsetX,this.offsetY,this.zoomRatio);_6c.setFeatureDetectingParams(this.ftdtBendDist,this.ftdtStraightDist,this.ftdtTimeDist,this.ftdtSharpDist);_6c.setClipRect(this.clipRect);_6c.setCanvasSize(this.canvasWidth,this.canvasHeight);return _6c;},cloneWithContext:function(ctx){var _6d=new InkTool.DrawingContext(ctx,this.offsetX,this.offsetY,this.zoomRatio);_6d.setFeatureDetectingParams(this.ftdtBendDist,this.ftdtStraightDist,this.ftdtTimeDist,this.ftdtSharpDist);_6d.setClipRect(this.clipRect);_6d.setCanvasSize(this.canvasWidth,this.canvasHeight);return _6d;},dummy:function(){}});}if(typeof InkTool.InkBallpointPen==="undefined"){InkTool.InkBallpointPen=InkTool.InkLib.Class.create(InkTool.InkStationery,{initialize:function(){this.tp=InkTool.InkPenType.SolidPen;this.col=new InkTool.InkColor("darkred");this.w=2;this.minw=1;this.maxw=5;this.oldType=InkTool.InkPenType.SolidPen;},drawStart:function(_6e){var ctx=_6e.context;ctx.strokeStyle=this.getPenColor().getRGBA();ctx.fillStyle=this.getPenColor().getRGBA();ctx.globalCompositeOperation="source-over";ctx.lineWidth=_6e.widthDataToDraw(this.getPenWidth());var _6f=this.getPenColor().A;if(_6f==0||_6f==255){ctx.lineCap="round";}else{ctx.lineCap="butt";}ctx.lineJoin="round";},strokeStart:function(_70,xp,yp,wd,tm){var ctx=_70.context;var _71=_70.xpDataToDraw(xp);var _72=_70.ypDataToDraw(yp);_70.lastData=[];_70.llastX=_70.lastX=_71;_70.llastY=_70.lastY=_72;_70.moveCount=0;var _73=this.getPenColor().A;_70.dlen=this.getDLenByAlpha(_73);},strokeMove:function(_74,xp,yp,wd,tm){return this.strokeMoveSub(_74,xp,yp,wd,tm);},strokeMoveSub:function(_75,xp,yp,wd,tm){var ctx=_75.context;var _76=_75.xpDataToDraw(xp);var _77=_75.ypDataToDraw(yp);if(_76==_75.lastX&&_77==_75.lastY){return;}var x1=(_75.lastX+_75.llastX)/2;var y1=(_75.lastY+_75.llastY)/2;var x2=_75.lastX;var y2=_75.lastY;var x3=(_75.lastX+_76)/2;var y3=(_75.lastY+_77)/2;var _78=this.getPenColor().A;if(0<_78&&_78<255){var _79=_75.dlen;var dx1=(x1-x2);var dy1=(y1-y2);var dd1=Math.sqrt(dx1*dx1+dy1*dy1);var dx3=(x3-x2);var dy3=(y3-y2);var dd3=Math.sqrt(dx3*dx3+dy3*dy3);var x3m=x3;var y3m=y3;if(dd3>0){var px3=dx3*_79/dd3;var py3=dy3*_79/dd3;x3m+=px3;y3m+=py3;}if(_75.moveCount>0){var x1m=x1;var y1m=y1;if(dd1>0){var px1=dx1*_79/dd1;var py1=dy1*_79/dd1;x1m+=px1;y1m+=py1;}ctx.beginPath();ctx.moveTo(x1m,y1m);ctx.quadraticCurveTo(x2,y2,x3m,y3m);ctx.stroke();}else{var xc=x2;var yc=y2;var x2m=x2;var y2m=y2;if(dd3>0){var px2=dx3*_79/dd3;var py2=dy3*_79/dd3;xc+=px2;yc+=py2;x2m-=px2;y2m-=py2;}var _7a=_75.widthDataToDraw(this.getPenWidth())/2;var _7b;if(dx3==0){if(dy3>0){_7b=Math.PI/2;}else{if(dy3==0){_7b=-100;}else{_7b=Math.PI*3/2;}}}else{_7b=Math.atan(Math.abs(dy3/dx3));if(dx3>=0){if(dy3<0){_7b=Math.PI*2-_7b;}}else{if(dy3>=0){_7b=Math.PI-_7b;}else{_7b=Math.PI+_7b;}}}var _7c,_7d;if(_7b==-100){_7c=0;_7d=Math.PI*2;}else{_7c=_7b+Math.PI/2;if(_7c>Math.PI*2){_7c-=Math.PI*2;}_7d=_7b-Math.PI/2;if(_7d<0){_7d+=Math.PI*2;}}ctx.beginPath();ctx.arc(xc,yc,_7a,_7c,_7d,false);ctx.fill();ctx.beginPath();ctx.moveTo(x2m,y2m);ctx.lineTo(x3m,y3m);ctx.stroke();}}else{ctx.beginPath();ctx.moveTo(x1,y1);ctx.quadraticCurveTo(x2,y2,x3,y3);ctx.stroke();}_75.llastX=_75.lastX;_75.llastY=_75.lastY;_75.lastX=_76;_75.lastY=_77;_75.moveCount++;},strokeEnd:function(_7e,xp,yp,wd,tm){var ctx=_7e.context;var _7f=_7e.xpDataToDraw(xp);var _80=_7e.ypDataToDraw(yp);var x1=(_7e.lastX+_7e.llastX)/2;var y1=(_7e.lastY+_7e.llastY)/2;var x2=_7e.lastX;var y2=_7e.lastY;var x3=_7f;var y3=_80;var _81=this.getPenColor().A;if(_7e.moveCount==0){var _82=_7e.widthDataToDraw(this.getPenWidth())/2;var _83,_84;_83=0;_84=Math.PI*2;ctx.beginPath();ctx.arc(x3,y3,_82,_83,_84,false);ctx.fill();}else{if(0<_81&&_81<255){var _85=_7e.dlen;var dx1=(x1-x2);var dy1=(y1-y2);var dd1=Math.sqrt(dx1*dx1+dy1*dy1);var x1m=x1;var y1m=y1;if(dd1>0){var px1=dx1*_85/dd1;var py1=dy1*_85/dd1;x1m+=px1;y1m+=py1;}var dx2=(x2-x1);var dy2=(y2-y1);var dd2=Math.sqrt(dx2*dx2+dy2*dy2);var dx3=(x3-x2);var dy3=(y3-y2);var dd3=Math.sqrt(dx3*dx3+dy3*dy3);var xc=x3;var yc=y3;if(x2==x3&&y2==y3){dx3=dx2;dy3=dy2;dd3=dd2;var x3m=x3;var y3m=y3;if(dd2>0){var px3=dx3*_85/dd3;var py3=dy3*_85/dd3;x3m+=px3;y3m+=py3;xc-=px3;yc-=py3;}ctx.beginPath();ctx.moveTo(x1m,y1m);ctx.lineTo(x3m,y3m);ctx.stroke();}else{var x3m=x3;var y3m=y3;if(dd3>0){var px3=dx3*_85/dd3;var py3=dy3*_85/dd3;x3m+=px3;y3m+=py3;xc-=px3;yc-=py3;}ctx.beginPath();ctx.moveTo(x1m,y1m);ctx.quadraticCurveTo(x2,y2,x3m,y3m);ctx.stroke();}var _82=_7e.widthDataToDraw(this.getPenWidth())/2;var _86;if(dx3==0){if(dy3>0){_86=Math.PI/2;}else{if(dy3==0){_86=-100;}else{_86=Math.PI*3/2;}}}else{_86=Math.atan(Math.abs(dy3/dx3));if(dx3>=0){if(dy3<0){_86=Math.PI*2-_86;}}else{if(dy3>=0){_86=Math.PI-_86;}else{_86=Math.PI+_86;}}}var _83,_84;if(_86==-100){_83=0;_84=Math.PI*2;}else{_83=_86-Math.PI/2;if(_83<0){_83+=Math.PI*2;}_84=_86+Math.PI/2;if(_84>Math.PI*2){_84-=Math.PI*2;}}ctx.beginPath();ctx.arc(xc,yc,_82,_83,_84,false);ctx.fill();}else{ctx.beginPath();ctx.moveTo(x1,y1);if(x2==x3&&y2==y3){ctx.lineTo(x3,y3);}else{ctx.quadraticCurveTo(x2,y2,x3,y3);}ctx.stroke();}}_7e.llastX=_7e.lastX;_7e.llastY=_7e.lastY;_7e.lastX=_7f;_7e.lastY=_80;},drawEnd:function(_87){},fullDrawStart:function(_88){var ctx=_88.context;ctx.strokeStyle=this.getPenColor().getRGBA();ctx.fillStyle=this.getPenColor().getRGBA();ctx.globalCompositeOperation="source-over";ctx.lineWidth=_88.widthDataToDraw(this.getPenWidth());ctx.lineCap="round";ctx.lineJoin="round";},fullStrokeStart:function(_89,xp,yp,wd,tm){var ctx=_89.context;var _8a=_89.xpDataToDraw(xp);var _8b=_89.ypDataToDraw(yp);ctx.beginPath();ctx.moveTo(_8a,_8b);_89.llastX=_89.lastX=_8a;_89.llastY=_89.lastY=_8b;_89.lastData=[];_89.moveCount=0;},fullStrokeMove:function(_8c,xp,yp,wd,tm){this.fullStrokeMoveSub(_8c,xp,yp,wd,tm);},fullStrokeMoveSub:function(_8d,xp,yp,wd,tm){var ctx=_8d.context;var _8e=_8d.xpDataToDraw(xp);var _8f=_8d.ypDataToDraw(yp);if(_8e==_8d.lastX&&_8f==_8d.lastY){return;}var x2=_8d.lastX;var y2=_8d.lastY;var x3=(_8d.lastX+_8e)/2;var y3=(_8d.lastY+_8f)/2;ctx.quadraticCurveTo(x2,y2,x3,y3);_8d.llastX=_8d.lastX;_8d.llastY=_8d.lastY;_8d.lastX=_8e;_8d.lastY=_8f;_8d.moveCount++;},fullStrokePause:function(_90,xp,yp,wd,tm){this.fullStrokeMoveSub(_90,xp,yp,wd,tm);},fullStrokeMoveFeature:function(_91,xp,yp,wd,tm){this.fullStrokeMoveSub(_91,xp,yp,wd,tm);},fullStrokeMoveBend:function(_92,xp,yp,wd,tm){this.fullStrokeMoveSub(_92,xp,yp,wd,tm);this.fullStrokeMoveSub(_92,xp+0.1,yp+0.1,wd,tm);},fullStrokeMoveToEnd:function(_93,xp,yp,wd,tm){this.fullStrokeMoveSub(_93,xp,yp,wd,tm);},fullStrokeEnd:function(_94,xp,yp,wd,tm){var ctx=_94.context;var _95=_94.xpDataToDraw(xp);var _96=_94.ypDataToDraw(yp);var x2=_94.lastX;var y2=_94.lastY;var x3=_95;var y3=_96;if(_94.moveCount==0){var _97=_94.widthDataToDraw(this.getPenWidth())/2;var _98,_99;_98=0;_99=Math.PI*2;ctx.arc(x3,y3,_97,_98,_99,false);ctx.fill();}else{if(x2==x3&&y2==y3){ctx.lineTo(x3,y3);}else{ctx.quadraticCurveTo(x2,y2,x3,y3);}ctx.stroke();}_94.llastX=_94.lastX;_94.llastY=_94.lastY;_94.lastX=_95;_94.lastY=_96;},fullDrawEnd:function(_9a){},hasFullDrawMode:function(){return true;},isSpeedSensitive:function(){return false;},isPressureSensitive:function(){return false;},isAutomaticSwitchover:function(){return false;},getSubInfo:function(){return "BallpointPen";}});}if(typeof InkTool.SolidPen==="undefined"){InkTool.SolidPen=InkTool.InkLib.Class.create(InkTool.InkBallpointPen,{initialize:function(){this.tp=InkTool.InkPenType.SolidPen;this.col=new InkTool.InkColor("black");this.w=2;this.minw=1;this.maxw=5;this.oldType=InkTool.InkPenType.SolidPen;},hasFullDrawMode:function(){return true;},isSpeedSensitive:function(){return false;},isPressureSensitive:function(){return false;},isAutomaticSwitchover:function(){return false;},getSubInfo:function(){return "SolidPen";}});}if(typeof InkTool.InkFeltPen==="undefined"){InkTool.InkFeltPen=InkTool.InkLib.Class.create(InkTool.InkStationery,{initialize:function(){this.tp=InkTool.InkPenType.SpeedSenseFeltPen;this.col=new InkTool.InkColor("purple");this.w=5;this.minw=3;this.maxw=8;this.oldType=InkTool.InkPenType.Old_FeltPen;this.transparency=true;this.smoothing=true;this.startSharpness=5;this.feltmode=true;this.coExpornent=-1;this.accelRatio=0.4;this.decelRatio=0.2;this.vxRatio=1;this.axRatio=0.2;this.angleThres=Math.PI/4;this.angleTrig=Math.PI/3;this.minValAccel=-0.1;this.zoopRatio=1.4;this.loopDivValue=2;this.vBeta=1.6;this.aExp=-0.32;this.valSmooth=8;this.acsSmooth=6;this.radiusSmooth=2;this.alphaSmooth=0;this.endingValBonus=0.15;this.endingValRatio=1.4;this.dotValRatio=0.5;this.endingRaveBonus=0.5;},setTransparency:function(_9b){this.transparency=_9b;},setSmoothing:function(_9c){this.smoothing=_9c;},drawStart:function(_9d){var ctx=_9d.context;ctx.strokeStyle=this.getPenColor().getRGBA();ctx.fillStyle=this.getPenColor().getRGBA();ctx.globalCompositeOperation="source-over";ctx.lineWidth=_9d.widthDataToDraw(this.getPenWidth());ctx.lineCap="round";ctx.lineJoin="round";_9d.drawMinPenWidth=_9d.widthDataToDraw(this.getPenMinWidth());_9d.drawMaxPenWidth=_9d.widthDataToDraw(this.getPenMaxWidth());_9d.drawScalePenWidth=_9d.drawMaxPenWidth-_9d.drawMinPenWidth;},strokeStart:function(_9e,xp,yp,wd,tm){var ctx=_9e.context;var _9f=_9e.xpDataToDraw(xp);var _a0=_9e.ypDataToDraw(yp);_9e.lastDrawX=_9f;_9e.lastDrawY=_a0;_9e.lastTime=tm;_9e.firstDraw=true;_9e.moveCount=0;_9e.moveSum=0;_9e.lastData=[];_9e.lastVal=0;_9e.lastAcs=0;_9e.lastAcsSum=0;_9e.lastRadius=-1;_9e.lastAlpha=-1;_9e.lastGamma=-1;_9e.startX=xp;_9e.startY=yp;_9e.endingBonus=0;var _a1,_a2;_a1={"val":-1,"acs":0,"ang":0,"x":_9f,"y":_a0,"tm":8,"stt":0,"dst":0,"bend":false,"abnd":false,"rbnd":0,"ruvl":0,"ufac":0,"xfvl":0};_a2={"val":-1,"acs":0,"ang":0,"x":_9f,"y":_a0,"tm":8,"stt":0,"dst":0,"bend":false,"abnd":false,"rbnd":0,"ruvl":0,"ufac":0,"xfvl":0};_9e.lastData.push(_a1);_9e.lastData.push(_a2);_9e.timeStr="";},strokeMove:function(_a3,xp,yp,wd,tm){this.strokeMoveStat(_a3,xp,yp,wd,tm,1);},strokeMoveStat:function(_a4,xp,yp,wd,tm,_a5){_a4.timeStr="";if(tm<=_a4.lastTime){_a4.queuePoints.push({"x":xp,"y":yp,"m":_a5});_a4.lastTime=tm;return;}var _a6=tm-_a4.lastTime;var _a7=_a6/(_a4.queuePoints.length+1);if(_a7<6){_a7=6;}var _a8=_a7;var _a9,_aa;while(_a4.queuePoints.length>0){var _ab=_a4.queuePoints.shift();_a9=_a4.xpDataToDraw(_ab.x);_aa=_a4.ypDataToDraw(_ab.y);var dx=(_a9-_a4.lastDrawX);var dy=(_aa-_a4.lastDrawY);if(dx==0&&dy==0){_a7+=_a8;continue;}var _ac=_ab.m;this.strokeMoveSub(_a4,_a9,_aa,_a7,_ac,false,false,false);_a4.lastDrawX=_a9;_a4.lastDrawY=_aa;_a7=_a8;}_a9=_a4.xpDataToDraw(xp);_aa=_a4.ypDataToDraw(yp);var dx=(_a9-_a4.lastDrawX);var dy=(_aa-_a4.lastDrawY);if(dx==0&&dy==0){return;}this.strokeMoveSub(_a4,_a9,_aa,_a7,_a5,false,false,false);_a4.lastTime=tm;_a4.lastDrawX=_a9;_a4.lastDrawY=_aa;},strokeMoveSub:function(_ad,xp,yp,_ae,_af,_b0,_b1,_b2){var ctx=_ad.context;var _b3=xp;var _b4=yp;var _b5=_ad.drawMinPenWidth*0.5;var _b6=_ad.drawScalePenWidth*0.5;var _b7=_ad.moveSum;var _b8=_ad.moveCount;_ad.moveCount++;var _b9=_ad.lastData[_ad.lastData.length-1];var _ba=_ad.lastData[_ad.lastData.length-2];var t1=_b9.tm;var t2=_ae;var px1=_ba.x;var py1=_ba.y;var px2=_b9.x;var py2=_b9.y;var px3=_b3;var py3=_b4;var _bb=_b9.stt;var d1=_b9.dst;var vc1=_b9.val;if(vc1<0){vc1=0;}var pxd=(px3-px2);var pyd=(py3-py2);var d2=Math.sqrt(pxd*pxd+pyd*pyd)/_ad.zoomRatio;var vc3=d2/t2;if(_ad.moveCount==1){if(vc3>0.5){vc3=0.5;t2=d2/vc3;}}else{if(vc3>vc1+0.25){vc3=vc1+0.25;t2=d2/vc3;}else{if(vc3<vc1-0.25){vc3=vc1-0.25;t2=d2/vc3;}}}var ac0=_b9.acs;var ac2=(vc3-vc1)/t2;var ag0=_b9.ang;var ag2=this.getAngleOfLineSegment(px2,py2,px3,py3);if(ag2==null){ag2=ag0;}var _bc=this.valSmooth;var _bd=this.acsSmooth;var _be=this.radiusSmooth;var _bf=this.alphaSmooth;if(_b0){_be=0;}var _c0=(_bc>_bd)?_bc:_bd;if(_c0<12){_c0=12;}if(_b2==false){_ad.moveSum+=d2;var _c1;_c1={"val":vc3,"acs":ac2,"ang":ag2,"x":_b3,"y":_b4,"tm":t2,"stt":_af,"dst":d2,"bend":false,"abnd":false,"rbnd":0,"ruvl":0,"ufac":0,"xfvl":0};_ad.lastData.push(_c1);if(_ad.lastData.length>_c0){_ad.lastData.shift();}}else{var xxx=1;}var _c2=this.angleThres;var _c3=this.angleTrig;var v1,v3,ax2;if(this.smoothing==false){v1=vc1;v3=vc3;ax2=ac2;}else{var _c4=_ad.lastData[_ad.lastData.length-1];v1=_ad.lastVal;_c4["ruvl"]=this.getRareUniVal(_ad.lastData,30);this.findBend(_ad.lastData,_ad.moveSum,8,_c2,_c3,_c0,_ad.zoomRatio);_c4["ufac"]=this.getUniAcs(_ad.lastData,30);_c4["xfvl"]=this.getExUniVal(_ad.lastData,90,60,0.2,0.5);v3=_c4["xfvl"];ax2=_c4["ufac"];}var _c5=this.coExpornent;var _c6=this.accelRatio;var _c7=this.decelRatio;var _c8=this.minValAccel;var _c9=this.zoopRatio;var _ca=this.loopDivValue;var _cb=this.vxRatio;var _cc=this.axRatio;if(_b0==false){if(this.startSharpness>0){var _cd=_b7+_b8;var _ce=_ad.moveSum+_ad.moveCount;if(_cd<this.startSharpness){if(_ce>this.startSharpness){_ce=this.startSharpness;}var _cf=(_cd+_ce)/2;_b6=_b6*_cf/this.startSharpness;}}if(_b1){if(_ad.endingBonus==0){_ad.endingBonus=this.endingValBonus;}else{_ad.endingBonus*=this.endingValRatio;}v1+=_ad.endingBonus;v3+=_ad.endingBonus*this.endingValRatio;}}else{_b6*=0.5;v3*=this.dotValRatio;}var x1,y1,x2,y2,x3,y3,dd1,dd2;x1=(px1+px2)/2;y1=(py1+py2)/2;dd1=d1/2;x2=px2;y2=py2;x3=(px2+px3)/2;y3=(py2+py3)/2;dd2=d2/2;var v2,a1,a2,a3;if(_b2==true){v2=v1;a1=a2=a3=_ad.lastAcs;}else{if(_ad.moveCount==1){v2=v3;a1=a2=a3=0;}else{v2=(v1+v3)/2;a1=_ad.lastAcs;a3=(v3-v1)/t2;a2=(a3-a1)/2;}}var va3;if(a3>=0){va3=v3+a3*_c6;}else{va3=v3+a3*_c7;}va3=va3*_cb+ax2*_cc;if(va3<_c8){va3=_c8;}var rd1=_ad.lastRadius;if(rd1<0){var va1;if(a1>=0){va1=v1+a1*_c6;}else{va1=v1+a1*_c7;}va1=va1*_cb+ax2*_cc;if(va1<_c8){va1=_c8;}rd1=(_b5+_b6*Math.exp(_c5*va1));}var rd3=(_b5+_b6*Math.exp(_c5*va3));var _d0=(rd1+rd3)/(2*_ad.zoomRatio);if(_b1){_d0+=this.endingRaveBonus;}var _d1,_d2,_d3;if(InkTool.InkLib.needsEmulateCanvas()){_d1=1;_d2=8;}else{_d1=4;_d2=1;}_d3=0.5;var _d4=Math.round((dd1+dd2)*_ad.zoomRatio/_d2);if(_d4<1){_d4=1;}var _d5=Math.round((dd1+dd2)*_ad.zoomRatio/_d3);if(_d5<1){_d5=1;}var _d6=(dd1+dd2)/_d0*_d1;var _d7=Math.round(_d6);if(_d7<1){_d7=1;}var _d8=this.getPenColor();var _d9;var _da,_db;var _dc=va3;if(_dc<=0.0001){_dc=0.0001;}if(this.feltmode==true){_da=1/(_dc*this.vBeta*_c9);_db=this.aExp;}else{if(this.transparency==true){_da=1/Math.sqrt(_dc*this.vBeta*_c9);_db=this.aExp;}else{_da=this.vBeta;_db=this.aExp;}}var _dd=1-Math.exp(_db*_d0);if(_da<_dd){_dd=_da;}var _de=_d8.A*_dd;var _df;if(_b0==true){if(this.feltmode==true){_de/=2;}_df=2;}else{_df=_d1*2*_d7/_d6;}if(_d7<=0){}else{if(_d7<_d4){_df*=(_d4/_d7);_be*=(_d4/_d7);_bf*=(_d4/_d7);_d7=_d4;}else{if(_d7>_d5){_df*=(_d5/_d7);_be*=(_d5/_d7);_bf*=(_d5/_d7);_d7=_d5;}}}var _e0=1-Math.pow((255-_de)/255,1/_df);_d9=_e0;if(_b2==true||_ad.moveCount==1){var xs,ys,xe,ye,vs,ve,as;var rs=_ad.lastRadius;var re;var gs=_ad.lastGamma;var ge=_d9;if(gs<0){gs=_d9;}var _e1=_d7;if(_b2==true){xs=x1;ys=y1;xe=x2;ye=y2;vs=v1;if(ax2>0){ve=v1+ax2*t1;}else{ve=v1;}as=a1;_e1++;}else{xs=x2;ys=y2;xe=x3;ye=y3;vs=v3;ve=v3;as=a3;}if(rs<0){rs=(_b5+_b6*Math.exp(_c5*vs));}var dva;if(as>=0){dva=ve+as*_c6;}else{dva=ve+as*_c7;}dva=dva*_cb+ax2*_cc;if(dva<_c8){dva=_c8;}re=(_b5+_b6*Math.exp(_c5*dva));var _e2=_ad.lastRadius;if(_e2<0){_e2=rs;}var _e3=_ad.lastAlpha;if(_e3<0){_e3=gs;}for(var idx=0;idx<_e1;idx++){var dt=idx/_d7;var dx=xs+(xe-xs)*dt;var dy=ys+(ye-ys)*dt;var dr=rs+(re-rs)*dt;var dg=gs+(ge-gs)*dt;if(_bf<=1){_e3=dg;}else{_e3=(_e3*(_bf-1)+dg)/_bf;}if(_be<=1){_e2=dr;}else{_e2=(_e2*(_be-1)+dr)/_be;}if(_ad.isCircleInRect(dx,dy,_e2)){var _e4="rgba("+_d8.R+","+_d8.G+","+_d8.B+","+_e3.toFixed(5)+")";ctx.fillStyle=_e4;ctx.beginPath();ctx.arc(dx,dy,_e2,0,Math.PI*2,false);ctx.fill();}}_ad.lastRadius=_e2;_ad.lastAlpha=_e3;}else{if(_bb==5){var xs,ys,xe,ye,vs,ve,as;xs=x1;ys=y1;xe=x2;ye=y2;vs=v1;ve=v2;as=a1;var gs=_ad.lastGamma;if(gs<0){gs=_d9;}var ge=(gs+_d9)/2;var _e5=Math.round(_d7*dd1/(dd1+dd2));if(_e5<1){_e5=1;}var _e6=_d7-_e5;_d7=_e5;for(var bct=0;bct<2;bct++){var rs,re;rs=_ad.lastRadius;if(rs<0){rs=(_b5+_b6*Math.exp(_c5*vs));}var dva;if(as>=0){dva=ve+as*_c6;}else{dva=ve+as*_c7;}dva=dva*_cb+ax2*_cc;if(dva<_c8){dva=_c8;}re=(_b5+_b6*Math.exp(_c5*dva));var _e2=_ad.lastRadius;if(_e2<0){_e2=rs;}var _e3=_ad.lastAlpha;if(_e3<0){_e3=gs;}for(var idx=0;idx<_d7;idx++){var dt=idx/_d7;var dx=xs+(xe-xs)*dt;var dy=ys+(ye-ys)*dt;var dr=rs+(re-rs)*dt;var dg=gs+(ge-gs)*dt;if(_bf<=1){_e3=dg;}else{_e3=(_e3*(_bf-1)+dg)/_bf;}if(_be<=1){_e2=dr;}else{_e2=(_e2*(_be-1)+dr)/_be;}if(_ad.isCircleInRect(dx,dy,_e2)){var _e4="rgba("+_d8.R+","+_d8.G+","+_d8.B+","+_e3.toFixed(5)+")";ctx.fillStyle=_e4;ctx.beginPath();ctx.arc(dx,dy,_e2,0,Math.PI*2,false);ctx.fill();}}_ad.lastRadius=_e2;_ad.lastAlpha=_e3;xs=x2;ys=y2;xe=x3;ye=y3;vs=v2;ve=v3;as=a3;gs=ge;ge=_d9;_d7=_e6;}}else{var _e7=dd1;var _e8=dd2;var _e9=_e8-_e7;var mia=-_e7;var ap2=_e7*_e7;var bp2=_e8*_e8;var _ea=bp2-ap2;var r1=_ad.lastRadius;if(r1<0){r1=(_b5+_b6*Math.exp(_c5*v1));}var _eb,_ec;if(a2>=0){_eb=v2+a2*_c6;}else{_eb=v2+a2*_c7;}_eb=_eb*_cb+ax2*_cc;if(_eb<_c8){_eb=_c8;}if(a3>=0){_ec=v3+a3*_c6;}else{_ec=v3+a3*_c7;}_ec=_ec*_cb+ax2*_cc;if(_ec<_c8){_ec=_c8;}var r2=(_b5+_b6*Math.exp(_c5*_eb));var r3=(_b5+_b6*Math.exp(_c5*_ec));var g1=_ad.lastGamma;if(g1<0){g1=_d9;}var g3=_d9;var g2=(g1+g3)/2;var _e2=r1;var _e3=g1;var _ed=(Math.abs(_e9)<0.1);for(var idx=0;idx<_d7;idx++){var dt;if(_ed){dt=idx/_d7;}else{var _ee=idx/_d7;dt=(mia+Math.sqrt(ap2+_ea*_ee))/_e9;}var dx=x1*(1-dt)*(1-dt)+x2*2*dt*(1-dt)+x3*dt*dt;var dy=y1*(1-dt)*(1-dt)+y2*2*dt*(1-dt)+y3*dt*dt;var dr=r1*(1-dt)*(1-dt)+r2*2*dt*(1-dt)+r3*dt*dt;var dg=g1*(1-dt)*(1-dt)+g2*2*dt*(1-dt)+g3*dt*dt;if(_bf<=1){_e3=dg;}else{_e3=(_e3*(_bf-1)+dg)/_bf;}if(_be<=1){_e2=dr;}else{_e2=(_e2*(_be-1)+dr)/_be;}if(_ad.isCircleInRect(dx,dy,_e2)){var _e4="rgba("+_d8.R+","+_d8.G+","+_d8.B+","+_e3.toFixed(5)+")";ctx.fillStyle=_e4;ctx.beginPath();ctx.arc(dx,dy,_e2,0,Math.PI*2,false);ctx.fill();}}_ad.lastRadius=_e2;_ad.lastAlpha=_e3;}}_ad.lastVal=v3;_ad.lastAcs=a3;_ad.lastGamma=_d9;},findBend:function(_ef,_f0,_f1,_f2,_f3,_f4,_f5){_f2=Math.PI/8;_f3=Math.PI/2;var _f6=4;var _f7=Math.PI/3;var _f8=2;var _f9=2;var _fa=_ef.length;if(_fa==0){return;}var _fb;_fb=_ef[_fa-1].ruvl;var _fc=1/16;var _fd=_ef[_fa-1].ang;var _fe=0;if(_fa>_f4){_fe=_fa-_f4;}if(_f3>0&&_fa>=2){var _ff=_ef[_fa-1].x;var finy=_ef[_fa-1].y;var _100=_ef[_fa-2].x;var _101=_ef[_fa-2].y;var _102=_100;var _103=_101;var _104=false;var _105=false;var _106=_f0;for(var idx=_fa-2;idx>=_fe;idx--){_106-=_ef[idx+1].dst;if(_106<_f1){continue;}var val=_ef[idx].ruvl;var _107=this.getAngleDiff(_ef[idx].ang,_fd);if(_107!=null){var daxp=_ff-_102;var dayp=finy-_103;var _108=Math.sqrt(daxp*daxp+dayp*dayp)/_f5;var _109=_ef[idx].x;var _10a=_ef[idx].y;var dxp=_102-_109;var dyp=_103-_10a;var dist=Math.sqrt(dxp*dxp+dyp*dyp)/_f5;if(_108>=_f9&&((_107>=_f3&&dist<=_f6)||(_107>=_f7&&dist<=_f8))){var tval=_ef[idx].ruvl;var tnum=1;var aidx=_fa-1;for(var tct=idx+1;tct<_fa-1;tct++){var _10b=this.getAngleDiff(_ef[tct].ang,_fd);if(_10b!=null&&_10b<=_f2&&_ef[tct].acs>0){aidx=tct;break;}}_ef[_fa-1].bend=true;_ef[aidx].abnd=true;if(_fb>=_fc&&tval<_fc){_ef[_fa-1].rbnd=3;_ef[aidx].rbnd=3;}else{_ef[_fa-1].rbnd=2;_ef[aidx].rbnd=2;}_104=true;}if(idx>0){var _10c=_ef[idx-1].x;var _10d=_ef[idx-1].y;var doxp=_100-_10c;var doyp=_101-_10d;var _10e=Math.sqrt(doxp*doxp+doyp*doyp)/_f5;if(_10e<_f9){_102=_10c;_103=_10d;_fd=_ef[idx].ang;}}}if(_fb>=_fc&&val<_fc){_ef[idx+1].bend=true;_ef[idx+1].abnd=true;_ef[idx+1].rbnd=1;_105=true;}if(_104&&_105){break;}}}},getAveVal:function(_10f,_110){var min=10000000;var max=0;var _111=-1;var _112=-1;var _113=_10f.length;var _114=0;if(_113>_110){_114=_113-_110;}for(var idx=_113-1;idx>=_114;idx--){if(_10f[idx].bend==true){_114=idx;break;}}var anum=0;for(var idx=_114;idx<_113;idx++){var val=_10f[idx].val;if(val<0){continue;}if(val<min){_111=idx;min=val;}if(val>max){_112=idx;max=val;}anum++;}var num=0;var sum=0;for(var idx=_114;idx<_113;idx++){var val=_10f[idx].val;if(val<0){continue;}else{if(idx==_111||idx==_112){if(anum<=2){sum+=val;num++;}else{if(anum<5){var rate=(anum-2)/3;sum+=val*rate;num+=rate;}}}else{sum+=val;num++;}}}var resp;if(num==0){resp=0;}else{resp=sum/num;}return resp;},getAveAcs:function(_115,_116){var min=10000000;var max=0;var _117=-1;var _118=-1;var _119=_115.length;var _11a=0;if(_119>_116){_11a=_119-_116;}for(var idx=_119-1;idx>=_11a;idx--){if(_115[idx].abnd==true){_11a=idx;break;}}var anum=0;for(var idx=_11a;idx<_119;idx++){var val=_115[idx].val;var acs=_115[idx].acs;if(val<0){continue;}if(acs<min){_117=idx;min=acs;}if(acs>max){_118=idx;max=acs;}anum++;}var num=0;var sum=0;for(var idx=_11a;idx<_119;idx++){var val=_115[idx].val;var acs=_115[idx].acs;if(val<0){continue;}else{if(idx==_117||idx==_118){if(anum<=2){sum+=acs;num++;}else{if(anum<5){var rate=(anum-2)/3;sum+=acs*rate;num+=rate;}}}else{sum+=acs;num++;}}}var resp;if(num==0){resp=0;}else{resp=sum/num;}return resp;},getRareUniVal:function(_11b,_11c){var _11d=0;var _11e=0;var _11f=0;var _120=_11b.length;for(var idx=_120-1;idx>=0;idx--){var time=_11b[idx].tm;var dist=_11b[idx].dst;if(_11d+time>_11c){break;}_11d+=time;_11e+=dist;_11f++;}var resp;if(_11f==0||_11d==0){if(_120==0){resp=0;}else{resp=_11b[_120-1].val;if(resp<0){resp=0;}}}else{resp=_11e/_11d;}return resp;},getUniVal:function(_121,_122){var _123=0;var _124=0;var _125=0;var _126=_121.length;for(var idx=_126-1;idx>=0;idx--){var time=_121[idx].tm;var dist=_121[idx].dst;if(_123+time>_122){break;}else{if(_121[idx].bend==true){break;}}_123+=time;_124+=dist;_125++;}var resp;if(_125==0||_123==0){if(_126==0){resp=0;}else{resp=_121[_126-1].ruvl;}}else{resp=_124/_123;}return resp;},getExUniVal:function(_127,_128,_129,_12a,_12b){var _12c=_128;if(_127.length>0){var val=_127[_127.length-1].ruvl;if(val<=_12a){_12c=_128;}else{if(val>=_12b){_12c=_129;}else{_12c=_128+(_129-_128)*(val-_12a)/(_12b-_12a);}}}return this.getUniVal(_127,_12c);},getValEnergy:function(_12d,_12e,_12f){var resp=0;if(_12d.length>1){var _130=_12d[_12d.length-1].xfvl;var _131=_12d[_12d.length-2].xfvl;var _132=_12d[_12d.length-2].engv;if(_130>=_131){var usep=_131*_12e;var lost=_132*usep;resp=_132-lost;if(resp<0){resp=0;}}else{resp=_132+(_131-_130);}}return resp;},getExAdd:function(_133,_134,_135,_136,_137,_138){var resp=0;if(_133.length>1){var _139=_133[_133.length-1].xfvl;var _13a=_133[_133.length-2].xfvl;var _13b=_133[_133.length-1].engv;if(_139>=_13a){var mul;if(_139>=_135){mul=_134;}else{mul=_134*_139/_135;}var mul2;var _13c=_139-_13a;if(_13c>=_136){mul2=1;}else{mul2=_13c/_136;}resp=_13b*mul*mul2;var _13d=_138-_139;if(_13d<_137){_13d=_137;}if(resp>_13d){resp=_13d;}}else{resp=0;}}return resp;},getExVal:function(_13e,_13f,_140){var _141=0;var _142=0;var _143=_13e.length;for(var idx=_143-1;idx>=0;idx--){var time=_13e[idx].tm;var eng=_13e[idx].enga;if(_141+time>_13f){break;}_141+=time;_142+=eng*time;}var _144,resp;if(_141==0){_144=_13e[_143-1].enga;}else{_144=_142/_141;}resp=_13e[_143-1].xfvl+_144;if(_143>1){var _145=_13e[_143-2].exvl;var _146=0.125;var _147=0.125;if(resp>_145+_146){resp=_145+_146;}else{if(resp<_145-_147){resp=_145-_147;}}}if(_13e.length>3){var _148=0;var _149=_13e[_13e.length-4].val;var _14a=_13e[_13e.length-3].val;var _14b=_13e[_13e.length-2].val;var _14c=_13e[_13e.length-1].val;var _14d=_13e[_13e.length-1].engv;if(_14a>=_149+0.05&&_14b>=_14a+0.05&&_14c>=_14b+0.05&&_14c>=_149+0.3){_148=-0.1+(_14c-_149);}else{if(_14b>=_14a+0.05&&_14c>=_14b+0.05&&_14c>=_14a+0.2){_148=-0.1+(_14c-_14a);}}if(_14d<0.05){var _14e=_14d/0.05;_148=_148*_14e*_14e;}if(resp>=0.5){var _14f=0.5/resp;_148=_148*_14f*_14f*_14f*_14f;}resp+=_148*_140;}return resp;},getUniAcs:function(_150,_151){var _152=0;var _153=-1;var _154=_150.length;for(var idx=_154-1;idx>=0;idx--){var time=_150[idx].tm;_153=_150[idx].ruvl;if(_152+time>_151){break;}else{if(_150[idx].abnd==true){break;}}_152+=time;}var resp;if(_152==0){if(_154==0){resp=0;}else{resp=_150[_154-1].acs;}}else{resp=(_150[_154-1].ruvl-_153)/_152;}return resp;},getUniAng:function(_155,_156){var _157=_155.length;var xp=_155[_157-1].x;var yp=_155[_157-1].y;var _158=false;var _159=0;var _15a=0;for(var idx=_157-2;idx>=0;idx--){var xo=_155[idx].x;var yo=_155[idx].y;var dx=(xp-xo);var dy=(yp-yo);var dist=(dx*dx)+(dy*dy);if(dist>=_156){_159=xo;_15a=yo;_158=true;break;}}var resp;if(_158==false){if(_157==0){resp=0;}else{resp=_155[_157-1].ang;}}else{resp=this.getAngleOfLineSegment(_159,_15a,xp,yp);}return resp;},getDifAng:function(_15b,_15c){var _15d=_15b.length;var xp=_15b[_15d-1].x;var yp=_15b[_15d-1].y;var _15e=-1;var _15f=0;var _160=0;for(var idx=_15d-2;idx>=0;idx--){var xo=_15b[idx].x;var yo=_15b[idx].y;var dx=(xp-xo);var dy=(yp-yo);var dist=(dx*dx)+(dy*dy);if(dist>=_15c){_15e=idx;_15f=xo;_160=yo;break;}}var resp;if(_15e<0){resp=0;}else{var ang=this.getAngleOfLineSegment(_15f,_160,xp,yp);resp=this.getAngleDiff(ang,_15b[_15e].ufag);}return resp;},getAngleDiff:function(_161,_162){if(_161==null||_162==null){return null;}var _163=Math.abs(_161-_162);if(_163>Math.PI){_163=2*Math.PI-_163;}return _163;},getAngleOfLineSegment:function(x1,y1,x2,y2){return this.getAngleOfVector(x2-x1,y2-y1);},getAngleOfVector:function(xp,yp){var dist,_164;dist=xp*xp+yp*yp;if(dist==0){return null;}_164=Math.acos(xp/Math.sqrt(dist));if(yp<0){_164=2*Math.PI-_164;}return _164;},strokePause:function(_165,xp,yp,wd,tm){this.strokeMoveStat(_165,xp,yp,wd,tm,3);},strokeMoveFeature:function(_166,xp,yp,wd,tm){this.strokeMoveStat(_166,xp,yp,wd,tm,4);},strokeMoveBend:function(_167,xp,yp,wd,tm){this.strokeMoveStat(_167,xp,yp,wd,tm,5);},strokeMoveBendLater:function(_168,xp,yp,wd,tm){var _169=_168.lastData[_168.lastData.length-1];_169.stt=5;},strokeMoveToEnd:function(_16a,xp,yp,wd,tm){this.strokeMoveStat(_16a,xp,yp,wd,tm,6);},strokeEnd:function(_16b,xp,yp,wd,tm){_16b.timeStr="";var ctx=_16b.context;if(tm<=_16b.lastTime+8){tm=_16b.lastTime+8;}var _16c=_16b.queuePoints.length+1;if(_16b.moveCount<=1){_16c+=(2-_16b.moveCount);}var _16d=(tm-_16b.lastTime)/_16c;var _16e=_16d;var _16f,_170;while(_16b.queuePoints.length>0){var _171=_16b.queuePoints.shift();_16f=_16b.xpDataToDraw(_171.x);_170=_16b.ypDataToDraw(_171.y);var dx=(_16f-_16b.lastDrawX);var dy=(_170-_16b.lastDrawY);if(dx==0&&dy==0){_16d+=_16e;continue;}var _172=_171.m;this.strokeMoveSub(_16b,_16f,_170,_16d,_172,false,true,false);_16b.lastDrawX=_16f;_16b.lastDrawY=_170;_16d=_16e;}_16f=_16b.xpDataToDraw(xp);_170=_16b.ypDataToDraw(yp);var vlx,vly,_173;var _174=_16b.lastData[_16b.lastData.length-1];if(_16b.moveCount<=5){var lxd=xp-_16b.startX;var lyd=yp-_16b.startY;var len=(lxd*lxd+lyd*lyd);if(len<=12.25){_173=true;}else{_173=false;}}else{_173=false;}if(_173==true){if(_16b.moveCount==0){this.strokeMoveSub(_16b,_174.x,_174.y,_16d,2,_173,true,false);vlx=_174.x;vly=_174.y;this.strokeMoveSub(_16b,vlx,vly,_16d,2,_173,true,false);}else{vlx=_174.x;vly=_174.y;this.strokeMoveSub(_16b,vlx,vly,_16d,2,_173,true,false);}}else{var lx=_16b.lastDrawX;var ly=_16b.lastDrawY;if(lx!=_16f||ly!=_170){this.strokeMoveSub(_16b,_16f,_170,_16d,2,_173,true,false);}vlx=_16f;vly=_170;}this.strokeMoveSub(_16b,vlx,vly,_16d,2,_173,true,true);},drawEnd:function(_175){},hasFullDrawMode:function(){return false;},isSpeedSensitive:function(){return true;},isPressureSensitive:function(){return false;},isAutomaticSwitchover:function(){return false;},getSubInfo:function(){return "FeltPen";}});}if(typeof InkTool.SpeedSenseFeltPen==="undefined"){InkTool.SpeedSenseFeltPen=InkTool.InkLib.Class.create(InkTool.InkFeltPen,{getSubInfo:function(){return "SpeedSenseFeltPen";}});}if(typeof InkTool.InkVariableBallpointPen==="undefined"){InkTool.InkVariableBallpointPen=InkTool.InkLib.Class.create(InkTool.InkFeltPen,{initialize:function(){this.tp=InkTool.InkPenType.SpeedSenseBallpointPen;this.col=new InkTool.InkColor("purple");this.w=1.5;this.minw=0.2;this.maxw=1.5;this.oldType=InkTool.InkPenType.Old_BallpointPen;this.transparency=false;this.smoothing=true;this.startSharpness=10;this.feltmode=false;this.coExpornent=-1.3;this.accelRatio=0;this.decelRatio=0;this.vxRatio=1;this.axRatio=3;this.angleThres=Math.PI/4;this.angleTrig=Math.PI/3;this.minValAccel=-0.01;this.zoopRatio=1.4;this.loopDivValue=24;if(InkTool.InkLib.Browser.MobileSafari){this.vBeta=0.95;this.aExp=-1.8;}else{this.vBeta=1;this.aExp=-2.4;}this.valSmooth=4;this.acsSmooth=3;this.radiusSmooth=2;this.alphaSmooth=0;this.endingValBonus=0.4;this.endingValRatio=2;this.dotValRatio=0.5;this.endingRaveBonus=0;},hasFullDrawMode:function(){return false;},isSpeedSensitive:function(){return true;},isPressureSensitive:function(){return false;},isAutomaticSwitchover:function(){return false;},getSubInfo:function(){return "VariableBallpointPen";}});}if(typeof InkTool.SpeedSenseBallpointPen==="undefined"){InkTool.SpeedSenseBallpointPen=InkTool.InkLib.Class.create(InkTool.InkVariableBallpointPen,{getSubInfo:function(){return "SpeedSenseBallpointPen";}});}if(typeof InkTool.InkVariableSignPen==="undefined"){InkTool.InkVariableSignPen=InkTool.InkLib.Class.create(InkTool.InkFeltPen,{initialize:function(){this.tp=InkTool.InkPenType.SpeedSenseSignPen;this.col=new InkTool.InkColor("black");this.w=1.5;this.minw=0.2;this.maxw=1.5;this.oldType=InkTool.InkPenType.Old_VariableSignPen;this.transparency=true;this.smoothing=true;this.startSharpness=7;this.feltmode=false;this.coExpornent=-1.3;this.accelRatio=0;this.decelRatio=0;this.vxRatio=1;this.axRatio=3;this.angleThres=Math.PI/4;this.angleTrig=Math.PI/3;this.minValAccel=-0.01;this.zoopRatio=1;this.loopDivValue=24;this.vBeta=2.8;this.aExp=-1.2;this.valSmooth=8;this.acsSmooth=6;this.radiusSmooth=2;this.alphaSmooth=1;this.endingValBonus=0.2;this.endingValRatio=2;this.dotValRatio=0.5;this.endingRaveBonus=0.5;},hasFullDrawMode:function(){return false;},isSpeedSensitive:function(){return true;},isPressureSensitive:function(){return false;},isAutomaticSwitchover:function(){return false;},getSubInfo:function(){return "VariableSignPen";}});}if(typeof InkTool.SpeedSenseSignPen==="undefined"){InkTool.SpeedSenseSignPen=InkTool.InkLib.Class.create(InkTool.InkVariableSignPen,{getSubInfo:function(){return "SpeedSenseSignPen";}});}if(typeof InkTool.InkVariableFudePen==="undefined"){InkTool.InkVariableFudePen=InkTool.InkLib.Class.create(InkTool.InkFeltPen,{initialize:function(){this.tp=InkTool.InkPenType.SpeedSenseFudePen;this.col=new InkTool.InkColor("black");this.w=1.5;this.minw=0.2;this.maxw=1.5;this.oldType=InkTool.InkPenType.Old_VariableFudePen;this.transparency=true;this.smoothing=true;this.startSharpness=20;this.feltmode=false;this.coExpornent=-1.5;this.accelRatio=24;this.decelRatio=12;this.vxRatio=1;this.axRatio=0;this.angleThres=Math.PI/4;this.angleTrig=Math.PI/3;this.minValAccel=-0.3;this.zoopRatio=1.5;this.loopDivValue=2;this.vBeta=2.8;this.aExp=-1.2;this.valSmooth=8;this.acsSmooth=6;this.radiusSmooth=0;this.alphaSmooth=0;this.endingValBonus=0.3;this.endingValRatio=2;this.dotValRatio=0.5;this.endingRaveBonus=0.5;},hasFullDrawMode:function(){return false;},isSpeedSensitive:function(){return true;},isPressureSensitive:function(){return false;},isAutomaticSwitchover:function(){return false;},getSubInfo:function(){return "VariableFudePen";}});}if(typeof InkTool.SpeedSenseFudePen==="undefined"){InkTool.SpeedSenseFudePen=InkTool.InkLib.Class.create(InkTool.InkVariableFudePen,{getSubInfo:function(){return "SpeedSenseFudePen";}});}if(typeof InkTool.SpeedSenseSchoolPen==="undefined"){InkTool.SpeedSenseSchoolPen=InkTool.InkLib.Class.create(InkTool.InkStationery,{initialize:function(){this.tp=InkTool.InkPenType.SpeedSenseSchoolPen;this.col=new InkTool.InkColor("darkred");this.w=2;this.minw=1;this.maxw=5;this.oldType=InkTool.InkPenType.SpeedSenseSchoolPen;},drawStart:function(_176){var ctx=_176.context;ctx.strokeStyle=this.getPenColor().getRGBA();ctx.fillStyle=this.getPenColor().getRGBA();ctx.globalCompositeOperation="source-over";ctx.lineWidth=_176.widthDataToDraw(this.getPenWidth());ctx.lineCap="butt";ctx.lineJoin="round";},strokeStart:function(_177,xp,yp,wd,tm){var ctx=_177.context;var _178=_177.xpDataToDraw(xp);var _179=_177.ypDataToDraw(yp);_177.lastData=[];_177.llastX=_177.lastX=_178;_177.llastY=_177.lastY=_179;_177.moveCount=0;var _17a=this.getPenColor().A;_177.dlen=this.getDLenByAlpha(_17a);},strokeMove:function(_17b,xp,yp,wd,tm){return this.strokeMoveSub(_17b,xp,yp,wd,tm);},strokeMoveSub:function(_17c,xp,yp,wd,tm){var ctx=_17c.context;var _17d=_17c.xpDataToDraw(xp);var _17e=_17c.ypDataToDraw(yp);if(_17d==_17c.lastX&&_17e==_17c.lastY){return;}var x1=(_17c.lastX+_17c.llastX)/2;var y1=(_17c.lastY+_17c.llastY)/2;var x2=_17c.lastX;var y2=_17c.lastY;var x3=(_17c.lastX+_17d)/2;var y3=(_17c.lastY+_17e)/2;var dlen=_17c.dlen;var dx1=(x1-x2);var dy1=(y1-y2);var dd1=Math.sqrt(dx1*dx1+dy1*dy1);var dx3=(x3-x2);var dy3=(y3-y2);var dd3=Math.sqrt(dx3*dx3+dy3*dy3);var x3m=x3;var y3m=y3;if(dd3>0){var px3=dx3*dlen/dd3;var py3=dy3*dlen/dd3;x3m+=px3;y3m+=py3;}if(_17c.moveCount>0){var x1m=x1;var y1m=y1;if(dd1>0){var px1=dx1*dlen/dd1;var py1=dy1*dlen/dd1;x1m+=px1;y1m+=py1;}ctx.beginPath();ctx.moveTo(x1m,y1m);ctx.quadraticCurveTo(x2,y2,x3m,y3m);ctx.stroke();}else{if(dd1+dd3>=_17c.lengthDataToDraw(4)){var rd1=_17c.widthDataToDraw(this.getPenWidth())/2;var ddx3=dx3*rd1/dd3;var ddy3=dy3*rd1/dd3;var x3a=x3m-ddy3;var y3a=y3m+ddx3;var x3b=x3m+ddy3;var y3b=y3m-ddx3;ctx.beginPath();ctx.moveTo(x3a,y3a);ctx.lineTo(x1,y1);ctx.lineTo(x3b,y3b);ctx.closePath();ctx.fill();}else{var xc=x2;var yc=y2;var x2m=x2;var y2m=y2;if(dd3>0){var px2=dx3*dlen/dd3;var py2=dy3*dlen/dd3;xc+=px2;yc+=py2;x2m-=px2;y2m-=py2;}var _17f=_17c.widthDataToDraw(this.getPenWidth())/2;var _180;if(dx3==0){if(dy3>0){_180=Math.PI/2;}else{if(dy3==0){_180=-100;}else{_180=Math.PI*3/2;}}}else{_180=Math.atan(Math.abs(dy3/dx3));if(dx3>=0){if(dy3<0){_180=Math.PI*2-_180;}}else{if(dy3>=0){_180=Math.PI-_180;}else{_180=Math.PI+_180;}}}var _181,_182;if(_180==-100){_181=0;_182=Math.PI*2;}else{_181=_180+Math.PI/2;if(_181>Math.PI*2){_181-=Math.PI*2;}_182=_180-Math.PI/2;if(_182<0){_182+=Math.PI*2;}}ctx.beginPath();ctx.arc(xc,yc,_17f,_181,_182,false);ctx.fill();ctx.beginPath();ctx.moveTo(x2m,y2m);ctx.lineTo(x3m,y3m);ctx.stroke();}}_17c.llastX=_17c.lastX;_17c.llastY=_17c.lastY;_17c.lastX=_17d;_17c.lastY=_17e;_17c.moveCount++;},strokeEnd:function(_183,xp,yp,wd,tm){var ctx=_183.context;var _184=_183.xpDataToDraw(xp);var _185=_183.ypDataToDraw(yp);var x1=(_183.lastX+_183.llastX)/2;var y1=(_183.lastY+_183.llastY)/2;var x2=_183.lastX;var y2=_183.lastY;var x3=_184;var y3=_185;var dlen=_183.dlen;var dx1=(x1-x2);var dy1=(y1-y2);var dd1=Math.sqrt(dx1*dx1+dy1*dy1);var x1m=x1;var y1m=y1;if(dd1>0){var px1=dx1*dlen/dd1;var py1=dy1*dlen/dd1;x1m+=px1;y1m+=py1;}var dx2=(x2-x1);var dy2=(y2-y1);var dd2=Math.sqrt(dx2*dx2+dy2*dy2);var dx3=(x3-x2);var dy3=(y3-y2);var dd3=Math.sqrt(dx3*dx3+dy3*dy3);if(_183.moveCount==0){var _186=_183.widthDataToDraw(this.getPenWidth())/2;var _187,_188;_187=0;_188=Math.PI*2;ctx.beginPath();ctx.arc(x3,y3,_186,_187,_188,false);ctx.fill();}else{if(dd2+dd3<_183.lengthDataToDraw(8)){var xc=x3;var yc=y3;if(x2==x3&&y2==y3){dx3=dx2;dy3=dy2;dd3=dd2;var x3m=x3;var y3m=y3;if(dd2>0){var px3=dx3*dlen/dd3;var py3=dy3*dlen/dd3;x3m+=px3;y3m+=py3;xc-=px3;yc-=py3;}ctx.beginPath();ctx.moveTo(x1m,y1m);ctx.lineTo(x3m,y3m);ctx.stroke();}else{var x3m=x3;var y3m=y3;if(dd3>0){var px3=dx3*dlen/dd3;var py3=dy3*dlen/dd3;x3m+=px3;y3m+=py3;xc-=px3;yc-=py3;}ctx.beginPath();ctx.moveTo(x1m,y1m);ctx.quadraticCurveTo(x2,y2,x3m,y3m);ctx.stroke();}var _186=_183.widthDataToDraw(this.getPenWidth())/2;var _189;if(dx3==0){if(dy3>0){_189=Math.PI/2;}else{if(dy3==0){_189=-100;}else{_189=Math.PI*3/2;}}}else{_189=Math.atan(Math.abs(dy3/dx3));if(dx3>=0){if(dy3<0){_189=Math.PI*2-_189;}}else{if(dy3>=0){_189=Math.PI-_189;}else{_189=Math.PI+_189;}}}var _187,_188;if(_189==-100){_187=0;_188=Math.PI*2;}else{_187=_189-Math.PI/2;if(_187<0){_187+=Math.PI*2;}_188=_189+Math.PI/2;if(_188>Math.PI*2){_188-=Math.PI*2;}}ctx.beginPath();ctx.arc(xc,yc,_186,_187,_188,false);ctx.fill();}else{var rd1=_183.widthDataToDraw(this.getPenWidth())/2;var ddx1=dx2*rd1/dd2;var ddy1=dy2*rd1/dd2;var x1a=x1m-ddy1;var y1a=y1m+ddx1;var x1b=x1m+ddy1;var y1b=y1m-ddx1;var rd2=rd1*dd3/(dd2+dd3);var ddx2=dx3*rd2/dd3;var ddy2=dy3*rd2/dd3;var x2a=x2-ddy2;var y2a=y2+ddx2;var x2b=x2+ddy2;var y2b=y2-ddx2;if(x2==x3&&y2==y3){ctx.beginPath();ctx.moveTo(x1a,y1a);ctx.lineTo(x3,y3);ctx.lineTo(x1b,y1b);ctx.closePath();ctx.fill();}else{ctx.beginPath();ctx.moveTo(x1a,y1a);ctx.quadraticCurveTo(x2a,y2a,x3,y3);ctx.quadraticCurveTo(x2b,y2b,x1b,y1b);ctx.closePath();ctx.fill();}}}_183.llastX=_183.lastX;_183.llastY=_183.lastY;_183.lastX=_184;_183.lastY=_185;},drawEnd:function(_18a){},fullDrawStart:function(_18b){var ctx=_18b.context;ctx.strokeStyle=this.getPenColor().getRGBA();ctx.fillStyle=this.getPenColor().getRGBA();ctx.globalCompositeOperation="source-over";ctx.lineWidth=_18b.widthDataToDraw(this.getPenWidth());ctx.lineCap="butt";ctx.lineJoin="round";},fullStrokeStart:function(_18c,xp,yp,wd,tm){var ctx=_18c.context;var _18d=_18c.xpDataToDraw(xp);var _18e=_18c.ypDataToDraw(yp);ctx.strokeStyle=this.getPenColor().getRGBA();ctx.fillStyle=this.getPenColor().getRGBA();_18c.llastX=_18c.lastX=_18d;_18c.llastY=_18c.lastY=_18e;_18c.lastData=[];_18c.moveCount=0;var _18f=this.getPenColor().A;_18c.dlen=this.getDLenByAlpha(_18f);},fullStrokeMove:function(_190,xp,yp,wd,tm){this.fullStrokeMoveSub(_190,xp,yp,wd,tm);},fullStrokeMoveSub:function(_191,xp,yp,wd,tm){var ctx=_191.context;var _192=_191.xpDataToDraw(xp);var _193=_191.ypDataToDraw(yp);if(_192==_191.lastX&&_193==_191.lastY){return;}var x1=(_191.lastX+_191.llastX)/2;var y1=(_191.lastY+_191.llastY)/2;var x2=_191.lastX;var y2=_191.lastY;var x3=(_191.lastX+_192)/2;var y3=(_191.lastY+_193)/2;if(_191.moveCount>0){ctx.quadraticCurveTo(x2,y2,x3,y3);}else{var dlen=_191.dlen;var dx1=(x1-x2);var dy1=(y1-y2);var dd1=Math.sqrt(dx1*dx1+dy1*dy1);var dx3=(x3-x2);var dy3=(y3-y2);var dd3=Math.sqrt(dx3*dx3+dy3*dy3);var x3c=x3;var y3c=y3;var x3d=x3;var y3d=y3;if(dd3>0){var px3=dx3*dlen/dd3;var py3=dy3*dlen/dd3;x3c+=px3;y3c+=py3;x3d-=px3;y3d-=py3;}if(dd1+dd3>=_191.lengthDataToDraw(4)){var rd1=_191.widthDataToDraw(this.getPenWidth())/2;var ddx3=dx3*rd1/dd3;var ddy3=dy3*rd1/dd3;var x3a=x3c-ddy3;var y3a=y3c+ddx3;var x3b=x3c+ddy3;var y3b=y3c-ddx3;ctx.beginPath();ctx.moveTo(x3a,y3a);ctx.lineTo(x1,y1);ctx.lineTo(x3b,y3b);ctx.closePath();ctx.fill();ctx.beginPath();ctx.moveTo(x3d,y3d);}else{var xc=x2;var yc=y2;var x2m=x2;var y2m=y2;var dd2=Math.sqrt(dx3*dx3+dy3*dy3);if(dd2>0){var px2=dx3*dlen/dd2;var py2=dy3*dlen/dd2;xc+=px2;yc+=py2;x2m-=px2;y2m-=py2;}var _194=_191.widthDataToDraw(this.getPenWidth())/2;var _195;if(dx3==0){if(dy3>0){_195=Math.PI/2;}else{if(dy3==0){_195=-100;}else{_195=Math.PI*3/2;}}}else{_195=Math.atan(Math.abs(dy3/dx3));if(dx3>=0){if(dy3<0){_195=Math.PI*2-_195;}}else{if(dy3>=0){_195=Math.PI-_195;}else{_195=Math.PI+_195;}}}var _196,_197;if(_195==-100){_196=0;_197=Math.PI*2;}else{_196=_195+Math.PI/2;if(_196>Math.PI*2){_196-=Math.PI*2;}_197=_195-Math.PI/2;if(_197<0){_197+=Math.PI*2;}}ctx.beginPath();ctx.arc(xc,yc,_194,_196,_197,false);ctx.fill();ctx.beginPath();ctx.moveTo(x2m,y2m);ctx.lineTo(x3,y3);}}_191.llastX=_191.lastX;_191.llastY=_191.lastY;_191.lastX=_192;_191.lastY=_193;_191.moveCount++;},fullStrokePause:function(_198,xp,yp,wd,tm){this.fullStrokeMoveSub(_198,xp,yp,wd,tm);},fullStrokeMoveFeature:function(_199,xp,yp,wd,tm){this.fullStrokeMoveSub(_199,xp,yp,wd,tm);},fullStrokeMoveBend:function(_19a,xp,yp,wd,tm){this.fullStrokeMoveSub(_19a,xp,yp,wd,tm);this.fullStrokeMoveSub(_19a,xp+0.1,yp+0.1,wd,tm);},fullStrokeMoveToEnd:function(_19b,xp,yp,wd,tm){this.fullStrokeMoveSub(_19b,xp,yp,wd,tm);},fullStrokeEnd:function(_19c,xp,yp,wd,tm){if(_19c.moveCount>0){var ctx=_19c.context;var x1=(_19c.lastX+_19c.llastX)/2;var y1=(_19c.lastY+_19c.llastY)/2;var x2=_19c.lastX;var y2=_19c.lastY;var dlen=_19c.dlen;var dx1=(x1-x2);var dy1=(y1-y2);var dd1=Math.sqrt(dx1*dx1+dy1*dy1);var x1n=x1;var y1n=y1;if(dd1>0){var px1=dx1*dlen/dd1;var py1=dy1*dlen/dd1;x1n-=px1;y1n-=py1;}ctx.lineTo(x1n,y1n);ctx.stroke();}this.strokeEnd(_19c,xp,yp,wd,tm);},fullDrawEnd:function(_19d){},hasFullDrawMode:function(){return true;},isSpeedSensitive:function(){return true;},isPressureSensitive:function(){return false;},isAutomaticSwitchover:function(){return false;},getSubInfo:function(){return "SchoolPen";}});}if(typeof InkTool.PressSenseFeltPen==="undefined"){InkTool.PressSenseFeltPen=InkTool.InkLib.Class.create(InkTool.InkStationery,{initialize:function(){this.tp=InkTool.InkPenType.PressSenseFeltPen;this.col=new InkTool.InkColor("purple");this.w=5;this.minw=3;this.maxw=8;this.oldType=-1;this.transparency=true;this.smoothing=true;this.feltmode=true;this.erasemode=false;this.zoopRatio=1.4;this.loopDivValue=2;this.valSmooth=8;this.acsSmooth=6;this.radiusSmooth=0;this.alphaSmooth=3;},drawStart:function(_19e){var ctx=_19e.context;if(this.erasemode==true){ctx.strokeStyle=this.getPenColor().getRGB();ctx.fillStyle=this.getPenColor().getRGB();ctx.globalCompositeOperation="destination-out";}else{ctx.strokeStyle=this.getPenColor().getRGBA();ctx.fillStyle=this.getPenColor().getRGBA();ctx.globalCompositeOperation="source-over";}ctx.lineWidth=_19e.widthDataToDraw(this.getPenWidth());ctx.lineCap="round";ctx.lineJoin="round";_19e.drawMinPenWidth=_19e.widthDataToDraw(this.getPenMinWidth());_19e.drawMaxPenWidth=_19e.widthDataToDraw(this.getPenMaxWidth());_19e.drawScalePenWidth=_19e.drawMaxPenWidth-_19e.drawMinPenWidth;},strokeStart:function(_19f,xp,yp,wd,tm){var ctx=_19f.context;var _1a0=_19f.xpDataToDraw(xp);var _1a1=_19f.ypDataToDraw(yp);var _1a2=_19f.widthDataToDraw(wd);_19f.llastDrawX=_1a0;_19f.llastDrawY=_1a1;_19f.llastDrawW=_1a2;_19f.lastDrawX=_1a0;_19f.lastDrawY=_1a1;_19f.lastDrawW=_1a2;_19f.llastTime=tm;_19f.lastTime=tm;_19f.firstDraw=true;_19f.moveCount=0;_19f.lastRadius=-1;_19f.lastAlpha=-1;_19f.timeStr="";},strokeMove:function(_1a3,xp,yp,wd,tm){_1a3.timeStr="";var _1a4=_1a3.xpDataToDraw(xp);var _1a5=_1a3.ypDataToDraw(yp);var _1a6=_1a3.widthDataToDraw(wd);var dx=(_1a4-_1a3.lastDrawX);var dy=(_1a5-_1a3.lastDrawY);if(dx==0&&dy==0){return;}this.strokeMoveSub(_1a3,_1a4,_1a5,_1a6,tm,false,false);_1a3.llastTime=_1a3.lastTime;_1a3.lastTime=tm;_1a3.llastDrawX=_1a3.lastDrawX;_1a3.llastDrawY=_1a3.lastDrawY;_1a3.llastDrawW=_1a3.lastDrawW;_1a3.lastDrawX=_1a4;_1a3.lastDrawY=_1a5;_1a3.lastDrawW=_1a6;},strokeMoveSub:function(_1a7,xp,yp,wp,tm,_1a8,_1a9){var ctx=_1a7.context;var _1aa=xp;var _1ab=yp;var _1ac=wp;var _1ad=_1a7.moveCount;_1a7.moveCount++;var px1=_1a7.llastDrawX;var py1=_1a7.llastDrawY;var pw1=_1a7.llastDrawW;var px2=_1a7.lastDrawX;var py2=_1a7.lastDrawY;var pw2=_1a7.lastDrawW;var px3=_1aa;var py3=_1ab;var pw3=_1ac;var pxd1=(px2-px1);var pyd1=(py2-py1);var pxd2=(px3-px2);var pyd2=(py3-py2);var d1=Math.sqrt(pxd1*pxd1+pyd1*pyd1)/_1a7.zoomRatio;var d2=Math.sqrt(pxd2*pxd2+pyd2*pyd2)/_1a7.zoomRatio;var _1ae=this.radiusSmooth;var _1af=this.alphaSmooth;var td1=_1a7.lastTime-_1a7.llastTime;var td2=tm-_1a7.lastTime;var _1b0=this.zoopRatio;var _1b1=this.loopDivValue;var x1,y1,w1,x2,y2,w2,x3,y3,w3,dd1,dd2,tdd1,tdd2;x1=(px1+px2)/2;y1=(py1+py2)/2;w1=(pw1+pw2)/2;x2=px2;y2=py2;w2=pw2;x3=(px2+px3)/2;y3=(py2+py3)/2;w3=(pw2+pw3)/2;dd1=d1/2;dd2=d2/2;tdd1=td1/2;tdd2=td2/2;if(tdd1<=0){tdd1=1;}if(tdd2<=0){tdd2=1;}var wave,vave;if(_1a9==true){wave=(w2+w3)/2/_1a7.zoomRatio;vave=dd2/tdd2;}else{if(_1a7.moveCount==1){wave=(w2+w3)/2/_1a7.zoomRatio;vave=dd2/tdd2;}else{wave=(w1+w2*2+w3)/4/_1a7.zoomRatio;vave=(dd1/tdd1+dd2/tdd2)/2;}}var rave=wave/2;var _1b2,_1b3,_1b4;_1b2=4;_1b3=1;_1b4=0.5;var _1b5=Math.round((dd1+dd2)*_1a7.zoomRatio/_1b3);if(_1b5<1){_1b5=1;}var _1b6=Math.round((dd1+dd2)*_1a7.zoomRatio/_1b4);if(_1b6<1){_1b6=1;}var _1b7=(dd1+dd2)/rave*_1b2;var loop=Math.round(_1b7);if(loop<1){loop=1;}var pcol=this.getPenColor();var _1b8;var _1b9,aexp;var tva2=vave;if(tva2<=0){tva2=0.0001;}if(this.feltmode==true){_1b9=1/(tva2*1.6*_1b0);aexp=-0.32;}else{if(this.transparency==true){_1b9=1/(tva2*2.4*_1b0);aexp=-1.2;}else{if(InkTool.InkLib.Browser.MobileSafari){_1b9=0.95;aexp=-3.6;}else{_1b9=1;aexp=-4.8;}}}var beta=1-Math.exp(aexp*rave);if(_1b9<beta){beta=_1b9;}var _1ba=pcol.A*beta;var _1bb;if(_1a8==true){if(this.feltmode==true){_1ba/=2;}_1bb=2;}else{_1bb=_1b2*2*loop/_1b7;}if(loop<=0){}else{if(loop<_1b5){_1bb*=(_1b5/loop);_1ae*=(_1b5/loop);_1af*=(_1b5/loop);loop=_1b5;}else{if(loop>_1b6){_1bb*=(_1b6/loop);_1ae*=(_1b6/loop);_1af*=(_1b6/loop);loop=_1b6;}}}var _1bc=1-Math.pow((255-_1ba)/255,1/_1bb);_1b8=_1bc;if(_1a9==true||_1a7.moveCount==1){var xs,ys,xe,ye,ws,we;if(_1a9==true){xs=x1;ys=y1;ws=w1;xe=x2;ye=y2;we=w2;loop++;}else{xs=x2;ys=y2;ws=w2;xe=x3;ye=y3;we=w3;}var _1bd,_1be;_1bd=_1be=_1a7.lastRadius;var _1bf,_1c0;_1bf=_1c0=_1a7.lastAlpha;for(var idx=0;idx<loop;idx++){var dt=idx/loop;var dx=xs+(xe-xs)*dt;var dy=ys+(ye-ys)*dt;var dw=ws+(we-ws)*dt;if(_1c0<0||_1af==0){_1bf=_1b8;}else{_1bf=(_1c0*(_1af-1)+_1b8)/_1af;}if(this.erasemode==false){var fcol="rgba("+pcol.R+","+pcol.G+","+pcol.B+","+_1bf.toFixed(5)+")";ctx.fillStyle=fcol;}_1c0=_1bf;ctx.beginPath();var _1c1=dw/2;if(_1be<0||_1ae==0){_1bd=_1c1;}else{_1bd=(_1be*(_1ae-1)+_1c1)/_1ae;}ctx.arc(dx,dy,_1bd,0,Math.PI*2,false);ctx.fill();_1be=_1bd;}_1a7.lastRadius=_1bd;_1a7.lastAlpha=_1bf;}else{var ddd1=dd1;var ddd2=dd2;if(ddd1<ddd2/6.6){ddd1=ddd2/6.6;}else{if(ddd2<ddd1/6.6){ddd2=ddd1/6.6;}}var _1c2=loop*ddd2+((loop-1)*(ddd1-ddd2))/2;var _1c3=0;var _1bd,_1be;_1bd=_1be=_1a7.lastRadius;var _1bf,_1c0;_1bf=_1c0=_1a7.lastAlpha;for(var idx=0;idx<loop;idx++){var dt;if(_1c2==0){dt=idx/loop;}else{dt=_1c3/_1c2;}var dx=x1*(1-dt)*(1-dt)+x2*2*dt*(1-dt)+x3*dt*dt;var dy=y1*(1-dt)*(1-dt)+y2*2*dt*(1-dt)+y3*dt*dt;var dw=w1*(1-dt)*(1-dt)+w2*2*dt*(1-dt)+w3*dt*dt;if(_1c0<0||_1af==0){_1bf=_1b8;}else{_1bf=(_1c0*(_1af-1)+_1b8)/_1af;}if(this.erasemode==false){var fcol="rgba("+pcol.R+","+pcol.G+","+pcol.B+","+_1bf.toFixed(5)+")";ctx.fillStyle=fcol;}_1c0=_1bf;ctx.beginPath();var _1c1=dw/2;if(_1be<0||_1ae==0){_1bd=_1c1;}else{_1bd=(_1be*(_1ae-1)+_1c1)/_1ae;}ctx.arc(dx,dy,_1bd,0,Math.PI*2,false);ctx.fill();_1be=_1bd;_1c3+=(ddd2+idx*(ddd1-ddd2)/loop);}_1a7.lastRadius=_1bd;_1a7.lastAlpha=_1bf;}},strokeEnd:function(_1c4,xp,yp,wd,tm){_1c4.timeStr="";var ctx=_1c4.context;if(tm<=_1c4.lastTime+8){tm=_1c4.lastTime+8;}var _1c5=_1c4.xpDataToDraw(xp);var _1c6=_1c4.ypDataToDraw(yp);var _1c7=_1c4.widthDataToDraw(wd);var dx=(_1c5-_1c4.lastDrawX);var dy=(_1c6-_1c4.lastDrawY);var vlx,vly,vlw,_1c8;if(_1c4.moveCount<=1){_1c8=true;if(_1c4.moveCount==0){this.strokeMoveSub(_1c4,_1c4.lastDrawX,_1c4.lastDrawY,_1c4.lastDrawW,_1c4.lastTime,_1c8,false);vlx=_1c4.lastDrawX;vly=_1c4.lastDrawY;vlw=_1c4.lastDrawW;this.strokeMoveSub(_1c4,vlx,vly,vlw,tm,_1c8,false);}else{vlx=_1c4.lastDrawX;vly=_1c4.lastDrawY;vlw=_1c4.lastDrawW;this.strokeMoveSub(_1c4,vlx,vly,vlw,tm,_1c8,false);}}else{_1c8=false;vlx=_1c4.lastDrawX;vly=_1c4.lastDrawY;vlw=_1c4.lastDrawW;}this.strokeMoveSub(_1c4,vlx,vly,vlw,tm,_1c8,true);},drawEnd:function(_1c9){},hasFullDrawMode:function(){return false;},isSpeedSensitive:function(){return false;},isPressureSensitive:function(){return true;},isAutomaticSwitchover:function(){return false;},getSubInfo:function(){return "PressSenseFeltPen";}});}if(typeof InkTool.PressSenseBallpointPen==="undefined"){InkTool.PressSenseBallpointPen=InkTool.InkLib.Class.create(InkTool.PressSenseFeltPen,{initialize:function(){this.tp=InkTool.InkPenType.PressSenseBallpointPen;this.col=new InkTool.InkColor("purple");this.w=1.5;this.minw=0.2;this.maxw=1.5;this.oldType=-1;this.transparency=false;this.smoothing=true;this.feltmode=false;this.erasemode=false;this.zoopRatio=1.4;this.loopDivValue=24;this.valSmooth=4;this.acsSmooth=3;this.radiusSmooth=0;this.alphaSmooth=0;},hasFullDrawMode:function(){return false;},isSpeedSensitive:function(){return false;},isPressureSensitive:function(){return true;},isAutomaticSwitchover:function(){return false;},getSubInfo:function(){return "PressSenseBallpointPen";}});}if(typeof InkTool.PressSenseSignPen==="undefined"){InkTool.PressSenseSignPen=InkTool.InkLib.Class.create(InkTool.PressSenseFeltPen,{initialize:function(){this.tp=InkTool.InkPenType.PressSenseSignPen;this.col=new InkTool.InkColor("black");this.w=1.5;this.minw=0.2;this.maxw=1.5;this.oldType=-1;this.transparency=true;this.smoothing=true;this.feltmode=false;this.erasemode=false;this.zoopRatio=1;this.loopDivValue=24;this.valSmooth=8;this.acsSmooth=6;this.radiusSmooth=0;this.alphaSmooth=12;},hasFullDrawMode:function(){return false;},isSpeedSensitive:function(){return false;},isPressureSensitive:function(){return true;},isAutomaticSwitchover:function(){return false;},getSubInfo:function(){return "PressSenseSignPen";}});}if(typeof InkTool.PressSenseSchoolPen==="undefined"){InkTool.PressSenseSchoolPen=InkTool.InkLib.Class.create(InkTool.PressSenseFeltPen,{initialize:function(){this.tp=InkTool.InkPenType.PressSenseSchoolPen;this.col=new InkTool.InkColor("purple");this.w=1.5;this.minw=0.2;this.maxw=1.5;this.oldType=-1;this.transparency=false;this.smoothing=true;this.feltmode=false;this.erasemode=false;this.zoopRatio=1.4;this.loopDivValue=24;this.valSmooth=4;this.acsSmooth=3;this.radiusSmooth=0;this.alphaSmooth=0;},hasFullDrawMode:function(){return false;},isSpeedSensitive:function(){return false;},isPressureSensitive:function(){return true;},isAutomaticSwitchover:function(){return false;},getSubInfo:function(){return "PressSenseSchoolPen";}});}if(typeof InkTool.AutoSwitchoverPen==="undefined"){InkTool.AutoSwitchoverPen=InkTool.InkLib.Class.create(InkTool.InkStationery,{initialize:function(){this.tp=InkTool.InkPenType.None;this.col=new InkTool.InkColor("black");this.w=2;this.minw=1;this.maxw=5;this.oldType=-1;this.activeXPen=null;this.html5Pen=null;},setPenColor:function(_1ca){this.col=_1ca;if(this.activeXPen!=null){this.activeXPen.setPenColor(_1ca);}if(this.html5Pen!=null){this.html5Pen.setPenColor(_1ca);}},setPenWidth:function(_1cb){this.w=_1cb;if(this.activeXPen!=null){this.activeXPen.setPenWidth(_1cb);}if(this.html5Pen!=null){this.html5Pen.setPenWidth(_1cb);}},setPenMinWidth:function(_1cc){this.minw=_1cc;if(this.activeXPen!=null){this.activeXPen.setPenMinWidth(_1cc);}if(this.html5Pen!=null){this.html5Pen.setPenMinWidth(_1cc);}},setPenMaxWidth:function(_1cd){this.maxw=_1cd;if(this.activeXPen!=null){this.activeXPen.setPenMaxWidth(_1cd);}if(this.html5Pen!=null){this.html5Pen.setPenMaxWidth(_1cd);}},hasFullDrawMode:function(){return false;},isSpeedSensitive:function(){return false;},isPressureSensitive:function(){return false;},isAutomaticSwitchover:function(){return true;},getSubInfo:function(){return "AutoSwitchoverPen";}});}if(typeof InkTool.BallpointPen==="undefined"){InkTool.BallpointPen=InkTool.InkLib.Class.create(InkTool.AutoSwitchoverPen,{initialize:function(){this.tp=InkTool.InkPenType.AutoSwitchBallpointPen;this.col=new InkTool.InkColor("purple");this.w=1.5;this.minw=0.2;this.maxw=1.5;this.oldType=-1;this.activeXPen=new InkTool.PressSenseBallpointPen();this.html5Pen=new InkTool.SpeedSenseBallpointPen();},getSubInfo:function(){return "BallpointPen";}});}if(typeof InkTool.FeltPen==="undefined"){InkTool.FeltPen=InkTool.InkLib.Class.create(InkTool.AutoSwitchoverPen,{initialize:function(){this.tp=InkTool.InkPenType.AutoSwitchFeltPen;this.col=new InkTool.InkColor("purple");this.w=5;this.minw=3;this.maxw=8;this.oldType=-1;this.activeXPen=new InkTool.PressSenseFeltPen();this.html5Pen=new InkTool.SpeedSenseFeltPen();},getSubInfo:function(){return "FeltPen";}});}if(typeof InkTool.SignPen==="undefined"){InkTool.SignPen=InkTool.InkLib.Class.create(InkTool.AutoSwitchoverPen,{initialize:function(){this.tp=InkTool.InkPenType.AutoSwitchSignPen;this.col=new InkTool.InkColor("black");this.w=1.5;this.minw=0.2;this.maxw=1.5;this.oldType=-1;this.activeXPen=new InkTool.PressSenseSignPen();this.html5Pen=new InkTool.SpeedSenseSignPen();},getSubInfo:function(){return "SignPen";}});}if(typeof InkTool.SchoolPen==="undefined"){InkTool.SchoolPen=InkTool.InkLib.Class.create(InkTool.AutoSwitchoverPen,{initialize:function(){this.tp=InkTool.InkPenType.AutoSwitchSchoolPen;this.col=new InkTool.InkColor("purple");this.w=1.5;this.minw=0.2;this.maxw=1.5;this.oldType=-1;this.activeXPen=new InkTool.PressSenseSchoolPen();this.html5Pen=new InkTool.SpeedSenseSchoolPen();},getSubInfo:function(){return "SchoolPen";}});}if(typeof InkTool.InkFeltPenV100==="undefined"){InkTool.InkFeltPenV100=InkTool.InkLib.Class.create(InkTool.InkStationery,{initialize:function(){this.tp=InkTool.InkPenType.FeltPenV100;this.col=new InkTool.InkColor("purple");this.w=5;this.minw=3;this.maxw=8;this.oldType=InkTool.InkPenType.Old_FeltPenV100;},drawStart:function(_1ce){var ctx=_1ce.context;ctx.strokeStyle=this.getPenColor().getRGBA();ctx.fillStyle=this.getPenColor().getRGBA();ctx.globalCompositeOperation="source-over";ctx.lineWidth=_1ce.widthDataToDraw(this.getPenWidth());ctx.lineCap="round";ctx.lineJoin="round";_1ce.drawMinPenWidth=_1ce.widthDataToDraw(this.getPenMinWidth());_1ce.drawMaxPenWidth=_1ce.widthDataToDraw(this.getPenMaxWidth());_1ce.drawScalePenWidth=_1ce.drawMaxPenWidth-_1ce.drawMinPenWidth;},strokeStart:function(_1cf,xp,yp,wd,tm){var ctx=_1cf.context;var _1d0=_1cf.xpDataToDraw(xp);var _1d1=_1cf.ypDataToDraw(yp);_1cf.llastX=_1cf.lastX=_1d0;_1cf.llastY=_1cf.lastY=_1d1;_1cf.lastTime=tm;_1cf.lastTimeSlice=8;_1cf.firstDraw=true;_1cf.moveCount=0;_1cf.moveSum=0;_1cf.lastData=[];_1cf.timeStr="";},strokeMove:function(_1d2,xp,yp,wd,tm){_1d2.timeStr="";if(tm<=_1d2.lastTime){_1d2.queuePoints.push({"x":xp,"y":yp});return;}var _1d3=(tm-_1d2.lastTime)/(_1d2.queuePoints.length+1);while(_1d2.queuePoints.length>0){var _1d4=_1d2.queuePoints.shift();this.strokeMoveSub(_1d2,_1d4.x,_1d4.y,_1d3);}this.strokeMoveSub(_1d2,xp,yp,_1d3);_1d2.lastTime=tm;},strokeMoveSub:function(_1d5,xp,yp,_1d6){var ctx=_1d5.context;var _1d7=_1d5.xpDataToDraw(xp);var _1d8=_1d5.ypDataToDraw(yp);var _1d9=_1d5.drawMinPenWidth;var _1da=_1d5.drawScalePenWidth;_1d5.moveCount++;_1d5.timeStr=_1d5.timeStr+","+_1d6;var _1db;if(_1d5.moveCount==1){var t2=_1d6;var px2=_1d5.lastX;var py2=_1d5.lastY;var px3=_1d7;var py3=_1d8;var d2=Math.sqrt(px2*px2-2*px2*px3+px3*px3+py2*py2-2*py2*py3+py3*py3);var v2=d2/t2;_1d5.lastV1=_1d5.lastV2=_1d5.lastV3=_1d5.lastV4=_1d5.lastV5=v2;_1db=v2;_1d5.moveSum+=d2;}else{var t1=_1d5.lastTimeSlice;var t2=_1d6;var px1=_1d5.llastX;var py1=_1d5.llastY;var px2=_1d5.lastX;var py2=_1d5.lastY;var px3=_1d7;var py3=_1d8;var d1=Math.sqrt(px1*px1-2*px1*px2+px2*px2+py1*py1-2*py1*py2+py2*py2);var d2=Math.sqrt(px2*px2-2*px2*px3+px3*px3+py2*py2-2*py2*py3+py3*py3);var vc1=d1/t1/_1d5.zoomRatio;var vc3=d2/t2/_1d5.zoomRatio;var v1=(_1d5.lastV3+_1d5.lastV4+vc1)/3;var v3=(_1d5.lastV4+_1d5.lastV5+vc3)/3;_1d5.moveSum+=d2;var _1dc=_1d5.moveSum+_1d5.moveCount;if(_1dc<10){_1da=_1da*_1dc/10;}var x1=(_1d5.lastX+_1d5.llastX)/2;var y1=(_1d5.lastY+_1d5.llastY)/2;var x2=_1d5.lastX;var y2=_1d5.lastY;var x3=(_1d5.lastX+_1d7)/2;var y3=(_1d5.lastY+_1d8)/2;var v2=(v1+v3)/2;var rave=_1d9+_1da*Math.exp(-1.5*v2);var loop=Math.round((d1+d2)/rave*10);if(loop<10){loop=10;}var zoop=Math.round((d1+d2)/(6.2*_1d5.zoomRatio)*10);if(zoop<10){zoop=10;}zoop/=2;var pcol=this.getPenColor();var _1dd=pcol.A/255/zoop;var fcol="rgba("+pcol.R+","+pcol.G+","+pcol.B+","+_1dd.toFixed(5)+")";ctx.fillStyle=fcol;var _1de=false;var dxl=0;var dyl=0;for(var idx=0;idx<loop;idx++){var dt=idx/loop;var dx=x3*(1-dt)*(1-dt)+x2*2*dt*(1-dt)+x1*dt*dt;var dy=y3*(1-dt)*(1-dt)+y2*2*dt*(1-dt)+y1*dt*dt;var dv=v3*(1-dt)*(1-dt)+v2*2*dt*(1-dt)+v1*dt*dt;ctx.beginPath();ctx.arc(dx,dy,_1d9+_1da*Math.exp(-1.5*dv),0,Math.PI*2,false);ctx.fill();_1de=true;dxl=dx;dyl=dy;}_1db=v2;}_1d5.llastX=_1d5.lastX;_1d5.llastY=_1d5.lastY;_1d5.lastX=_1d7;_1d5.lastY=_1d8;_1d5.lastV1=_1d5.lastV2;_1d5.lastV2=_1d5.lastV3;_1d5.lastV3=_1d5.lastV4;_1d5.lastV4=_1d5.lastV5;_1d5.lastV5=_1db;},strokeEnd:function(_1df,xp,yp,wd,tm){_1df.timeStr="";var ctx=_1df.context;if(tm<=_1df.lastTime){tm=_1df.lastTime+8;}if(_1df.queuePoints.length==0){return;}var _1e0=(tm-_1df.lastTime)/_1df.queuePoints.length;while(_1df.queuePoints.length>0){var _1e1=_1df.queuePoints.shift();this.strokeMoveSub(_1df,_1e1.x,_1e1.y,_1e0);}},drawEnd:function(_1e2){},hasFullDrawMode:function(){return false;},isSpeedSensitive:function(){return true;},isPressureSensitive:function(){return false;},isAutomaticSwitchover:function(){return false;},getSubInfo:function(){return "FeltPenV100";}});}if(typeof InkTool.InkPencil==="undefined"){InkTool.InkPencil=InkTool.InkLib.Class.create(InkTool.InkStationery,{initialize:function(){if(InkTool.InkLib.needsEmulateCanvas()){this.tp=InkTool.InkPenType.PencilEmulated;}else{this.tp=InkTool.InkPenType.PencilEmulated;}this.col=new InkTool.InkColor("#FF4A4C4B");this.w=1.8;this.minw=0.2;this.maxw=2;this.oldType=InkTool.InkPenType.Old_PencilEmulated;},drawStart:function(_1e3){if(this.tp==InkTool.InkPenType.PencilEmulated){InkTool.InkBallpointPen.prototype.drawStart.apply(this,arguments);}else{InkTool.InkFeltPen.prototype.drawStart.apply(this,arguments);}},strokeStart:function(_1e4,xp,yp,wd,tm){if(this.tp==InkTool.InkPenType.PencilEmulated){InkTool.InkBallpointPen.prototype.strokeStart.apply(this,arguments);}else{InkTool.InkFeltPen.prototype.strokeStart.apply(this,arguments);}},strokeMove:function(_1e5,xp,yp,wd,tm){if(this.tp==InkTool.InkPenType.PencilEmulated){InkTool.InkBallpointPen.prototype.strokeMove.apply(this,arguments);}else{InkTool.InkFeltPen.prototype.strokeMove.apply(this,arguments);}},strokeMoveSub:function(_1e6,xp,yp,_1e7){if(this.tp==InkTool.InkPenType.PencilEmulated){InkTool.InkBallpointPen.prototype.strokeMoveSub.apply(this,arguments);}else{InkTool.InkFeltPen.prototype.strokeMoveSub.apply(this,arguments);}},strokeEnd:function(_1e8,xp,yp,wd,tm){if(this.tp==InkTool.InkPenType.PencilEmulated){InkTool.InkBallpointPen.prototype.strokeEnd.apply(this,arguments);}else{InkTool.InkFeltPen.prototype.strokeEnd.apply(this,arguments);}},drawEnd:function(_1e9){if(this.tp==InkTool.InkPenType.PencilEmulated){InkTool.InkBallpointPen.prototype.drawEnd.apply(this,arguments);}else{InkTool.InkFeltPen.prototype.drawEnd.apply(this,arguments);}},fullDrawStart:function(_1ea){InkTool.InkBallpointPen.prototype.fullDrawStart.apply(this,arguments);},fullStrokeStart:function(_1eb,xp,yp,wd,tm){InkTool.InkBallpointPen.prototype.fullStrokeStart.apply(this,arguments);},fullStrokeMove:function(_1ec,xp,yp,wd,tm){InkTool.InkBallpointPen.prototype.fullStrokeMove.apply(this,arguments);},fullStrokeMoveSub:function(_1ed,xp,yp,wd,tm){InkTool.InkBallpointPen.prototype.fullStrokeMoveSub.apply(this,arguments);},fullStrokeEnd:function(_1ee,xp,yp,wd,tm){InkTool.InkBallpointPen.prototype.fullStrokeEnd.apply(this,arguments);},fullDrawEnd:function(_1ef){InkTool.InkBallpointPen.prototype.fullDrawEnd.apply(this,arguments);},hasFullDrawMode:function(){return (this.tp==InkTool.InkPenType.PencilEmulated);},isSpeedSensitive:function(){return (this.tp!=InkTool.InkPenType.PencilEmulated);},isPressureSensitive:function(){return false;},isAutomaticSwitchover:function(){return false;},getSubInfo:function(){return "Pencil";}});}if(typeof InkTool.InkNormalEraser==="undefined"){InkTool.InkNormalEraser=InkTool.InkLib.Class.create(InkTool.InkStationery,{initialize:function(){this.tp=InkTool.InkPenType.SolidEraser;this.col=new InkTool.InkColor("black");this.w=12;this.minw=8;this.maxw=16;this.oldType=InkTool.InkPenType.Old_NormalEraser;},drawStart:function(_1f0){var ctx=_1f0.context;ctx.strokeStyle=this.getPenColor().getRGB();ctx.fillStyle=this.getPenColor().getRGB();ctx.globalCompositeOperation="destination-out";ctx.lineWidth=_1f0.widthDataToDraw(this.getPenWidth());ctx.lineCap="round";ctx.lineJoin="round";},strokeStart:function(_1f1,xp,yp,wd,tm){var ctx=_1f1.context;var _1f2=_1f1.xpDataToDraw(xp);var _1f3=_1f1.ypDataToDraw(yp);_1f1.lastData=[];_1f1.llastX=_1f1.lastX=_1f2;_1f1.llastY=_1f1.lastY=_1f3;},strokeMove:function(_1f4,xp,yp,wd,tm){var ctx=_1f4.context;var _1f5=_1f4.xpDataToDraw(xp);var _1f6=_1f4.ypDataToDraw(yp);var x1=(_1f4.lastX+_1f4.llastX)/2;var y1=(_1f4.lastY+_1f4.llastY)/2;var x2=_1f4.lastX;var y2=_1f4.lastY;var x3=(_1f4.lastX+_1f5)/2;var y3=(_1f4.lastY+_1f6)/2;ctx.beginPath();ctx.moveTo(x1,y1);ctx.quadraticCurveTo(x2,y2,x3,y3);if(InkTool.InkLib.Browser.Chrome){ctx.lineTo(x3+0.1,y3+0.1);}ctx.stroke();_1f4.llastX=_1f4.lastX;_1f4.llastY=_1f4.lastY;_1f4.lastX=_1f5;_1f4.lastY=_1f6;},strokeEnd:function(_1f7,xp,yp,wd,tm){var ctx=_1f7.context;var _1f8=_1f7.xpDataToDraw(xp);var _1f9=_1f7.ypDataToDraw(yp);var x1=(_1f7.lastX+_1f7.llastX)/2;var y1=(_1f7.lastY+_1f7.llastY)/2;var x2=_1f7.lastX;var y2=_1f7.lastY;var x3=_1f8;var y3=_1f9;ctx.beginPath();ctx.moveTo(x1,y1);ctx.quadraticCurveTo(x2,y2,x3,y3);if(InkTool.InkLib.Browser.Chrome||(x2==x3&&y2==y3)){ctx.lineTo(x3+0.1,y3+0.1);}ctx.stroke();_1f7.llastX=_1f7.lastX;_1f7.llastY=_1f7.lastY;_1f7.lastX=_1f8;_1f7.lastY=_1f9;},drawEnd:function(_1fa){},hasFullDrawMode:function(){return false;},isSpeedSensitive:function(){return false;},isPressureSensitive:function(){return false;},isAutomaticSwitchover:function(){return false;},getSubInfo:function(){return "NormalEraser";}});}if(typeof InkTool.SolidEraser==="undefined"){InkTool.SolidEraser=InkTool.InkLib.Class.create(InkTool.InkNormalEraser,{getSubInfo:function(){return "SolidEraser";}});}if(typeof InkTool.PressSenseNormalEraser==="undefined"){InkTool.PressSenseNormalEraser=InkTool.InkLib.Class.create(InkTool.PressSenseFeltPen,{initialize:function(){this.tp=InkTool.InkPenType.PressSenseNormalEraser;this.col=new InkTool.InkColor("black");this.w=12;this.minw=8;this.maxw=16;this.oldType=-1;this.transparency=false;this.smoothing=true;this.feltmode=false;this.erasemode=true;this.zoopRatio=1;this.loopDivValue=24;this.valSmooth=8;this.acsSmooth=6;this.radiusSmooth=0;this.alphaSmooth=0;},hasFullDrawMode:function(){return false;},isSpeedSensitive:function(){return false;},isPressureSensitive:function(){return true;},isAutomaticSwitchover:function(){return false;},getSubInfo:function(){return "PressSenseNormalEraser";}});}if(typeof InkTool.Eraser==="undefined"){InkTool.Eraser=InkTool.InkLib.Class.create(InkTool.AutoSwitchoverPen,{initialize:function(){this.tp=InkTool.InkPenType.AutoSwitchEraser;this.col=new InkTool.InkColor("black");this.w=12;this.minw=8;this.maxw=16;this.oldType=-1;this.activeXPen=new InkTool.PressSenseNormalEraser();this.html5Pen=new InkTool.SolidEraser();},getSubInfo:function(){return "Eraser";}});}if(typeof InkTool.InkCell==="undefined"){InkTool.InkCell=InkTool.InkLib.Class.create(null,{initialize:function(_1,xp,yp,_2,_3,_4){this.m=_1;this.x=xp;this.y=yp;this.w=_2;this.p=_3;this.t=_4;},getMode:function(){return this.m;},getX:function(){return this.x;},getY:function(){return this.y;},getWidth:function(){return this.w;},getPressure:function(){return this.p;},getTime:function(){return this.t;}});}if(typeof InkTool.InkStroke==="undefined"){InkTool.InkStroke=InkTool.InkLib.Class.create(null,{initialize:function(_5){this.cs=new Array();this.st=_5.clone();this.t=null;},getStationery:function(){return this.st;},getColor:function(){return this.st.PenColor;},getPenType:function(){return this.st.PenType;},getTime:function(){return this.t;},countCells:function(){return this.cs.length;},addCell:function(_6){this.cs.push(_6);},getCell:function(_7){if(_7<0||_7>=this.cs.length){return null;}else{return this.cs[_7];}},countFeatureCells:function(_8){var _9=0;if(_8===undefined||_8==null){for(var _a=0;_a<this.cs.length;_a++){if(this.cs[_a].m>=0){_9++;}}}else{for(var _a=0;_a<this.cs.length;_a++){if(this.cs[_a].m==_8){_9++;}}}return _9;}});}if(typeof InkTool.InkDrawing==="undefined"){InkTool.InkDrawing=InkTool.InkLib.Class.create(null,{initialize:function(){this.is=new Array();},countDrawItems:function(){return this.is.length;},addDrawItem:function(_b){this.is.push(_b);return true;},getDrawItem:function(_c){if(_c<0||_c>=this.is.length){return null;}else{return this.is[_c];}},deleteDrawItem:function(_d){this.is.splice(_d,1);return true;},clearDrawItems:function(){this.is.length=0;},countCells:function(){var _e=0;for(var _f=0;_f<this.is.length;_f++){_e+=this.is[_f].countCells();}return _e;},countFeatureCells:function(_10){var _11=0;for(var idx=0;idx<this.is.length;idx++){_11+=this.is[idx].countFeatureCells(_10);}return _11;}});}if(typeof InkTool.InkDrawn==="undefined"){InkTool.InkDrawn=InkTool.InkLib.Class.create(InkTool.InkDrawing,{initialize:function(){this.is=new Array();}});}if(typeof InkTool.InkLayer==="undefined"){InkTool.InkLayer=InkTool.InkLib.Class.create(null,{initialize:function(id,_12){this.Drawing=new InkTool.InkDrawing();this.Drawn=new InkTool.InkDrawn();this.ID=id;this.Zorder=_12;}});}if(typeof InkTool.InkPage==="undefined"){InkTool.InkPage=InkTool.InkLib.Class.create(null,{initialize:function(){this.layerList=new Array();this.layerList.push(new InkTool.InkLayer(1,100));this.currentLayerId=1;this.currentLayer=this.getLayerById(1);},countLayers:function(){return this.layerList.length;},getLayerList:function(){var _13=[];var _14=this.layerList.length;for(var _15=0;_15<_14;_15++){var _16=this.layerList[_15];_13.push({index:_15,id:_16.ID,zorder:_16.Zorder});}_13.sort(function(_17,_18){return (_18.zorder-_17.zorder);});return _13;},addLayer:function(id,_19){this.layerList.push(new InkTool.InkLayer(id,_19));return true;},getCurrentLayer:function(){return this.currentLayer;},getLayerById:function(id){var _1a=this.layerList.length;for(var _1b=0;_1b<_1a;_1b++){var _1c=this.layerList[_1b];if(_1c.ID==id){return _1c;}}return null;},getLayerByIndex:function(_1d){return this.layerList[_1d];},deleteLayerById:function(id){var _1e=this.layerList.length;for(var _1f=0;_1f<_1e;_1f++){var _20=this.layerList[_1f];if(_20.ID==id){this.layerList.splice(_1f,1);return true;}}return false;},getLayerByIndex:function(_21){this.layerList.splice(_21,1);return true;},clearLayers:function(){this.layerList.length=0;return true;}});}if(typeof InkTool.InkNote==="undefined"){InkTool.InkNote=InkTool.InkLib.Class.create(null,{initialize:function(){this.pageList=new Array();this.pageList.push(new InkTool.InkPage());},countPages:function(){return this.pageList.length;},addPage:function(){this.pageList.push(new InkTool.InkPage());return true;},addPages:function(num){for(var ct=0;ct<num;ct++){this.pageList.push(new InkTool.InkPage());}return true;},getPage:function(_22){return this.pageList[_22];},deletePage:function(_23){this.pageList.splice(_23,1);return true;},clearPages:function(){this.pageList.length=0;return true;}});}if(typeof InkTool.InkTabletInfo==="undefined"){InkTool.InkTabletInfo=InkTool.InkLib.Class.create(null,{initialize:function(){}});}if(typeof InkTool.InkData==="undefined"){InkTool.InkData=InkTool.InkLib.Class.create(null,{initialize:function(){this.TabletInfo=new InkTool.InkTabletInfo();this.Note=new InkTool.InkNote();}});}if(typeof InkTool.InkRect==="undefined"){InkTool.InkRect=InkTool.InkLib.Class.create(null,{initialize:function(_1,_2,_3,_4){this.left=_1;this.top=_2;this.width=_3;this.height=_4;},clearRect:function(){this.left=0;this.top=0;this.width=0;this.height=0;},getLeft:function(){return this.left;},getTop:function(){return this.top;},getWidth:function(){return this.width;},getHeight:function(){return this.height;},getRight:function(){return this.left+this.width;},getBottom:function(){return this.top+this.height;},equalsRect:function(_5){return (this.left==_5.left&&this.top==_5.top&&this.width==_5.width&&this.height==_5.height);},copyRect:function(_6){this.left=_6.left;this.top=_6.top;this.width=_6.width;this.height=_6.height;},cloneRect:function(){return new InkTool.InkRect(this.left,this.top,this.width,this.height);},isEmpty:function(){return (this.width==0||this.height==0);},containsPoint:function(_7,_8){return (_7>=this.left&&_7<this.getRight()&&_8>=this.top&&_8<this.getBottom());},containsPosition:function(_9){return (_9.left>=this.left&&_9.left<this.getRight()&&_9.top>=this.top&&_9.top<this.getBottom());},containsRect:function(_a){return (this.left<=_a.left&&this.top<=_a.top&&this.getRight()>=_a.getRight()&&this.getBottom()>=_a.getBottom());},intersectsRect:function(_b){var _c=(this.left>=_b.left)?this.left:_b.left;var _d=(this.getRight()<=_b.getRight())?this.getRight:_b.getRight();var _e=(this.top>=_b.top)?this.top:_b.top;var _f=(this.getBottom()<=_b.getBottom())?this.getBottom:_b.getBottom();return (_c<_d&&_e<_f);},andRect:function(_10){var _11=(this.left>=_10.left)?this.left:_10.left;var _12=(this.getRight()<=_10.getRight())?this.getRight:_10.getRight();if(_12<_11){_12=_11;}var _13=(this.top>=_10.top)?this.top:_10.top;var _14=(this.getBottom()<=_10.getBottom())?this.getBottom:_10.getBottom();if(_14<_13){_14=_13;}return new InkTool.InkRect(_11,_13,(_12-_11),(_14-_13));},orRect:function(_15){var _16=(this.left<=_15.left)?this.left:_15.left;var _17=(this.getRight()>=_15.getRight())?this.getRight:_15.getRight();var _18=(this.top<=_15.top)?this.top:_15.top;var _19=(this.getBottom()>=_15.getBottom())?this.getBottom:_15.getBottom();return new InkTool.InkRect(_16,_18,(_17-_16),(_19-_18));},margeRect:function(_1a){if(this.isEmpty()){return _1a.cloneRect();}else{if(_1a.isEmpty()){return this.cloneRect();}else{return this.orRect(_1a);}}},Dummy:null});}if(typeof InkTool.Base64Lib==="undefined"){InkTool.Base64Lib={encodeBase64Letter:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",decodeBase64Letter:[-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,62,-1,-1,-1,63,52,53,54,55,56,57,58,59,60,61,-1,-1,-1,-1,-1,-1,-1,0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,-1,-1,-1,-1,-1,-1,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,-1,-1,-1,-1,-1],encodeBase64:function(_1b){var _1c,i,_1d;var _1e,_1f,_20;var _21=InkTool.Base64Lib;_1d=_1b.length;i=0;_1c="";while(i<_1d){_1e=_1b.charCodeAt(i++)&255;if(i==_1d){_1c+=_21.encodeBase64Letter.charAt(_1e>>2);_1c+=_21.encodeBase64Letter.charAt((_1e&3)<<4);_1c+="==";break;}_1f=_1b.charCodeAt(i++);if(i==_1d){_1c+=_21.encodeBase64Letter.charAt(_1e>>2);_1c+=_21.encodeBase64Letter.charAt(((_1e&3)<<4)|((_1f&240)>>4));_1c+=_21.encodeBase64Letter.charAt((_1f&15)<<2);_1c+="=";break;}_20=_1b.charCodeAt(i++);_1c+=_21.encodeBase64Letter.charAt(_1e>>2);_1c+=_21.encodeBase64Letter.charAt(((_1e&3)<<4)|((_1f&240)>>4));_1c+=_21.encodeBase64Letter.charAt(((_1f&15)<<2)|((_20&192)>>6));_1c+=_21.encodeBase64Letter.charAt(_20&63);}return _1c;},decodeBase64:function(_22){var _23,_24,_25,_26;var i,_27,_28;var _29=InkTool.Base64Lib;_27=_22.length;i=0;_28="";while(i<_27){do{_23=_29.decodeBase64Letter[_22.charCodeAt(i++)&255];}while(i<_27&&_23==-1);if(_23==-1){break;}do{_24=_29.decodeBase64Letter[_22.charCodeAt(i++)&255];}while(i<_27&&_24==-1);if(_24==-1){break;}_28+=String.fromCharCode((_23<<2)|((_24&48)>>4));do{_25=_22.charCodeAt(i++)&255;if(_25==61){return _28;}_25=_29.decodeBase64Letter[_25];}while(i<_27&&_25==-1);if(_25==-1){break;}_28+=String.fromCharCode(((_24&15)<<4)|((_25&60)>>2));do{_26=_22.charCodeAt(i++)&255;if(_26==61){return _28;}_26=_29.decodeBase64Letter[_26];}while(i<_27&&_26==-1);if(_26==-1){break;}_28+=String.fromCharCode(((_25&3)<<6)|_26);}return _28;},byteArrayToBase64:function(_2a){var _2b=InkTool.Base64Lib.encodeBase64Letter;if(_2a==null){return "====";}var _2c="";var ch=0;for(var idx=0;idx<_2a.length;idx++){switch(idx%3){case 0:_2c+=_2b.charAt((_2a[idx]>>2)&63);ch=(_2a[idx]&3)<<4;break;case 1:_2c+=_2b.charAt(ch|((_2a[idx]>>4)&15));ch=(_2a[idx]&15)<<2;break;case 2:_2c+=_2b.charAt(ch|((_2a[idx]>>6)&15));_2c+=_2b.charAt(_2a[idx]&63);ch=0;break;}}if(_2a.length%3==1){_2c+=_2b.charAt(ch);_2c+="==";}else{if(_2a.length%3==2){_2c+=_2b.charAt(ch);_2c+="=";}}return _2c;},Dummy:null};}if(typeof InkTool.XorShiftRandom==="undefined"){InkTool.XorShiftRandom=InkTool.InkLib.Class.create(null,{initialize:function(_2d,_2e){this.setSeed(_2d,_2e);},setSeed:function(_2f,_30){this.wval=_2f;this.xval=_2f;this.yval=_2f;this.zval=_2f;for(var idx=0;idx<_30;idx++){this.getNext(0,2);}},getNext:function(min,max){var _31=(this.xval^(this.xval<<11));this.xval=this.yval;this.yval=this.zval;this.zval=this.wval;this.wval=(this.wval^(this.wval>>19))^(_31^(_31>>8));return (this.wval%(max-min))+min;},getRandomString:function(_32,_33){var _34="";for(var idx=0;idx<_32;idx++){var num=this.getNext(0,_33.length);_34+=_33.substring(num,num+1);}return _34;},Dummy:null});}if(typeof InkTool.RandBase64==="undefined"){InkTool.RandBase64=InkTool.InkLib.Class.create(null,{encodeBase64Letter:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",decodeBase64Letter:[-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,62,-1,-1,-1,63,52,53,54,55,56,57,58,59,60,61,-1,-1,-1,-2,-1,-1,-1,0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,-1,-1,-1,-1,-1,-1,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,-1,-1,-1,-1,-1],initialize:function(_35,_36){this.seed=_35;this.warnup=_36;this.random=new InkTool.XorShiftRandom(_35,_36);this.resetLetters();},setSeed:function(_37,_38,_39){this.seed=_37;this.warnup=_38;if(_39){this.resetLetters();}},resetLetters:function(){this.random.setSeed(this.seed,this.warnup);this.letters=[];for(var idx=0;idx<this.encodeBase64Letter.length;idx++){this.letters[idx]=this.encodeBase64Letter.charAt(idx);}this.indexes=[];for(var idx=0;idx<this.decodeBase64Letter.length;idx++){this.indexes[idx]=this.decodeBase64Letter[idx];}},randmizeLetters:function(num){for(var ct=0;ct<num;ct++){var _3a=this.random.getNext(0,this.letters.length);var _3b=this.random.getNext(0,this.letters.length);if(_3a!=_3b){var ch1=this.letters[_3a];var ch2=this.letters[_3b];var _3c=ch1.charCodeAt(0);var _3d=ch2.charCodeAt(0);this.letters[_3a]=ch2;this.letters[_3b]=ch1;this.indexes[_3c]=_3b;this.indexes[_3d]=_3a;}}},encode:function(num,_3e,_3f){if(_3f){this.resetLetters();}this.randmizeLetters(num);return this.encodeBase64(_3e);},decode:function(num,_40,_41){if(_41){this.resetLetters();}this.randmizeLetters(num);return this.decodeBase64(_40);},encodeBase64:function(_42){var _43,i,_44;var _45,_46,_47;_44=_42.length;i=0;_43="";while(i<_44){_45=_42.charCodeAt(i++)&255;if(i==_44){_43+=this.letters[_45>>2];_43+=this.letters[(_45&3)<<4];_43+="==";break;}_46=_42.charCodeAt(i++);if(i==_44){_43+=this.letters[_45>>2];_43+=this.letters[((_45&3)<<4)|((_46&240)>>4)];_43+=this.letters[(_46&15)<<2];_43+="=";break;}_47=_42.charCodeAt(i++);_43+=this.letters[_45>>2];_43+=this.letters[((_45&3)<<4)|((_46&240)>>4)];_43+=this.letters[((_46&15)<<2)|((_47&192)>>6)];_43+=this.letters[_47&63];}return _43;},decodeBase64:function(_48){var _49,_4a,_4b,_4c;var i,_4d,_4e;_4d=_48.length;i=0;_4e="";while(i<_4d){_49=this.indexes[_48.charCodeAt(i++)&255];if(_49<0){break;}_4a=this.indexes[_48.charCodeAt(i++)&255];if(_4a<0){break;}_4e+=String.fromCharCode((_49<<2)|((_4a&48)>>4));_4b=this.indexes[_48.charCodeAt(i++)&255];if(_4b<0){break;}_4e+=String.fromCharCode(((_4a&15)<<4)|((_4b&60)>>2));_4c=this.indexes[_48.charCodeAt(i++)&255];if(_4c<0){break;}_4e+=String.fromCharCode(((_4b&3)<<6)|_4c);}return _4e;},byteArrayToBase64:function(_4f){if(_4f==null){return "====";}var _50="";var ch=0;for(var idx=0;idx<_4f.length;idx++){switch(idx%3){case 0:_50+=this.letters[(_4f[idx]>>2)&63];ch=(_4f[idx]&3)<<4;break;case 1:_50+=this.letters[ch|((_4f[idx]>>4)&15)];ch=(_4f[idx]&15)<<2;break;case 2:_50+=this.letters[ch|((_4f[idx]>>6)&15)];_50+=this.letters[_4f[idx]&63];ch=0;break;}}if(_4f.length%3==1){_50+=this.letters[ch];_50+="==";}else{if(_4f.length%3==2){_50+=this.letters[ch];_50+="=";}}return _50;},base64ToByteArray:function(_51){var _52,_53,_54,_55;var i,_56,_57;_56=_51.length;i=0;_57=[];while(i<_56){_52=this.indexes[_51.charCodeAt(i++)&255];if(_52<0){break;}_53=this.indexes[_51.charCodeAt(i++)&255];if(_53<0){break;}_57.push((_52<<2)|((_53&48)>>4));_54=this.indexes[_51.charCodeAt(i++)&255];if(_54<0){break;}_57.push(((_53&15)<<4)|((_54&60)>>2));_55=this.indexes[_51.charCodeAt(i++)&255];if(_55<0){break;}_57.push(((_54&3)<<6)|_55);}return _57;},Dummy:null});}if(typeof InkTool.InkDocTracePacket==="undefined"){InkTool.InkDocTracePacket=InkTool.InkLib.Class.create(null,{initialize:function(_1,_2,_3,id){this.etype=_1;this.serialNo=_2;this.touchIndex=_3;this.id=id;this.llastPos=null;this.llastTime=0;this.llastEvent=null;this.lastPos=null;this.lastTime=0;this.lastEvent=null;this.DocIsDrawing=false;this.crntMode=-1;this.List={};},setPosition:function(_4){this.llastPos=this.lastPos;this.llastTime=this.lastTime;this.lastPos=_4;this.lastTime=Date.now();},setPositionAndTime:function(_5,_6){this.llastPos=this.lastPos;this.llastTime=this.lastTime;this.lastPos=_5;this.lastTime=_6;},setEvent:function(_7){this.llastEvent=this.lastEvent;this.lastEvent=_7;},setPositionAndEvent:function(_8,_9){this.llastPos=this.lastPos;this.llastTime=this.lastTime;this.lastPos=_8;this.lastTime=Date.now();this.llastEvent=this.lastEvent;this.lastEvent=_9;},setPositionTimeAndEvent:function(_a,_b,_c){this.llastPos=this.lastPos;this.llastTime=this.lastTime;this.lastPos=_a;this.lastTime=_b;this.llastEvent=this.lastEvent;this.lastEvent=_c;},getPosision:function(){return this.lastPos;},getLastTime:function(){return this.lastTime;},getLastTimeInterval:function(){if(this.llastTime==0||this.lastTime==0){return 0;}return (this.lastTime-this.llastTime);},getLastPosDistance:function(){if(this.llastPos==null||this.lastPos==null){return 0;}var dx=this.lastPos.left-this.llastPos.left;var dy=this.lastPos.top-this.llastPos.top;return Math.sqrt(dx*dx+dy*dy);},dummy:function(){}});}if(typeof InkTool.InkCanvasLib==="undefined"){InkTool.InkCanvasLib={Version:"2.22",PublicInkVersion:"1.0",CanvasClasses:{},List:{},Initialized:false,PreventDragAndSelect:true,DebugLevel:0,AnalyzeLevel:0,AnalyzeDebugInfo:1,Combinable:true,TimerDraw:null,TimerCopy:null,InkData:null,DummyDiv:null,DummyCanvas:null,SerialNo:0,MultiTouchMax:5,PenTrace:null,TouchTraceList:[],PointerTraceList:[],FeatureDetectingBendDist:0.75,FeatureDetectingStraightDist:32,FeatureDetectingTimeDist:25,FeatureDetectingSharpDist:1.05,DocLLastPenDownPos:{"left":-10000,"top":-10000},DocLLastPenUpTime:0,DocLastPenDownPos:{"left":-10000,"top":-10000},DocLastPenUpTime:0,DocLastPenDownIgnored:0,DocLastDevice:"unknown",DocPenEnterLimitDistance:64,HotSpotHappening:false,PauseLib:false,TotalDrawingTime:0,TotalDrawingCells:0,TotalCopyCount:0,TotalPenDownTime:0,TotalPenMoveTime:0,TotalPenUpTime:0,MouseDownInfo:"",MouseMoveInfo:"",MouseUpInfo:"",MouseInfoCallback:null,MouseDownNum:0,MouseMoveNum:0,MouseUpNum:0,TouchDownInfo:"",TouchMoveInfo:"",TouchUpInfo:"",TouchInfoCallback:null,GestureDownInfo:"",GestureMoveInfo:"",GestureUpInfo:"",GestureInfoCallback:null,MSPointerDownInfo:"",MSPointerMoveInfo:"",MSPointerUpInfo:"",MSPointerInfoCallback:null,PointerEnableTouch:true,PointerEnablePen:true,PointerEnableMouse:true,PointerEnableUnknown:true,PointerEnableAll:true,TraceInfo:"",TraceDistMax:0,TraceDistMaxInterval:0,TraceValMax:0,TraceValMaxDist:0,TraceValMaxInterval:0,TraceIntervalMax:0,TraceIntervalMin:10000,TraceInfoCallback:null,UsePointerIE:true,UsePointerEdge:true,UsePointerFireFox:true,UsePointerOpera:true,UsePointerChrome:true,UsePointerSafari:true,UsePointerMobileSafari:true,UsePointerGecko:true,UsePointerWebkit:true,UsePointerOthers:true,ActiveXList:[],ActiveXType:"",ActiveXGuid:"",ActiveXInit:"auto",ActiveXSignPad:null,ActiveXExists:0,DeviceWintabFitControlSize:false,DeviceWintabFitControlSizeParams:{ControlMargin:{Left:0,Top:0,Right:0,Bottom:0},KeepAspectRatio:false,EmbedTabletInControl:false,Alignment:{Horizontal:0,Vertical:0}},DeviceMsinkIgnoreTabletQuery:true,DeviceMsinkDefSupportStatus:true,DeviceMsinkDefSupportPressure:true,DeviceMsinkFailSupportStatus:true,DeviceMsinkFailSupportPressure:true,DeviceMsinkDefMinPressure:0,DeviceMsinkDefMaxPressure:1024,DeviceSignPadFitControlSizeParams:{ControlMargin:{Left:0,Top:0,Right:0,Bottom:0},KeepAspectRatio:false,EmbedTabletInControl:true,Alignment:{Horizontal:0,Vertical:0}},DeviceSignPadBackImageURL:null,initialize:function(){var _d=InkTool.InkLib;var _e=InkTool.InkCanvasLib;if(_e.Initialized){return;}_e.Initialized=true;_e.InkData=new InkTool.InkData();if(_e.PreventDragAndSelect){document.ondragstart=function(){return false;};document.onselectstart=function(){return false;};document.body.style.userSelect="none";document.body.style.MozUserSelect="none";document.body.style.webkitUserSelect="none";document.body.style.msUserSelect="none";document.body.style.msTouchAction="none";document.body.style.touchAction="none";}_e.setupTracePacket(_e.MultiTouchMax);var _f=_e.getUsePointerOfTheBrowser();var _10=false;if(typeof window.PointerEvent!=="undefined"&&_f){_d.addEvent(null,"pointerdown",_e.docMSPointerDown);_d.addEvent(null,"pointermove",_e.docMSPointerMove);_d.addEvent(null,"pointerup",_e.docMSPointerUp);_10=true;}else{if(window.navigator.pointerEnabled&&_f){_d.addEvent(null,"pointerdown",_e.docMSPointerDown);_d.addEvent(null,"pointermove",_e.docMSPointerMove);_d.addEvent(null,"pointerup",_e.docMSPointerUp);}else{if(window.navigator.msPointerEnabled&&_f){_d.addEvent(null,"MSPointerDown",_e.docMSPointerDown);_d.addEvent(null,"MSPointerMove",_e.docMSPointerMove);_d.addEvent(null,"MSPointerUp",_e.docMSPointerUp);}else{_d.addEvent(null,"mousedown",_e.docPenDown);_d.addEvent(null,"mousemove",_e.docPenMove);_d.addEvent(null,"mouseup",_e.docPenUp);}}}_d.addEvent(null,"click",_e.docClick);_d.addEvent(null,"dblclick",_e.docDblClick);_d.addEvent(window,"resize",_e.docPenCancel);_d.addEvent(window,"scroll",_e.docPenCancel);_d.addEvent(window,"dragstart",_e.docPenCancelByDrag);if(_10==false){_d.addEvent(null,"touchstart",_e.docTouchDown);_d.addEvent(null,"touchmove",_e.docTouchMove);_d.addEvent(null,"touchend",_e.docTouchUp);}_d.addEvent(null,"gesturestart",_e.docGestureDown);_d.addEvent(null,"gesturechange",_e.docGestureMove);_d.addEvent(null,"gestureend",_e.docGestureUp);_e.TimerDraw=setInterval(function(){_e.traceInterval(true);},20);},setupTracePacket:function(num){var _11=InkTool.InkLib;var _12=InkTool.InkCanvasLib;_12.SerialNo=0;_12.PenTrace=new InkTool.InkDocTracePacket("pen",_12.SerialNo++,0,"");_12.TouchTraceList=[];for(var idx=0;idx<num;idx++){var _13=new InkTool.InkDocTracePacket("touch",_12.SerialNo++,0,"");_12.TouchTraceList.push(_13);}_12.PointerTraceList=[];for(var idx=0;idx<num;idx++){var _13=new InkTool.InkDocTracePacket("pointer",_12.SerialNo++,0,"");_12.PointerTraceList.push(_13);}for(var _14 in _12.List){var _15=_12.List[_14];_15.setupTracePacket();}},getMultiTouchMax:function(max){var _16=InkTool.InkCanvasLib;return _16.MultiTouchMax;},setMultiTouchMax:function(max){var _17=InkTool.InkLib;var _18=InkTool.InkCanvasLib;if(max<=0){max=1;}_18.MultiTouchMax=max;if(_18.Initialized){_18.setupTracePacket(max);}},setFeatureDetectingParams:function(_19,_1a,_1b,_1c){var _1d=InkTool.InkCanvasLib;if(_19!=null){_1d.FeatureDetectingBendDist=_19;}if(_1a!=null){_1d.FeatureDetectingStraightDist=_1a;}if(_1b!=null){_1d.FeatureDetectingTimeDist=_1b;}if(_1c!=null){_1d.FeatureDetectingSharpDist=_1c;}},setFeatureDetectingBend:function(_1e){var _1f=InkTool.InkCanvasLib;if(_1e!=null){_1f.FeatureDetectingBendDist=_1e;}},getFeatureDetectingBend:function(){var _20=InkTool.InkCanvasLib;return _20.FeatureDetectingBendDist;},setFeatureDetectingStraight:function(_21){var _22=InkTool.InkCanvasLib;if(_21!=null){_22.FeatureDetectingStraightDist=_21;}},getFeatureDetectingStraight:function(){var _23=InkTool.InkCanvasLib;return _23.FeatureDetectingStraightDist;},setFeatureDetectingTime:function(_24){var _25=InkTool.InkCanvasLib;if(_24!=null){_25.FeatureDetectingTimeDist=_24;}},getFeatureDetectingTime:function(){var _26=InkTool.InkCanvasLib;return _26.FeatureDetectingTimeDist;},setFeatureDetectingSharp:function(_27){var _28=InkTool.InkCanvasLib;if(_27!=null){_28.FeatureDetectingSharpDist=_27;}},getFeatureDetectingSharp:function(){var _29=InkTool.InkCanvasLib;return _29.FeatureDetectingSharpDist;},setPenEnterLimitDistance:function(_2a){var _2b=InkTool.InkCanvasLib;_2b.DocPenEnterLimitDistance=_2a;},getPenEnterLimitDistance:function(){var _2c=InkTool.InkCanvasLib;return _2c.DocPenEnterLimitDistance;},setPointerTypeTouchEnabled:function(_2d){var _2e=InkTool.InkCanvasLib;_2e.PointerEnableTouch=_2d;_2e.setupPointerTypeAll();},getPointerTypeTouchEnabled:function(){var _2f=InkTool.InkCanvasLib;return _2f.PointerEnableTouch;},setPointerTypePenEnabled:function(_30){var _31=InkTool.InkCanvasLib;_31.PointerEnablePen=_30;_31.setupPointerTypeAll();},getPointerTypePenEnabled:function(){var _32=InkTool.InkCanvasLib;return _32.PointerEnablePen;},setPointerTypeMouseEnabled:function(_33){var _34=InkTool.InkCanvasLib;_34.PointerEnableMouse=_33;_34.setupPointerTypeAll();},getPointerTypeMouseEnabled:function(){var _35=InkTool.InkCanvasLib;return _35.PointerEnableMouse;},setPointerTypeUnknownEnabled:function(_36){var _37=InkTool.InkCanvasLib;_37.PointerEnableUnknown=_36;_37.setupPointerTypeAll();},getPointerTypeUnknownEnabled:function(){var _38=InkTool.InkCanvasLib;return _38.PointerEnableUnknown;},setupPointerTypeAll:function(){var _39=InkTool.InkCanvasLib;_39.PointerEnableAll=(_39.PointerEnableTouch&&_39.PointerEnablePen&&_39.PointerEnableMouse&&_39.PointerEnableUnknown);},registerCanvasClass:function(key,_3a){InkTool.InkCanvasLib.CanvasClasses[key]=_3a;},getVersion:function(){return InkTool.InkCanvasLib.Version;},clearActiveX:function(){var _3b=InkTool.InkCanvasLib;_3b.ActiveXList=[];_3b.ActiveXType="";_3b.ActiveXGuid="";_3b.ActiveXInit="auto";_3b.ActiveXExists=0;},addActiveX:function(_3c,_3d,_3e){var _3f=InkTool.InkCanvasLib;if(_3e===undefined||_3e===null||_3e===""){_3e="auto";}var _40={"type":_3c,"guid":_3d,"init":_3e};_3f.ActiveXList.push(_40);if(_3f.ActiveXExists<0){_3f.ActiveXExists=0;}},setActiveX:function(_41,_42,_43){var _44=InkTool.InkCanvasLib;_44.clearActiveX();_44.addActiveX(_41,_42,_43);},checkActiveX:function(){var _45=InkTool.InkCanvasLib;var _46=false;if(_45.ActiveXExists==0){for(var idx=0;idx<_45.ActiveXList.length;idx++){var _47=_45.ActiveXList[idx];if(InkTool.InkLib.checkActiveX(_47.type)==true){_45.ActiveXType=_47.type;_45.ActiveXGuid=_47.guid;_45.ActiveXInit=_47.init;_46=true;break;}}_45.ActiveXExists=(_46==true)?1:-1;}else{_46=(_45.ActiveXExists>0);}return _46;},setDeviceFitControlSize:function(fit){var _48=InkTool.InkCanvasLib;_48.DeviceWintabFitControlSize=fit;},getDeviceFitControlSize:function(){var _49=InkTool.InkCanvasLib;return _49.DeviceWintabFitControlSize;},setDeviceFitControlSizeParams:function(_4a,_4b,_4c,_4d,_4e,_4f,_50,_51){var _52=InkTool.InkCanvasLib;_52.DeviceWintabFitControlSizeParams.ControlMargin.Left=_4a;_52.DeviceWintabFitControlSizeParams.ControlMargin.Top=_4b;_52.DeviceWintabFitControlSizeParams.ControlMargin.Right=_4c;_52.DeviceWintabFitControlSizeParams.ControlMargin.Bottom=_4d;_52.DeviceWintabFitControlSizeParams.KeepAspectRatio=_4e;_52.DeviceWintabFitControlSizeParams.EmbedTabletInControl=_4f;_52.DeviceWintabFitControlSizeParams.Alignment.Horizontal=_50;_52.DeviceWintabFitControlSizeParams.Alignment.Vertical=_51;},setDeviceFitControlSizeControlMargin:function(_53,_54,_55,_56){var _57=InkTool.InkCanvasLib;_57.DeviceWintabFitControlSizeParams.ControlMargin.Left=_53;_57.DeviceWintabFitControlSizeParams.ControlMargin.Top=_54;_57.DeviceWintabFitControlSizeParams.ControlMargin.Right=_55;_57.DeviceWintabFitControlSizeParams.ControlMargin.Bottom=_56;},getDeviceFitControlSizeControlMargin:function(){var _58=InkTool.InkCanvasLib;return _58.DeviceWintabFitControlSizeParams.ControlMargin;},setDeviceFitControlSizeKeepAspectRatio:function(_59){var _5a=InkTool.InkCanvasLib;_5a.DeviceWintabFitControlSizeParams.KeepAspectRatio=_59;},getDeviceFitControlSizeKeepAspectRatio:function(){var _5b=InkTool.InkCanvasLib;return _5b.DeviceWintabFitControlSizeParams.KeepAspectRatio;},setDeviceFitControlSizeEmbedTabletInControl:function(_5c){var _5d=InkTool.InkCanvasLib;_5d.DeviceWintabFitControlSizeParams.EmbedTabletInControl=_5c;},getDeviceFitControlSizeEmbedTabletInControl:function(){var _5e=InkTool.InkCanvasLib;return _5e.DeviceWintabFitControlSizeParams.EmbedTabletInControl;},setDeviceFitControlSizeAlignment:function(_5f,_60){var _61=InkTool.InkCanvasLib;_61.DeviceWintabFitControlSizeParams.Alignment.Horizontal=_5f;_61.DeviceWintabFitControlSizeParams.Alignment.Vertical=_60;},getDeviceFitControlSizeAlignment:function(){var _62=InkTool.InkCanvasLib;return _62.DeviceWintabFitControlSizeParams.Alignment;},setDeviceIgnoreTabletQuery:function(_63,_64,_65){var _66=InkTool.InkCanvasLib;_66.DeviceMsinkIgnoreTabletQuery=_63;_66.DeviceMsinkDefSupportStatus=_64;_66.DeviceMsinkDefSupportPressure=_65;},getDeviceIgnoreTabletQuery:function(){var _67=InkTool.InkCanvasLib;return _67.DeviceMsinkIgnoreTabletQuery;},getDeviceDefSupportSatus:function(){var _68=InkTool.InkCanvasLib;return _68.DeviceMsinkDefSupportStatus;},getDeviceDefSupportPressure:function(){var _69=InkTool.InkCanvasLib;return _69.DeviceMsinkDefSupportPressure;},getSignPadCanvas:function(){var _6a=InkTool.InkCanvasLib;return _6a.ActiveXSignPad;},setSignPadCanvas:function(id){var _6b=InkTool.InkCanvasLib;var _6c=_6b.getCanvas(id);if(_6c==null){return false;}if(_6c.isSignPadAvailable()==false){return false;}var oid=_6b.ActiveXSignPad;if(oid!=null){if(oid==id){return false;}var _6d=_6b.getCanvas(oid);if(_6d!=null){_6d.setSignPadPossible(false);}}_6c.setSignPadPossible(true);_6b.ActiveXSignPad=id;return true;},clearSignPadCanvas:function(){var _6e=InkTool.InkCanvasLib;var oid=_6e.ActiveXSignPad;if(oid==null){return false;}var _6f=_6e.getCanvas(oid);if(_6f!=null){_6f.setSignPadPossible(false);}_6e.ActiveXSignPad=null;return true;},isSignPadAvailable:function(){var _70=InkTool.InkCanvasLib;if(_70.ActiveXSignPad!=null){var _71=_70.List[_70.ActiveXSignPad];if(_71!=null){return _71.isSignPadAvailable();}}for(var _72 in _70.List){var _71=_70.List[_72];if(_71.isSignPadAvailable()){return true;}}return false;},isSignPadConnecting:function(){var _73=InkTool.InkCanvasLib;if(_73.ActiveXSignPad!=null){var _74=_73.List[_73.ActiveXSignPad];if(_74!=null){return _74.isSignPadConnecting();}}for(var _75 in _73.List){var _74=_73.List[_75];if(_74.isSignPadAvailable()){return _74.isSignPadConnecting();}}return false;},getSignPadInfo:function(){var _76=InkTool.InkCanvasLib;if(_76.ActiveXSignPad!=null){var _77=_76.List[_76.ActiveXSignPad];if(_77!=null){return _77.getSignPadInfo();}}for(var _78 in _76.List){var _77=_76.List[_78];if(_77.isSignPadAvailable()){return _77.getSignPadInfo();}}for(var _78 in _76.List){var _77=_76.List[_78];return _77.getSignPadInfo();}return {};},setSignPadImageURL:function(url){var _79=InkTool.InkCanvasLib;_79.DeviceSignPadBackImageURL=url;if(_79.ActiveXSignPad!=null){var _7a=_79.List[_79.ActiveXSignPad];if(_7a!=null){_7a.setSignPadImageURL(url);return;}}for(var _7b in _79.List){var _7a=_79.List[_7b];if(_7a.isSignPadAvailable()){_7a.setSignPadImageURL(url);return;}}},clearSignPadImage:function(url){var _7c=InkTool.InkCanvasLib;_7c.DeviceSignPadBackImageURL=null;if(_7c.ActiveXSignPad!=null){var _7d=_7c.List[_7c.ActiveXSignPad];if(_7d!=null){_7d.clearSignPadImage();return;}}for(var _7e in _7c.List){var _7d=_7c.List[_7e];if(_7d.isSignPadAvailable()){_7d.cleartSignPadImage();return;}}},setSignPadFitControlSizeParams:function(_7f,_80,_81,_82,_83,_84,_85,_86){var _87=InkTool.InkCanvasLib;_87.DeviceSignPadFitControlSizeParams.ControlMargin.Left=_7f;_87.DeviceSignPadFitControlSizeParams.ControlMargin.Top=_80;_87.DeviceSignPadFitControlSizeParams.ControlMargin.Right=_81;_87.DeviceSignPadFitControlSizeParams.ControlMargin.Bottom=_82;_87.DeviceSignPadFitControlSizeParams.KeepAspectRatio=_83;_87.DeviceSignPadFitControlSizeParams.EmbedTabletInControl=_84;_87.DeviceSignPadFitControlSizeParams.Alignment.Horizontal=_85;_87.DeviceSignPadFitControlSizeParams.Alignment.Vertical=_86;},setSignPadFitControlSizeControlMargin:function(_88,_89,_8a,_8b){var _8c=InkTool.InkCanvasLib;_8c.DeviceSignPadFitControlSizeParams.ControlMargin.Left=_88;_8c.DeviceSignPadFitControlSizeParams.ControlMargin.Top=_89;_8c.DeviceSignPadFitControlSizeParams.ControlMargin.Right=_8a;_8c.DeviceSignPadFitControlSizeParams.ControlMargin.Bottom=_8b;},getSignPadFitControlSizeControlMargin:function(){var _8d=InkTool.InkCanvasLib;return _8d.DeviceSignPadFitControlSizeParams.ControlMargin;},setSignPadFitControlSizeKeepAspectRatio:function(_8e){var _8f=InkTool.InkCanvasLib;_8f.DeviceSignPadFitControlSizeParams.KeepAspectRatio=_8e;},getSignPadFitControlSizeKeepAspectRatio:function(){var _90=InkTool.InkCanvasLib;return _90.DeviceSignPadFitControlSizeParams.KeepAspectRatio;},setSignPadFitControlSizeEmbedSignPadInControl:function(_91){var _92=InkTool.InkCanvasLib;_92.DeviceSignPadFitControlSizeParams.EmbedTabletInControl=_91;},getSignPadFitControlSizeEmbedSignPadInControl:function(){var _93=InkTool.InkCanvasLib;return _93.DeviceSignPadFitControlSizeParams.EmbedTabletInControl;},setSignPadFitControlSizeAlignment:function(_94,_95){var _96=InkTool.InkCanvasLib;_96.DeviceSignPadFitControlSizeParams.Alignment.Horizontal=_94;_96.DeviceSignPadFitControlSizeParams.Alignment.Vertical=_95;},getSignPadFitControlSizeAlignment:function(){var _97=InkTool.InkCanvasLib;return _97.DeviceSignPadFitControlSizeParams.Alignment;},setPreventDragAndSelect:function(_98){InkTool.InkCanvasLib.PreventDragAndSelect=_98;},setUsePointer:function(_99,_9a){var _9b=InkTool.InkCanvasLib;var brs=_99.toLowerCase();if(brs=="ie"){_9b.UsePointerIE=_9a;}else{if(brs=="edge"){_9b.UsePointerEdge=_9a;}else{if(brs=="firefox"){_9b.UsePointerFireFox=_9a;}else{if(brs=="opera"){_9b.UsePointerOpera=_9a;}else{if(brs=="chrome"){_9b.UsePointerChrome=_9a;}else{if(brs=="safari"){_9b.UsePointerSafari=_9a;}else{if(brs=="mobilesafari"){_9b.UsePointerMobileSafari=_9a;}else{if(brs=="gecko"){_9b.UsePointerGecko=_9a;}else{if(brs=="webkit"){_9b.UsePointerWebkit=_9a;}else{_9b.UsePointerOthers=_9a;}}}}}}}}}},getUsePointer:function(_9c){var _9d=InkTool.InkCanvasLib;var brs=_9c.toLowerCase();if(brs=="ie"){return _9d.UsePointerIE;}else{if(brs=="edge"){return _9d.UsePointerEdge;}else{if(brs=="firefox"){return _9d.UsePointerFireFox;}else{if(brs=="opera"){return _9d.UsePointerOpera;}else{if(brs=="chrome"){return _9d.UsePointerChrome;}else{if(brs=="safari"){return _9d.UsePointerSafari;}else{if(brs=="mobilesafari"){return _9d.UsePointerMobileSafari;}else{if(brs=="gecko"){return _9d.UsePointerGecko;}else{if(brs=="webkit"){return _9d.UsePointerWebkit;}else{return _9d.UsePointerOthers;}}}}}}}}}},getUsePointerOfTheBrowser:function(){var _9e=InkTool.InkLib.Browser;var _9f=InkTool.InkCanvasLib;if(_9e.IE||_9e.IE11){return _9f.UsePointerIE;}else{if(_9e.Edge){return _9f.UsePointerEdge;}else{if(_9e.Firefox){return _9f.UsePointerFireFox;}else{if(_9e.Opera){return _9f.UsePointerOpera;}else{if(_9e.Chrome){return _9f.UsePointerChrome;}else{if(_9e.Safari){return _9f.UsePointerSafari;}else{if(_9e.MobileSafari){return _9f.UsePointerMobileSafari;}else{if(_9e.Gecko){return _9f.UsePointerGecko;}else{if(_9e.Webkit){return _9f.UsePointerWebkit;}else{return _9f.UsePointerOthers;}}}}}}}}}},suspendLibruary:function(){var _a0=InkTool.InkCanvasLib;_a0.PauseLib=true;},resumeLibruary:function(){var _a1=InkTool.InkCanvasLib;_a1.PauseLib=false;},setDebugLevel:function(_a2){InkTool.InkCanvasLib.DebugLevel=_a2;},isDebugging:function(){return (InkTool.InkCanvasLib.DebugLevel>0);},setAnalyzeLevel:function(_a3){InkTool.InkCanvasLib.AnalyzeLevel=_a3;},isAnalyzing:function(){return (InkTool.InkCanvasLib.AnalyzeLevel>0);},setAnalyzeDebugInfo:function(_a4){InkTool.InkCanvasLib.AnalyzeDebugInfo=_a4;},isAnalyzeDebugInfoShowing:function(){return (InkTool.InkCanvasLib.AnalyzeLevel>0&&InkTool.InkCanvasLib.AnalyzeDebugInfo>0);},getElementOfPosition:function(pos){var _a5=InkTool.InkLib.convertPositionEventToAbsolute(pos);var _a6=document.elementFromPoint(_a5.left,_a5.top);return _a6;},getElementOfPositionByPacket:function(_a7){if(_a7.etype=="pointer"){var xp=_a7.lastEvent.clientX;var yp=_a7.lastEvent.clientY;var _a8=document.elementFromPoint(xp,yp);return _a8;}else{return InkTool.InkCanvasLib.getElementOfPosition(_a7.lastPos);}},traceInterval:function(_a9){var _aa=InkTool.InkLib;var _ab=InkTool.InkCanvasLib;var _ac=_aa.needsEmulateCanvas();var _ad=(_a9==false&&_ac==false);for(var _ae in _ab.List){var _af=_ab.List[_ae];var _b0=_af.getUseEmulatingTimer();if(_a9){_af.tracePausing();}_af.traceInterval();}},traceTimeout:function(){var _b1=InkTool.InkCanvasLib;for(var _b2 in _b1.List){var _b3=_b1.List[_b2];_b3.traceTimeout();}_b1.TotalCopyCount++;},convertPositionDocumentToCanvas:function(pos,_b4){return {left:pos.left-_b4.srect.left,top:pos.top-_b4.srect.top};},preventDefaultAction:function(e){var _b5=InkTool.InkLib;var evt=_b5.getLastEvent(e);_b5.preventDefaultActionOfEvent(evt,true,false);},docPenDown:function(e){var _b6=InkTool.InkLib;var _b7=InkTool.InkCanvasLib;if(_b7.PenTrace.DocIsDrawing){return;}var evt=_b6.getLastEvent(e);var _b8=_b6.getButtonStatus(evt);if(_b8!=1){return;}_b7.DocLastDevice="mouse";var _b9=_b6.getEventPosition(evt);var _ba=Date.now();_b7.DocLLastPenDownPos.left=_b7.DocLastPenDownPos.left;_b7.DocLLastPenDownPos.top=_b7.DocLastPenDownPos.top;_b7.DocLastPenDownPos.left=_b9.left;_b7.DocLastPenDownPos.top=_b9.top;_b7.PenTrace.setPositionTimeAndEvent(_b9,_ba,evt);_b7.HotSpotHappening=false;var _bb=_b7.tracePenDown(_b7.PenTrace);if(_bb==true||_b7.HotSpotHappening==true){_b6.preventDefaultActionOfEvent(evt,true,true);}},docPenMove:function(e){var _bc=InkTool.InkLib;var _bd=InkTool.InkCanvasLib;var evt=_bc.getLastEvent(e);var _be=_bc.getButtonStatus(evt);var _bf=_bc.getEventPosition(evt);var _c0=_bd.PenTrace;var _c1=_bd.DocLastPenDownIgnored;_bd.DocLastDevice="mouse";_c0.setPositionAndEvent(_bf,evt);if(_c0.DocIsDrawing==false||_c1!=0){if(_be==1&&(_bc.Browser.IE||_c1!=0)){_bd.DocLLastPenDownPos.left=_bd.DocLastPenDownPos.left;_bd.DocLLastPenDownPos.top=_bd.DocLastPenDownPos.top;_bd.DocLastPenDownPos.left=_bf.left;_bd.DocLastPenDownPos.top=_bf.top;_bd.tracePenDown(_c0);}else{return;}}else{if(_be==0){_bd.tracePenUp(_c0,1);return;}}var _c2=_bd.tracePenMove(_c0);if(_c2==true||_bd.HotSpotHappening==true){_bc.preventDefaultActionOfEvent(evt,true,true);}},docPenUp:function(e){var _c3=InkTool.InkLib;var _c4=InkTool.InkCanvasLib;if(_c4.PenTrace.DocIsDrawing==false){return;}var evt=_c3.getLastEvent(e);var _c5=_c3.getButtonStatus(evt);if(_c5!=1){return;}_c4.DocLastDevice="mouse";var _c6=_c3.getEventPosition(evt);_c4.PenTrace.setPositionAndEvent(_c6,evt);_c4.DocLLastPenUpTime=_c4.DocLastPenUpTime;_c4.DocLastPenUpTime=_c4.PenTrace.getLastTime();_c4.DocLastPenDownIgnored=0;if(_c3.Browser.Chrome){var _c7=_c4.PenTrace.getLastPosDistance();if(_c7>=1){_c4.tracePenMove(_c4.PenTrace);}}var _c8=_c4.tracePenUp(_c4.PenTrace,0);_c4.PenTrace.DocIsDrawing=false;if(_c8==true||_c4.HotSpotHappening==true){_c3.preventDefaultActionOfEvent(evt,true,true);}},docPenCancel:function(e){var _c9=InkTool.InkLib;var _ca=InkTool.InkCanvasLib;if(_ca.PenTrace.DocIsDrawing==false){return;}var evt=_c9.getLastEvent(e);var _cb=_c9.getEventPosition(evt);_ca.PenTrace.setPositionAndEvent(_cb,evt);_ca.tracePenUp(_ca.PenTrace,1);_ca.PenTrace.DocIsDrawing=false;_ca.DocLastPenDownIgnored=0;},docPenCancelByDrag:function(e){var _cc=InkTool.InkLib;var _cd=InkTool.InkCanvasLib;var evt=_cc.getLastEvent(e);var _ce=_cc.getEventPosition(evt);_cd.PenTrace.setPositionAndEvent(_ce,evt);_cd.tracePenUp(_cd.PenTrace,1);_cd.PenTrace.DocIsDrawing=false;_cd.DocLastPenDownIgnored=0;var _cf=_cd.PointerTraceList.length;for(var tct=0;tct<_cf;tct++){var _d0=_cd.PointerTraceList[tct];if(_d0.crntMode>=0){_cd.tracePenUp(_d0,1);_d0.crntMode=2;}}_cd.docPointerTracePurge();var _d1=_cd.TouchTraceList.length;for(var tct=0;tct<_d1;tct++){var _d0=_cd.TouchTraceList[tct];if(_d0.crntMode>=0){_cd.tracePenUp(_d0,1);_d0.crntMode=2;}}_cd.docTouchTracePurge();},docClick:function(e){var _d2=InkTool.InkCanvasLib;_d2.docPenCancelByDrag(e);},docDblClick:function(e){var _d3=InkTool.InkCanvasLib;_d3.docPenCancelByDrag(e);},getElementIdOfTracePacket:function(_d4){var _d5=InkTool.InkLib;if(_d4.etype=="touch"){return _d5.getElementIdOfTouchEventPosition(_d4.lastEvent,_d4.touchIndex);}else{return _d5.getElementIdOfEventPosition(_d4.lastEvent);}},tracePenDown:function(_d6){var _d7=InkTool.InkLib;var _d8=InkTool.InkCanvasLib;var _d9=false;_d6.DocIsDrawing=true;if(_d8.TimerCopy!=null){clearTimeout(_d8.TimerCopy);_d8.TimerCopy=null;}var _da=_d6.lastPos;var tid=_d8.getElementIdOfTracePacket(_d6);for(var _db in _d8.List){var _dc=_d8.List[_db];if(_dc.srect.containsPosition(_da)&&_dc.isCanvasId(tid)){if(_dc.doPenDown(_d6,false)){_d9=true;}if(_dc.hotspotMode!=0){_d8.HotSpotHappening=true;}}}return _d9;},performPenDown:function(tid,xp,yp){var _dd=InkTool.InkLib;var _de=InkTool.InkCanvasLib;if(xp===undefined){xp=0;}if(yp===undefined){yp=0;}var _df=_de.List[tid];if(_df!=null){_df.performPenDown(xp,yp);}},tracePenMove:function(_e0){var _e1=InkTool.InkLib;var _e2=InkTool.InkCanvasLib;var _e3=false;if(_e2.TimerCopy!=null){clearTimeout(_e2.TimerCopy);_e2.TimerCopy=null;}var _e4=_e0.lastPos;var tid=_e2.getElementIdOfTracePacket(_e0);for(var _e5 in _e2.List){var _e6=_e2.List[_e5];var _e7=_e0.List[_e5];if(_e6.srect.containsPosition(_e4)&&_e6.isCanvasId(tid)){if(_e7.isDrawing==false&&_e6.hotspotMode==0){var _e8=_e0.getLastPosDistance();if(_e8>=_e2.DocPenEnterLimitDistance){if(_e6.doPenDown(_e0,false)==true){_e3=true;}}else{if(_e6.doPenDown(_e0,true)==true){_e3=true;}if(_e6.doPenMove(_e0)==true){_e3=true;}}}else{if(_e6.doPenMove(_e0)==true){_e3=true;}}}else{if(_e7.isDrawing==true){_e6.doTracePausing(_e7,_e0.getLastTime(),1,_e0);if(_e6.doPenUp(_e0,0)==true){_e3=true;}}}}return _e3;},performPenMove:function(tid,xp,yp){var _e9=InkTool.InkLib;var _ea=InkTool.InkCanvasLib;if(xp===undefined){xp=0;}if(yp===undefined){yp=0;}var _eb=_ea.List[tid];if(_eb!=null){_eb.performPenMove(xp,yp);}},tracePenUp:function(_ec,_ed){var _ee=InkTool.InkLib;var _ef=InkTool.InkCanvasLib;var _f0=false;_ec.DocIsDrawing=false;if(_ef.TimerCopy!=null){clearTimeout(_ef.TimerCopy);_ef.TimerCopy=null;}for(var _f1 in _ef.List){var _f2=_ef.List[_f1];var _f3=_ec.List[_f1];if(_f3.isDrawing==true||_f2.hotspotMode!=0){if(_f2.doPenUp(_ec,_ed)){_f0=true;}}else{if(_ed==0&&_f2.nonDrawPenUpInnerFunc!=null){var _f4=_f2.convertPositionDocumentToCanvas(_ec.lastPos,_f2,_f2.drawingContext);_f2.nonDrawPenUpInnerFunc(_f2,_f4);}}}_ef.TimerCopy=setTimeout(function(){_ef.traceTimeout();},250);return _f0;},performPenUp:function(tid,xp,yp){if(xp===undefined){xp=0;}if(yp===undefined){yp=0;}var _f5=InkTool.InkLib;var _f6=InkTool.InkCanvasLib;var _f7=_f6.List[tid];if(_f7!=null){_f7.performPenUp(xp,yp);}},performSignPadUp:function(tid,xp,yp){if(xp===undefined){xp=0;}if(yp===undefined){yp=0;}var _f8=InkTool.InkLib;var _f9=InkTool.InkCanvasLib;var _fa=_f9.List[tid];if(_fa!=null){_fa.performSignPadUp(xp,yp);}},docMSPointerDown:function(e){var _fb=InkTool.InkLib;var _fc=InkTool.InkCanvasLib;_fc.checkCanvasLocation();var evt=_fb.getLastEvent(e);if(_fc.PointerEnableAll!=true){var _fd=_fb.getEventPointerType(evt);switch(_fd){case "touch":if(_fc.PointerEnableTouch!=true){return;}break;case "pen":if(_fc.PointerEnablePen!=true){return;}break;case "mouse":if(_fc.PointerEnableMouse!=true){return;}break;default:if(_fc.PointerEnableUnknown!=true){return;}break;}}var _fe=_fb.getScrollX();var _ff=_fb.getScrollY();var _100=_fb.getClientWidth();var _101=_fb.getClientHeight();var epos=_fb.getEventPosition(evt);if((epos.left>=_fe&&epos.left<_fe+_100&&epos.top>=_ff&&epos.top<_ff+_101)==false){return;}var _102;_fc.HotSpotHappening=false;if(_fc.MultiTouchMax>1){_102=_fc.docPointerDispatch(0,evt);}else{var _103=_fc.PointerTraceList[0];var epos=_fb.getEventPosition(evt);var id=_fb.getPointerEventId(evt);var _104=Date.now();if(_fc.DocLastPenDownPos.left==epos.left&&_fc.DocLastPenDownPos.top==epos.top){if(_fc.DocLastPenUpTime+1000>_104){_fc.DocLastPenDownIgnored=1;}}else{if(_fc.DocLLastPenDownPos.left==epos.left&&_fc.DocLLastPenDownPos.top==epos.top){if(_fc.DocLLastPenUpTime+1000>_104){_fc.DocLastPenDownIgnored=2;}}else{_fc.DocLLastPenDownPos.left=_fc.DocLastPenDownPos.left;_fc.DocLLastPenDownPos.top=_fc.DocLastPenDownPos.top;_fc.DocLastPenDownPos.left=epos.left;_fc.DocLastPenDownPos.top=epos.top;}}_103.id=id;_103.setPositionTimeAndEvent(epos,_104,evt);_103.crntMode=0;_102=_fc.tracePenDown(_103);if(_102==false&&_fc.DocLastPenDownIgnored!=0){_103.crntMode=-1;}}if(_102==true||_fc.HotSpotHappening==true){_fb.preventDefaultActionOfEvent(evt,true,true);}},checkCanvasLocation:function(){var _105=InkTool.InkLib;var _106=InkTool.InkCanvasLib;for(var _107 in _106.List){var cobj=_106.List[_107];cobj.relocation();}},docMSPointerMove:function(e){var _108=InkTool.InkLib;var _109=InkTool.InkCanvasLib;var evt=_108.getLastEvent(e);if(_109.PointerEnableAll!=true){var _10a=_108.getEventPointerType(evt);switch(_10a){case "touch":if(_109.PointerEnableTouch!=true){return;}break;case "pen":if(_109.PointerEnablePen!=true){return;}break;case "mouse":if(_109.PointerEnableMouse!=true){return;}break;default:if(_109.PointerEnableUnknown!=true){return;}break;}}var _10b;if(_109.MultiTouchMax>1){_10b=_109.docPointerDispatch(1,evt);}else{var _10c=_109.PointerTraceList[0];var epos=_108.getEventPosition(evt);var id=_108.getPointerEventId(evt);var _10d=_109.DocLastPenDownIgnored;if(_10d!=0){if(_10d==1&&_109.DocLastPenDownPos.left==epos.left&&_109.DocLastPenDownPos.top==epos.top){return;}if(_10d==2&&_109.DocLLastPenDownPos.left==epos.left&&_109.DocLLastPenDownPos.top==epos.top){return;}_109.DocLastPenDownIgnored=0;}if(_10c.id==id&&_10c.crntMode>=0){_10c.setPositionAndEvent(epos,evt);_10c.crntMode=1;_10b=_109.tracePenMove(_10c);}else{if(_10d!=0){_109.DocLLastPenDownPos.left=_109.DocLastPenDownPos.left;_109.DocLLastPenDownPos.top=_109.DocLastPenDownPos.top;_109.DocLastPenDownPos.left=epos.left;_109.DocLastPenDownPos.top=epos.top;_10c.setPositionAndEvent(epos,evt);_10c.crntMode=0;_10b=_109.tracePenDown(_10c);}else{_10b=false;}}}if(_10b==true||_109.HotSpotHappening==true){_108.preventDefaultActionOfEvent(evt,true,true);}},docMSPointerUp:function(e){var _10e=InkTool.InkLib;var _10f=InkTool.InkCanvasLib;var evt=_10e.getLastEvent(e);if(_10f.PointerEnableAll!=true){var _110=_10e.getEventPointerType(evt);switch(_110){case "touch":if(_10f.PointerEnableTouch!=true){return;}break;case "pen":if(_10f.PointerEnablePen!=true){return;}break;case "mouse":if(_10f.PointerEnableMouse!=true){return;}break;default:if(_10f.PointerEnableUnknown!=true){return;}break;}}var _111;if(_10f.MultiTouchMax>1){_111=_10f.docPointerDispatch(2,evt);}else{var _112=_10f.PointerTraceList[0];var epos=_10e.getEventPosition(evt);_112.setPositionAndEvent(epos,evt);_112.crntMode=2;_10f.DocLLastPenUpTime=_10f.DocLastPenUpTime;_10f.DocLastPenUpTime=_112.getLastTime();_10f.DocLastPenDownIgnored=0;_111=_10f.tracePenUp(_112,0);_112.crntMode=-1;}if(_111==true||_10f.HotSpotHappening==true){_10e.preventDefaultActionOfEvent(evt,true,true);}},docPointerDispatch:function(mode,evt){var _113=InkTool.InkLib;var _114=InkTool.InkCanvasLib;_114.DocLastDevice="mspointer";var epos=_113.getEventPosition(evt);var id=_113.getPointerEventId(evt);var _115=false;if(mode==0){var _116=_114.findPointerTracePacket(id);if(_116==null){var _117=_114.findEmptyPointerTracePacket();if(_117!=null){var _118=true;var _119=Date.now();if(_114.DocLastPenDownPos.left==epos.left&&_114.DocLastPenDownPos.top==epos.top){if(_114.DocLastPenUpTime+1000>_119){_114.DocLastPenDownIgnored=1;}}else{if(_114.DocLLastPenDownPos.left==epos.left&&_114.DocLLastPenDownPos.top==epos.top){if(_114.DocLLastPenUpTime+1000>_119){_114.DocLastPenDownIgnored=2;}}else{_114.DocLLastPenDownPos.left=_114.DocLastPenDownPos.left;_114.DocLLastPenDownPos.top=_114.DocLastPenDownPos.top;_114.DocLastPenDownPos.left=epos.left;_114.DocLastPenDownPos.top=epos.top;}}if(_118){_117.id=id;_117.setPositionTimeAndEvent(epos,_119,evt);_117.crntMode=0;if(_114.tracePenDown(_117)==true){_115=true;}else{if(_114.DocLastPenDownIgnored!=0){_117.crntMode=-1;}}}}}else{}}else{if(mode==1){var _116=_114.findPointerTracePacket(id);if(_116==null){var _117=_114.findEmptyPointerTracePacket();if(_117!=null){var _118=false;var _11a=_114.DocLastPenDownIgnored;if(_11a!=0){_118=true;if(_11a==1&&_114.DocLastPenDownPos.left==epos.left&&_114.DocLastPenDownPos.top==epos.top){_118=false;}if(_11a==2&&_114.DocLLastPenDownPos.left==epos.left&&_114.DocLLastPenDownPos.top==epos.top){_118=false;}if(_118==true){_114.DocLastPenDownIgnored=0;_114.DocLLastPenDownPos.left=_114.DocLastPenDownPos.left;_114.DocLLastPenDownPos.top=_114.DocLastPenDownPos.top;_114.DocLastPenDownPos.left=epos.left;_114.DocLastPenDownPos.top=epos.top;}}if(_118==true){_117.id=id;_117.setPositionAndEvent(epos,evt);_117.crntMode=0;if(_114.tracePenDown(_117)==true){_115=true;}else{if(_114.DocLastPenDownIgnored!=0){_117.crntMode=-1;}}}}}else{_116.setPositionAndEvent(epos,evt);_116.crntMode=1;if(_114.tracePenMove(_116)==true){_115=true;}}}else{var _116=_114.findPointerTracePacket(id);if(_116==null){}else{_116.setPositionAndEvent(epos,evt);_116.crntMode=2;if(_114.tracePenUp(_116,0)==true){_115=true;}_114.DocLLastPenUpTime=_114.DocLastPenUpTime;_114.DocLastPenUpTime=_116.getLastTime();_114.DocLastPenDownIgnored=0;}}}_114.docPointerTracePurge();return _115;},findPointerTracePacket:function(id){var _11b=InkTool.InkLib;var _11c=InkTool.InkCanvasLib;var _11d=_11c.PointerTraceList.length;for(var idx=0;idx<_11d;idx++){var _11e=_11c.PointerTraceList[idx];if(_11e.id==id&&_11e.crntMode>=0){return _11e;}}return null;},findEmptyPointerTracePacket:function(){var _11f=InkTool.InkLib;var _120=InkTool.InkCanvasLib;var _121=_120.PointerTraceList.length;for(var idx=0;idx<_121;idx++){var _122=_120.PointerTraceList[idx];if(_122.crntMode<0){return _122;}}var _123=-1;var _124=-1;for(var idx=0;idx<_121;idx++){var _122=_120.PointerTraceList[idx];var time=_122.getLastTime();if(_124<0||_123>time){_124=idx;_123=time;}}if(_124>=0){var _122=_120.PointerTraceList[_124];_122.crntMode=-1;_122.id=-1;return _122;}return null;},docPointerTracePurge:function(){var _125=InkTool.InkCanvasLib;var _126=_125.PointerTraceList.length;for(var idx=_126-1;idx>=0;idx--){if(_125.PointerTraceList[idx].crntMode==2){_125.PointerTraceList[idx].crntMode=-1;_125.PointerTraceList[idx].id=-1;}}},docTouchDown:function(e){var _127=InkTool.InkLib;var _128=InkTool.InkCanvasLib;var evt=_127.getLastEvent(e);var _129;_128.HotSpotHappening=false;if(_128.MultiTouchMax>1){_129=_128.docTouchDispatch(0,evt);}else{var epos=_127.getTouchEventPosition(evt,0);var id=_127.getTouchEventId(evt,0);var _12a=_128.TouchTraceList[0];_12a.id=id;_12a.touchIndex=0;_12a.setPositionAndEvent(epos,evt);_12a.crntMode=0;_129=_128.tracePenDown(_12a);}if(_129==true||_128.HotSpotHappening==true){_127.preventDefaultActionOfEvent(evt,true,true);}},docTouchMove:function(e){var _12b=InkTool.InkLib;var _12c=InkTool.InkCanvasLib;var evt=_12b.getLastEvent(e);var _12d;if(_12c.MultiTouchMax>1){_12d=_12c.docTouchDispatch(1,evt);}else{var _12e=_12c.TouchTraceList[0];var _12f=-1;var _130=_12b.getTouchEventPositionsLength(evt);for(var idx=0;idx<_130;idx++){var tid=_12b.getTouchEventId(evt,idx);if(tid==_12e.id){_12f=idx;break;}}if(_12f>=0){var epos=_12b.getTouchEventPosition(evt,_12f);var id=_12b.getTouchEventId(evt,_12f);_12e.id=id;_12e.touchIndex=_12f;_12e.setPositionAndEvent(epos,evt);_12e.crntMode=1;_12d=_12c.tracePenMove(_12e);}}if(_12d==true||_12c.HotSpotHappening==true){_12b.preventDefaultActionOfEvent(evt,true,true);}},docTouchUp:function(e){var _131=InkTool.InkLib;var _132=InkTool.InkCanvasLib;var evt=_131.getLastEvent(e);var _133;if(_132.MultiTouchMax>1){_133=_132.docTouchDispatch(2,evt);}else{var _134=_132.TouchTraceList[0];_134.crntMode=2;_133=_132.tracePenUp(_134,0);}if(_133==true||_132.HotSpotHappening==true){_131.preventDefaultActionOfEvent(evt,true,true);}},docTouchDispatch:function(mode,evt){var _135=InkTool.InkLib;var _136=InkTool.InkCanvasLib;_136.DocLastDevice="touch";var _137=false;var _138=_136.TouchTraceList.length;if(mode==0){_136.docTouchTraceChange(mode,evt);}else{if(mode==1){_136.docTouchTraceChange(mode,evt);}else{_136.docTouchTraceChange(mode,evt);}}for(var idx=0;idx<_138;idx++){var _139=_136.TouchTraceList[idx];if(_139.crntMode==0){if(_136.tracePenDown(_139)==true){_137=true;}}else{if(_139.crntMode==1){if(_136.tracePenMove(_139)==true){_137=true;}}else{if(_139.crntMode==2){if(_136.tracePenUp(_139,0)==true){_137=true;}}}}}_136.docTouchTracePurge();return _137;},docTouchTraceChange:function(mode,evt){var _13a=InkTool.InkLib;var _13b=InkTool.InkCanvasLib;var _13c=_13b.TouchTraceList.length;var _13d=_13a.getTouchEventPositionsLength(evt);var _13e=_13a.getChangedTouchEventPositionsLength(evt);for(var idx=0;idx<_13c;idx++){var _13f=_13b.TouchTraceList[idx];if(_13f.crntMode>=0){_13f.crntMode=2;}}for(var idx=0;idx<_13d;idx++){var epos=_13a.getTouchEventPosition(evt,idx);var id=_13a.getTouchEventId(evt,idx);var _140=false;for(var cct=0;cct<_13e;cct++){var cid=_13a.getChangedTouchEventId(evt,cct);if(id==cid){_140=true;break;}}var _141=-1;for(var tct=0;tct<_13c;tct++){var _13f=_13b.TouchTraceList[tct];if(_13f.id==id&&_13f.crntMode>=0){_141=tct;break;}}if(_141>=0){var _13f=_13b.TouchTraceList[_141];_13f.setPositionAndEvent(epos,evt);_13f.touchIndex=idx;if(_140==false){_13f.crntMode=3;}else{_13f.crntMode=1;}}else{var _13f=null;for(var tct=0;tct<_13c;tct++){var _142=_13b.TouchTraceList[tct];if(_142.crntMode<0){_13f=_142;break;}}if(_13f!=null){_13f.id=id;_13f.touchIndex=idx;_13f.setPositionAndEvent(epos,evt);_13f.crntMode=0;}}}},docTouchTracePurge:function(){var _143=InkTool.InkCanvasLib;var _144=_143.TouchTraceList.length;for(var idx=_144-1;idx>=0;idx--){if(_143.TouchTraceList[idx].crntMode==2){_143.TouchTraceList[idx].crntMode=-1;}}},docGestureDown:function(e){var _145=InkTool.InkLib;var _146=InkTool.InkCanvasLib;var evt=_145.getLastEvent(e);_146.HotSpotHappening=false;var _147=_146.docGestureDispatch(0,evt);if(_147==true||_146.HotSpotHappening==true){_145.preventDefaultActionOfEvent(evt,true,true);}},docGestureMove:function(e){var _148=InkTool.InkLib;var _149=InkTool.InkCanvasLib;var evt=_148.getLastEvent(e);var _14a=_149.docGestureDispatch(1,evt);if(_14a==true||_149.HotSpotHappening==true){_148.preventDefaultActionOfEvent(evt,true,true);}},docGestureUp:function(e){var _14b=InkTool.InkLib;var _14c=InkTool.InkCanvasLib;var evt=_14b.getLastEvent(e);var _14d=_14c.docGestureDispatch(2,evt);if(_14d==true||_14c.HotSpotHappening==true){_14b.preventDefaultActionOfEvent(evt,true,true);}},docGestureDispatch:function(mode,evt){var _14e=InkTool.InkLib;var _14f=InkTool.InkCanvasLib;_14f.DocLastDevice="gesture";return false;},getCanvas:function(id){return InkTool.InkCanvasLib.List[id];},getDrawingCanvas:function(id){return InkTool.InkCanvasLib.List[id];},getCanvasIdList:function(){var keys=[];for(var key in InkTool.InkCanvasLib.List){keys.push(key);}return keys;},createCanvas:function(id,_150,_151,_152){var _153=InkTool.InkLib;var _154=InkTool.InkCanvasLib;var _155=_153.getElementById(id);if(_155==null){return null;}_154.initialize();var mode=0;if(_150===undefined||_150===null||_150===""){_150="standard";}else{if(_150==="overflow"){_150="standard";mode=10;}}if(_151===undefined||_151===null){_151=0;}if(_152===undefined||_152===null){_152=0;}var axex;if(_150!="standard"){axex=_154.checkActiveX();}else{axex=false;}var _156=false;if(_150=="auto"||_150=="auto+sp"){if(_150=="auto+sp"){_156=true;}if(axex==true){_150="activex";}else{_150="standard";}}else{if(_150=="activex+sp"){_150="activex";_156=true;}}var _157=_154.CanvasClasses[_150];if(_157==null){_157=InkTool.InkCanvasBase;}var _158=new _157(_155,0,0,mode,_151,_152,null,_156);_154.List[id]=_158;return _158;},createViewCanvas:function(id,_159){var _15a=InkTool.InkLib;var _15b=InkTool.InkCanvasLib;var _15c=_15a.getElementById(id);if(_15c==null){return null;}var _15d=_15a.getElementById(_159);if(_15d==null){return null;}_15b.initialize();var _15e="standard";var _15f=0;var _160=0;var _161=false;var _162=_15b.CanvasClasses[_15e];if(_162==null){_162=InkTool.InkCanvasBase;}var _163=new _162(_15c,0,0,0,_15f,_160,_15d,_161);_15b.List[id]=_163;return _163;},createFepCanvas:function(id,_164){var _165=InkTool.InkLib;var _166=InkTool.InkCanvasLib;var _167=_165.getElementById(id);if(_167==null){return null;}_166.initialize();var mode=1;if(_164===undefined||_164===null||_164===""){_164="standard";}else{if(_164==="overflow"){_164="standard";mode=11;}}var _168=_166.CanvasClasses["standard"];if(_168==null){_168=InkTool.InkCanvasBase;}var _169=new _168(_167,0,0,mode,0,0,null,false);_166.List[id]=_169;return _169;},createPDFCanvas:function(id,_16a){var _16b=InkTool.InkLib;var _16c=InkTool.InkCanvasLib;var _16d=_16b.getElementById(id);if(_16d==null){return null;}_16c.initialize();var mode=2;if(_16a===undefined||_16a===null||_16a===""){_16a="standard";}else{if(_16a==="overflow"){_16a="standard";mode=12;}}var _16e=_16c.CanvasClasses["standard"];if(_16e==null){_16e=InkTool.InkCanvasBase;}var _16f=new _16e(_16d,0,0,mode,0,0,null,false);_16c.List[id]=_16f;return _16f;},relayoutCanvas:function(id){var _170=InkTool.InkCanvasLib;var _171=_170.List[id];if(_171==null){return false;}return _171.relayout();},hideCanvas:function(id){var _172=InkTool.InkCanvasLib;var _173=_172.List[id];if(_173==null){return false;}return _173.display(false);},showCanvas:function(id){var _174=InkTool.InkCanvasLib;var _175=_174.List[id];if(_175==null){return false;}return _175.display(true);},createDummyCanvas:function(_176,_177){if(InkTool.InkCanvasLib.DummyDiv==null||InkTool.InkCanvasLib.DummyCanvas==null){var _178=document.createElement("div");_178.id="inkTool_dummy_canvas_div";_178.onselectstart=function(){return false;};_178.ondragstart=function(){return false;};_178.ontouchmove=function(e){InkTool.InkCanvasLib.preventDefaultAction(e);};_178.style.userSelect="none";_178.style.MozUserSelect="none";_178.style.webkitUserSelect="none";_178.style.msUserSelect="none";_178.style.msTouchAction="none";_178.style.touchAction="none";_178.style.position="absolute";_178.style.left="0px";_178.style.top="0px";_178.style.visibility="hidden";_178.style.padding="0px";_178.width=_176;_178.height=_177;InkTool.InkCanvasLib.DummyDiv=_178;var _179=document.createElement("canvas");_179.id="inktool_dummy_canvas";_179.onselectstart=function(){return false;};_179.ondragstart=function(){return false;};_179.ontouchmove=function(e){InkTool.InkCanvasLib.preventDefaultAction(e);};_179.style.userSelect="none";_179.style.MozUserSelect="none";_179.style.webkitUserSelect="none";_179.style.msUserSelect="none";_179.style.msTouchAction="none";_179.style.touchAction="none";_179.width=_176;_179.height=_177;if(InkTool.InkLib.needsEmulateCanvas()){G_vmlCanvasManager.initElement(_179);}InkTool.InkCanvasLib.DummyCanvas=_179;_178.appendChild(_179);document.body.appendChild(_178);return _179;}else{var _178=InkTool.InkCanvasLib.DummyDiv;_178.width=_176;_178.height=_177;var _179=InkTool.InkCanvasLib.DummyCanvas;_179.width=_176;_179.height=_177;return _179;}},releaseDummyCanvas:function(){InkTool.InkCanvasLib.createDummyCanvas(1,1);},getTotalDrawingTime:function(){return InkTool.InkCanvasLib.TotalDrawingTime;},getTotalDrawingCells:function(){return InkTool.InkCanvasLib.TotalDrawingCells;},getAveDrawingTime:function(){var _17a=InkTool.InkCanvasLib.TotalDrawingTime;var _17b=InkTool.InkCanvasLib.TotalDrawingCells;return _17a/_17b;},getTotalCopyCount:function(){return InkTool.InkCanvasLib.TotalCopyCount;},doNothing:function(){return false;},sendInk:function(id,url){var _17c=InkTool.InkCanvasLib.getCanvas(id);if(_17c==null){return;}if(_17c.countDrawItems()==0){return;}var _17d=_17c.saveInk();this.sendString("InkData="+_17d,url);},sendInkShort:function(id,url){var _17e=InkTool.InkCanvasLib.getCanvas(id);if(_17e==null){return;}if(_17e.countDrawItems()==0){return;}var _17f=_17e.saveInkShort();this.sendString("InkData="+_17f,url);},sendString:function(str,url,_180){var _181=InkTool.InkCanvasLib.getXmlHttpObject();_181.onreadystatechange=function(){if(_181.readyState==4&&_181.status==200){try{if(typeof (_180)==="function"){_180(_181.responseText);}else{alert("resp="+_181.responseText);}}catch(e){alert("request parse error:"+e);}}else{if(_181.readyState==4){alert("status error:"+_181.status+":resp="+_181.responseText);}}};try{_181.open("POST",url,true);_181.setRequestHeader("CONTENT-TYPE","application/x-www-form-urlencoded");_181.send(str);}catch(e){alert("http send error:"+e);}},getXmlHttpObject:function(){var _182=null;try{_182=new XMLHttpRequest();}catch(e){try{_182=new ActiveXObject("Msxml2.XMLHTTP");}catch(e){_182=new ActiveXObject("Microsoft.XMLHTTP");}}return _182;},Dummy:null};}if(typeof InkTool.InkTracePacket==="undefined"){InkTool.InkTracePacket=InkTool.InkLib.Class.create(null,{initialize:function(_183){this.serialNo=_183;this.arrayCell=new Array();this.arrayCopy=new Array();this.llastX=0;this.llastY=0;this.llastT=0;this.lastX=0;this.lastY=0;this.lastT=0;this.moveCount=0;this.testTimeStr="";this.lastV1=0;this.lastV2=0;this.lastV3=0;this.lastV4=0;this.lastV5=0;this.lastMovePos={"left":0,"top":0};this.isDrawing=false;this.pen=null;this.drawingContext=null;this.drawingStroke=false;this.currentStroke=null;this.currentStatus;this.startTime=null;this.endTime=null;},addCell:function(cell){this.arrayCell.push(cell);},dummy:function(){}});}else{if(InkTool.InkCanvasLib.Combinable!==true){alert("Version mismatched!");}}if(typeof InkTool.InkCanvasBase==="undefined"){InkTool.InkCanvasBase=InkTool.InkLib.Class.create(null,{Extended:false,initialize:function(_184,_185,_186,mode,_187,_188,_189,_18a){var _18b=InkTool.InkLib;var _18c=InkTool.InkCanvasLib;var _18d=this;if(_184==null){this.Initialized=false;return;}var epos=_18b.getElementAbsoluteLocation(_184);var _18e=_18b.getElementLocation(_184);var _18f=_18b.getElementSize(_184);if(_18f.width<8){_18f.width=8;}if(_18f.height<8){_18f.height=8;}var _190=_186;if(_190==0){_190=_18b.getStyleOfElement(_184,"z-index",null);}this.Version=_18c.Version;this.CanvasType="standard";this.DeviceType="unknown";this.CanvasInfo={"version":_18c.Version,"name":"InkCanvas","signpad":false,"replay":true};this.drawingMode=0;this.replayMode=0;this.hotspotMode=0;this.canPenMove=false;this.useEmulatingTimer=InkTool.InkLib.needsEmulateCanvas();this.featureDetectingBendDist=_18c.FeatureDetectingBendDist;this.featureDetectingStraightDist=_18c.FeatureDetectingStraightDist;this.featureDetectingTimeDist=_18c.FeatureDetectingTimeDist;this.featureDetectingSharpDist=_18c.FeatureDetectingSharpDist;this.baseWidth=_187;this.baseHeight=_188;_184.onselectstart=function(){return false;};_184.ondragstart=function(){return false;};_184.ontouchmove=function(e){if(_18d.drawingMode!=0){InkTool.InkCanvasLib.preventDefaultAction(e);}};_184.style.userSelect="none";_184.style.MozUserSelect="none";_184.style.webkitUserSelect="none";_184.style.msUserSelect="none";_184.style.msTouchAction="none";_184.style.touchAction="none";this.id=_184.id;this.altid=null;this.zorder=_186;this.ezindex=_190;if(mode>=10){this.supportDivOverflow=true;mode=(mode%10);}else{this.supportDivOverflow=false;}this.viewZoomRatio=1;this.viewOffsetX=0;this.viewOffsetY=0;this.viewTimer=null;if(_189!=null){this.viewMode=1;this.viewRatio=3;this.viewWidth=_18f.width*this.viewRatio;this.viewHeight=_18f.height*this.viewRatio;this.viewTranslateX=-((this.viewWidth-_18f.width)/2);this.viewTranslateY=-((this.viewHeight-_18f.height)/2);this.altid=_189.id;this.container=document.createElement("div");this.container.id="inktool_"+this.id+"_container";this.container.onselectstart=function(){return false;};this.container.ondragstart=function(){return false;};this.container.ontouchmove=function(e){if(_18d.drawingMode!=0){InkTool.InkCanvasLib.preventDefaultAction(e);}};this.container.style.userSelect="none";this.container.style.MozUserSelect="none";this.container.style.webkitUserSelect="none";this.container.style.msUserSelect="none";this.container.style.msTouchAction="none";this.container.style.touchAction="none";this.container.style.position="absolute";this.container.style.left=""+epos.left+"px";this.container.style.top=""+epos.top+"px";this.container.style.width=""+_18f.width+"px";this.container.style.height=""+_18f.height+"px";this.container.style.margin="0px";this.container.style.padding="0px";if(_190!==null){this.container.style.zIndex=_190;}this.container.style.overflow="hidden";this.bcanvas=document.createElement("canvas");this.bcanvas.id="inktool_"+this.id+"_back";this.bcanvas.onselectstart=function(){return false;};this.bcanvas.ondragstart=function(){return false;};this.bcanvas.ontouchmove=function(e){if(_18d.drawingMode!=0){InkTool.InkCanvasLib.preventDefaultAction(e);}};this.bcanvas.style.userSelect="none";this.bcanvas.style.MozUserSelect="none";this.bcanvas.style.webkitUserSelect="none";this.bcanvas.style.msUserSelect="none";this.bcanvas.style.msTouchAction="none";this.bcanvas.style.touchAction="none";this.bcanvas.style.position="static";this.bcanvas.width=this.viewWidth;this.bcanvas.height=this.viewHeight;if(_190!==null){this.bcanvas.style.zIndex=_190;}this.container.appendChild(this.bcanvas);this.dcanvas=document.createElement("canvas");this.dcanvas.id="inktool_"+this.id+"_draw";this.dcanvas.onselectstart=function(){return false;};this.dcanvas.ondragstart=function(){return false;};this.dcanvas.ontouchmove=function(e){if(_18d.drawingMode!=0){InkTool.InkCanvasLib.preventDefaultAction(e);}};this.dcanvas.style.userSelect="none";this.dcanvas.style.MozUserSelect="none";this.dcanvas.style.webkitUserSelect="none";this.dcanvas.style.msUserSelect="none";this.dcanvas.style.msTouchAction="none";this.dcanvas.style.touchAction="none";this.dcanvas.style.position="absolute";this.dcanvas.style.left="0px";this.dcanvas.style.top="0px";this.dcanvas.width=this.viewWidth;this.dcanvas.height=this.viewHeight;if(_190!==null){this.dcanvas.style.zIndex=_190;}this.container.appendChild(this.dcanvas);_18b.addElementAfter(_184,this.container);var ox=this.viewTranslateX;var oy=this.viewTranslateY;this.setViewStyle(this.bcanvas,1,ox,oy);this.setViewStyle(this.dcanvas,1,ox,oy);}else{if(this.supportDivOverflow==true){this.viewMode=0;this.viewRatio=1;this.viewTranslateX=0;this.viewTranslateY=0;this.altid=null;this.container=document.createElement("div");this.container.id="inktool_"+this.id+"_container";this.container.onselectstart=function(){return false;};this.container.ondragstart=function(){return false;};this.container.ontouchmove=function(e){if(_18d.drawingMode!=0){InkTool.InkCanvasLib.preventDefaultAction(e);}};this.container.style.userSelect="none";this.container.style.MozUserSelect="none";this.container.style.webkitUserSelect="none";this.container.style.msUserSelect="none";this.container.style.msTouchAction="none";this.container.style.touchAction="none";this.container.style.position="relative";this.container.style.display="inline-block";if(_190!==null){this.container.style.zIndex=_190;}this.bcanvas=document.createElement("canvas");this.bcanvas.id="inktool_"+this.id+"_back";this.bcanvas.onselectstart=function(){return false;};this.bcanvas.ondragstart=function(){return false;};this.bcanvas.ontouchmove=function(e){if(_18d.drawingMode!=0){InkTool.InkCanvasLib.preventDefaultAction(e);}};this.bcanvas.style.userSelect="none";this.bcanvas.style.MozUserSelect="none";this.bcanvas.style.webkitUserSelect="none";this.bcanvas.style.msUserSelect="none";this.bcanvas.style.msTouchAction="none";this.bcanvas.style.touchAction="none";this.bcanvas.style.position="absolute";this.bcanvas.style.left="0px";this.bcanvas.style.top="0px";this.bcanvas.width=_18f.width;this.bcanvas.height=_18f.height;if(_190!==null){this.bcanvas.style.zIndex=_190;}this.dcanvas=document.createElement("canvas");this.dcanvas.id="inktool_"+this.id+"_draw";this.dcanvas.onselectstart=function(){return false;};this.dcanvas.ondragstart=function(){return false;};this.dcanvas.ontouchmove=function(e){if(_18d.drawingMode!=0){InkTool.InkCanvasLib.preventDefaultAction(e);}};this.dcanvas.style.userSelect="none";this.dcanvas.style.MozUserSelect="none";this.dcanvas.style.webkitUserSelect="none";this.dcanvas.style.msUserSelect="none";this.dcanvas.style.msTouchAction="none";this.dcanvas.style.touchAction="none";this.dcanvas.style.position="absolute";this.dcanvas.style.left="0px";this.dcanvas.style.top="0px";this.dcanvas.width=_18f.width;this.dcanvas.height=_18f.height;if(_190!==null){this.dcanvas.style.zIndex=_190;}var _191=_184.parentNode;_18b.addElementAfter(_184,this.container);_191.removeChild(_184);this.container.appendChild(_184);this.container.appendChild(this.bcanvas);this.container.appendChild(this.dcanvas);epos=_18b.getElementAbsoluteLocation(_184);}else{this.viewMode=0;this.viewRatio=1;this.viewTranslateX=0;this.viewTranslateY=0;this.altid=null;this.container=null;this.dcanvas=document.createElement("canvas");this.dcanvas.id="inktool_"+this.id+"_draw";this.dcanvas.onselectstart=function(){return false;};this.dcanvas.ondragstart=function(){return false;};this.dcanvas.ontouchmove=function(e){if(_18d.drawingMode!=0){InkTool.InkCanvasLib.preventDefaultAction(e);}};this.dcanvas.style.userSelect="none";this.dcanvas.style.MozUserSelect="none";this.dcanvas.style.webkitUserSelect="none";this.dcanvas.style.msUserSelect="none";this.dcanvas.style.msTouchAction="none";this.dcanvas.style.touchAction="none";this.dcanvas.style.position="absolute";this.dcanvas.style.left=""+epos.left+"px";this.dcanvas.style.top=""+epos.top+"px";this.dcanvas.width=_18f.width;this.dcanvas.height=_18f.height;if(_190!==null){this.dcanvas.style.zIndex=_190;}_18b.addElementAfter(_184,this.dcanvas);this.bcanvas=document.createElement("canvas");this.bcanvas.id="inktool_"+this.id+"_back";this.bcanvas.onselectstart=function(){return false;};this.bcanvas.ondragstart=function(){return false;};this.bcanvas.ontouchmove=function(e){if(_18d.drawingMode!=0){InkTool.InkCanvasLib.preventDefaultAction(e);}};this.bcanvas.style.userSelect="none";this.bcanvas.style.MozUserSelect="none";this.bcanvas.style.webkitUserSelect="none";this.bcanvas.style.msUserSelect="none";this.bcanvas.style.msTouchAction="none";this.bcanvas.style.touchAction="none";this.bcanvas.style.position="absolute";this.bcanvas.style.left=""+epos.left+"px";this.bcanvas.style.top=""+epos.top+"px";this.bcanvas.width=_18f.width;this.bcanvas.height=_18f.height;if(_190!==null){this.bcanvas.style.zIndex=_190;}_18b.addElementAfter(_184,this.bcanvas);}}if(_18b.needsEmulateCanvas()){G_vmlCanvasManager.initElement(this.dcanvas);}if(_18b.needsEmulateCanvas()){G_vmlCanvasManager.initElement(this.bcanvas);}this.dcontext=this.dcanvas.getContext("2d");this.hcanvas=document.createElement("canvas");this.hcanvas.width=_18f.width;this.hcanvas.height=_18f.height;this.slayer=null;this.canvasMode=mode;this.rect=new InkTool.InkRect(epos.left,epos.top,_18f.width,_18f.height);this.srect=new InkTool.InkRect(_18e.left,_18e.top,_18f.width,_18f.height);this.traceList={};this.arrayCell=new Array();this.arrayCopy=new Array();this.llastX=0;this.llastY=0;this.llastT=0;this.lastX=0;this.lastY=0;this.lastT=0;this.moveCount=0;this.testTimeStr="";this.lastV1=0;this.lastV2=0;this.lastV3=0;this.lastV4=0;this.lastV5=0;this.lastMoveX=0;this.lastMoveY=0;this.isDrawing=false;var ofx=this.viewOffsetX+this.viewTranslateX/this.viewZoomRatio;var ofy=this.viewOffsetY+this.viewTranslateY/this.viewZoomRatio;this.drawingContext=new InkTool.DrawingContext(null,ofx,ofy,1);this.drawingContext.setFeatureDetectingParams(this.featureDetectingBendDist,this.featureDetectingStraightDist,this.featureDetectingTimeDist,this.featureDetectingSharpDist);if(this.baseWidth>0){this.inkWidth=this.baseWidth;}else{this.inkWidth=_18f.width;}if(this.baseHeight>0){this.inkHeight=this.baseHeight;}else{this.inkHeight=_18f.height;}this.backColor=new InkTool.InkColor("rgba(0, 0, 0, 0.0)");this.pen=null;this.specialPens=null;this.drawingStroke=false;this.currentStroke=null;this.pageIndex=_185;if(this.pageIndex==0){this.pageIndex=_18c.InkData.Note.countPages()+1;}this.penDownPreFunc=null;this.penDownFunc=null;this.penMoveFunc=null;this.penUpFunc=null;this.signpadUpFunc=null;this.penDownInnerPreFunc=null;this.penDownInnerFunc=null;this.penMoveInnerFunc=null;this.penUpInnerFunc=null;this.signpadUpInnerFunc=null;this.nonDrawPenUpInnerFunc=null;this.hotspotMoveInnerFunc=null;this.hotspotUpInnerFunc=null;this.lastPenupTime=null;this.preFuncIntervalTime=500;if(_189!=null||mode==1||mode==2){this.autoZoomRatio=false;this.setupTracePacket();}else{this.autoZoomRatio=true;this.calcAutoZoomRatio();}if(this.pageIndex>0){var _192=_18c.InkData.Note.countPages();if(_192<this.pageIndex){_18c.InkData.Note.addPages(this.pageIndex-_192);}this.currentPage=_18c.InkData.Note.getPage(this.pageIndex-1);this.currentLayer=this.currentPage.getCurrentLayer();this.currentDrawing=this.currentLayer.Drawing;}else{this.currentPage=null;this.currentLayer=null;this.currentDrawing=null;}this.clearDrawingCanvas();this.drawingBuffer=new InkTool.InkDrawing();this.currentDate=null;this.currentPosition=null;this.currentPositionCode=0;this.currentPositionMessage=null,this.drawingMode=1;this.fullDrawMode=true;this.useFullDraw=false;this.replayMode=0;this.replaySpeed=1;this.replayMaxInterval=1000;this.replayStrokeIndex=0;this.replayCellIndex=0;this.replayStartTime=0;this.replayTargetBaseTime=0;this.replayLastTime=0;this.replayPackets=[];this.replayHandler=null;this.replayTimer=null;this.replaySpecialHandler=null;this.setupCanPenMove();},setupTracePacket:function(){var _193=InkTool.InkLib;var _194=InkTool.InkCanvasLib;var _195=new InkTool.InkTracePacket(0);_195.pen=this.pen;var _196=this.drawingContext;_195.drawingContext=_196.clone();_195.currentStatus=0;_194.PenTrace.List[this.id]=_195;for(var idx=0;idx<_194.TouchTraceList.length;idx++){_195=new InkTool.InkTracePacket(0);_195.pen=this.pen;var _196=this.drawingContext;_195.drawingContext=_196.clone();_195.currentStatus=0;_194.TouchTraceList[idx].List[this.id]=_195;}for(var idx=0;idx<_194.PointerTraceList.length;idx++){_195=new InkTool.InkTracePacket(0);_195.pen=this.pen;var _196=this.drawingContext;_195.drawingContext=_196.clone();_195.currentStatus=0;_194.PointerTraceList[idx].List[this.id]=_195;}},setupCanPenMove:function(){if(this.drawingMode==0||this.pen==null||this.replayMode!=0||this.hotspotMode!=0){this.canPenMove=false;}else{this.canPenMove=true;}if(InkTool.InkLib.needsEmulateCanvas()||this.fullDrawMode==true){this.useFullDraw=true;}else{this.useFullDraw=false;}},getVersion:function(){return this.getCanvasInfo("version");},getCanvasType:function(){return this.CanvasType;},getCanvasInfo:function(key){if(key===undefined||key===null||key===""){return this.CanvasInfo;}else{if(this.CanvasInfo==null){return null;}else{return this.CanvasInfo[key];}}},getDeviceType:function(){return this.DeviceType;},setDevicePriority:function(mode){return false;},getDevicePriority:function(){return "none";},setDeviceFitControlSize:function(fit){return false;},getDeviceFitControlSize:function(){return false;},setDeviceFitControlSizeParams:function(_197,_198,_199,_19a,_19b,_19c,_19d,_19e){return false;},setDeviceFitControlSizeControlMargin:function(_19f,_1a0,_1a1,_1a2){return false;},getDeviceFitControlSizeControlMargin:function(){return {Left:0,Top:0,Right:0,Bottom:0};},setDeviceFitControlSizeKeepAspectRatio:function(_1a3){return false;},getDeviceFitControlSizeKeepAspectRatio:function(){return 0;},setDeviceFitControlSizeEmbedTabletInControl:function(_1a4){return false;},getDeviceFitControlSizeEmbedTabletInControl:function(){return 0;},setDeviceFitControlSizeAlignment:function(_1a5,_1a6){return false;},getDeviceFitControlSizeAlignment:function(){return {Horizontal:0,Vertical:0};},setDeviceIgnoreTabletQuery:function(_1a7){return false;},getDeviceIgnoreTabletQuery:function(){return false;},getDeviceDefSupportStatus:function(){return false;},getDeviceDefSupportPressure:function(){return false;},setSignPadPossible:function(flag){return false;},getSignPadPossible:function(){return false;},isSignPadAvailable:function(){return false;},isSignPadConnecting:function(){return false;},getSignPadInfo:function(){return {"type":0,"name":"","id":"","width":0,"height":0};},setSignPadFitControlSize:function(fit){return false;},getSignPadFitControlSize:function(){return false;},setSignPadFitControlSizeParams:function(_1a8,_1a9,_1aa,_1ab,_1ac,_1ad,_1ae,_1af){return false;},setSignPadFitControlSizeControlMargin:function(_1b0,_1b1,_1b2,_1b3){return false;},getSignPadFitControlSizeControlMargin:function(){return {Left:0,Top:0,Right:0,Bottom:0};},setSignPadFitControlSizeKeepAspectRatio:function(_1b4){return false;},getSignPadFitControlSizeKeepAspectRatio:function(){return 0;},setSignPadFitControlSizeEmbedSignPadInControl:function(_1b5){return false;},getSignPadFitControlSizeEmbedSignPadInControl:function(){return 0;},setSignPadFitControlSizeAlignment:function(_1b6,_1b7){return false;},getSignPadFitControlSizeAlignment:function(){return {Horizontal:0,Vertical:0};},setUseEmulatingTimer:function(flag){this.useEmulatingTimer=flag;},getUseEmulatingTimer:function(){return this.useEmulatingTimer;},setUseFullDrawMode:function(flag){this.fullDrawMode=flag;this.setupCanPenMove();},getUseFullDrawMode:function(){return this.fullDrawMode;},setFeatureDetectingParams:function(bend,_1b8,time,_1b9){if(bend!=null){this.featureDetectingBendDist=bend;}if(_1b8!=null){this.featureDetectingStraightDist=_1b8;}if(time!=null){this.featureDetectingTimeDist=time;}if(_1b9!=null){this.featureDetectingSharpDist=_1b9;}this.drawingContext.setFeatureDetectingParams(this.featureDetectingBendDist,this.featureDetectingStraightDist,this.featureDetectingTimeDist,this.featureDetectingSharpDist);this.setupTracePacket();},setFeatureDetectingBend:function(bend){this.setFeatureDetectingParams(bend,null,null,null);},getFeatureDetectingBend:function(){return this.featureDetectingBendDist;},setFeatureDetectingStraight:function(_1ba){this.setFeatureDetectingParams(null,_1ba,null,null);},getFeatureDetectingStraight:function(){return this.featureDetectingStraightDist;},setFeatureDetectingTime:function(time){this.setFeatureDetectingParams(null,null,time,null);},getFeatureDetectingTime:function(){return this.featureDetectingTimeDist;},setFeatureDetectingSharp:function(_1bb){this.setFeatureDetectingParams(null,null,null,_1bb);},getFeatureDetectingSharp:function(){return this.featureDetectingSharpDist;},getId:function(){return this.id;},getNumStrokes:function(){return this.countDrawItems();},getMaxStrokes:function(){return this.drawingBuffer.countDrawItems();},getNumCells:function(){return this.countDrawItemCells();},getNumFeatureCells:function(mode){return this.countDrawItemFeatureCells(mode);},setDrawingMode:function(mode){var _1bc=this.drawingMode;this.drawingMode=mode;if(mode==0&&this.isDrawing){this.isDrawing=false;this.doPenUp({"left":this.lastMoveX,"top":this.lastMoveY});}this.setupCanPenMove();if(_1bc==0&&mode!=0){this.relayout();}},getDrawingMode:function(){return this.drawingMode;},setHandler:function(_1bd,_1be){if(_1bd=="prependown"){this.penDownPreFunc=_1be;}else{if(_1bd=="pendown"){this.penDownFunc=_1be;}else{if(_1bd=="penmove"){this.penMoveFunc=_1be;}else{if(_1bd=="penup"){this.penUpFunc=_1be;}else{if(_1bd=="signpadup"){this.signpadUpFunc=_1be;}}}}}},setAutoZoomRatio:function(){this.autoZoomRatio=true;this.calcAutoZoomRatio();this.redrawCurrentLayerByInk();},calcAutoZoomRatio:function(){var _1bf=this.rect.getWidth()/this.inkWidth;var _1c0=this.rect.getHeight()/this.inkHeight;if(_1bf<=_1c0){this.drawingContext.setZoomRatio(_1bf);}else{this.drawingContext.setZoomRatio(_1c0);}this.drawingContext.setOffset(0,0);this.setupTracePacket();},setZoomRatio:function(_1c1){this.autoZoomRatio=false;this.drawingContext.setZoomRatio(_1c1);this.drawingContext.calcClipRect(this.bcanvas.width,this.bcanvas.height);if(this.baseWidth>0||this.baseHeight>0){this.baseWidth=0;this.baseHeight=0;}this.inkWidth=Math.round(this.rect.getWidth()/this.drawingContext.getZoomRatio());this.inkHeight=Math.round(this.rect.getHeight()/this.drawingContext.getZoomRatio());this.setupTracePacket();this.redrawCurrentLayerByInk();},setOffset:function(_1c2,_1c3){this.autoZoomRatio=false;this.drawingContext.setOffset(_1c2,_1c3);this.drawingContext.calcClipRect(this.bcanvas.width,this.bcanvas.height);this.setupTracePacket();this.redrawCurrentLayerByInk();},setZoomAndOffset:function(_1c4,_1c5,_1c6){this.autoZoomRatio=false;this.drawingContext.setZoomRatio(_1c4);this.drawingContext.setOffset(_1c5,_1c6);this.drawingContext.calcClipRect(this.bcanvas.width,this.bcanvas.height);if(this.baseWidth>0||this.baseHeight>0){this.baseWidth=0;this.baseHeight=0;}this.inkWidth=Math.round(this.rect.getWidth()/this.drawingContext.getZoomRatio());this.inkHeight=Math.round(this.rect.getHeight()/this.drawingContext.getZoomRatio());this.setupTracePacket();this.redrawCurrentLayerByInk();},setCurrentZoomAndOffset:function(){this.autoZoomRatio=false;this.drawingContext.calcClipRect(this.bcanvas.width,this.bcanvas.height);if(this.baseWidth>0||this.baseHeight>0){this.baseWidth=0;this.baseHeight=0;}this.inkWidth=Math.round(this.rect.getWidth()/this.drawingContext.getZoomRatio());this.inkHeight=Math.round(this.rect.getHeight()/this.drawingContext.getZoomRatio());this.setupTracePacket();this.redrawCurrentLayerByInk();},setPen:function(pen){if(pen.isAutomaticSwitchover()==true){this.pen=pen.html5Pen;}else{this.pen=pen;}this.setupCanPenMove();return true;},setSpecialPens:function(pens){this.specialPens=pens;},clearSpecialPens:function(){this.specialPens=null;},setPrePenDownFuncIntervalTime:function(time){this.preFuncIntervalTime=time;},setBackgroundColor:function(_1c7){},setBackgroundImageURL:function(url){},clearBackgroundImage:function(){},setSignPadImageURL:function(url){},clearSignPadImage:function(){},setActiveXMode:function(flag){},setView:function(_1c8,_1c9,_1ca,_1cb){if(this.viewMode==0){return;}this.viewMode=2;this.viewZoomRatio=_1c8;this.viewOffsetX=_1c9;this.viewOffsetY=_1ca;if(this.viewTimer!=null){clearTimeout(this.viewTimer);this.viewTimer=null;}if(_1cb==null||_1cb<=0){this.viewMode=1;this.doFixView();}else{var _1cc=this.drawingContext.getZoomRatio();var _1cd=this.drawingContext.getOffsetX();var _1ce=this.drawingContext.getOffsetY();var _1cf=this.viewZoomRatio/_1cc;var ox=-((this.viewOffsetX-_1cd)*this.viewZoomRatio);var oy=-((this.viewOffsetY-_1ce)*this.viewZoomRatio);this.setViewStyle(this.bcanvas,_1cf,ox,oy);this.setViewStyle(this.dcanvas,_1cf,ox,oy);var cvs=this;this.viewTimer=setTimeout(function(){cvs.viewMode=1;cvs.doFixView();},_1cb);}},fixView:function(){if(this.viewMode!=2){return;}this.viewMode=1;if(this.viewTimer!=null){clearTimeout(this.viewTimer);this.viewTimer=null;}this.doFixView();},doFixView:function(){var _1d0=this.drawingContext.getZoomRatio();var _1d1=this.drawingContext.getOffsetX();var _1d2=this.drawingContext.getOffsetY();var pox,poy;if(_1d0!=this.viewZoomRatio){pox=-this.viewOffsetX*this.viewZoomRatio;poy=-this.viewOffsetY*this.viewZoomRatio;}else{pox=-((this.viewOffsetX-_1d1)*this.viewZoomRatio);poy=-((this.viewOffsetY-_1d2)*this.viewZoomRatio);}var _1d3=false;if(pox>-this.rect.getWidth()/2){pox=-this.rect.getWidth();_1d3=true;}else{if(pox<-(this.viewWidth-this.rect.getWidth()*3/2)){pox=-(this.viewWidth-this.rect.getWidth()*2);_1d3=true;}}if(poy>-this.rect.getHeight()/2){poy=-this.rect.getHeight();_1d3=true;}else{if(poy<-(this.viewHeight-this.rect.getHeight()*3/2)){poy=-(this.viewHeight-this.rect.getHeight()*2);_1d3=true;}}this.viewTranslateX=pox;this.viewTranslateY=poy;this.setViewStyle(this.bcanvas,1,pox,poy);this.setViewStyle(this.dcanvas,1,pox,poy);if(_1d3||_1d0!=this.viewZoomRatio){var ofx=this.viewOffsetX+this.viewTranslateX/this.viewZoomRatio;var ofy=this.viewOffsetY+this.viewTranslateY/this.viewZoomRatio;this.setZoomAndOffset(this.viewZoomRatio,ofx,ofy);}},setViewStyle:function(elem,_1d4,ox,oy){var _1d5="translate("+ox+"px,"+oy+"px) "+"scale("+_1d4+","+_1d4+")";elem.style.setProperty("transform-origin","0 0");elem.style.setProperty("-moz-transform-origin","0 0");elem.style.setProperty("-webkit-transform-origin","0 0");elem.style.setProperty("-o-transform-origin","0 0");elem.style.setProperty("-ms-transform-origin","0 0");elem.style.setProperty("transform",_1d5);elem.style.setProperty("-moz-transform",_1d5);elem.style.setProperty("-webkit-transform",_1d5);elem.style.setProperty("-o-transform",_1d5);elem.style.setProperty("-ms-transform",_1d5);},relayout:function(){return this.relayoutSub(true);},relayoutSub:function(_1d6){var _1d7=InkTool.InkLib;var _1d8=InkTool.InkCanvasLib;if(this.supportDivOverflow==true){return false;}var _1d9;if(this.altid!=null){_1d9=_1d7.getElementById(this.altid);}else{_1d9=_1d7.getElementById(this.id);}if(_1d9==null){return false;}var epos=_1d7.getElementAbsoluteLocation(_1d9);var _1da=_1d7.getElementLocation(_1d9);var _1db=_1d7.getElementSize(_1d9);if(_1db.width<8){_1db.width=8;}if(_1db.height<8){_1db.height=8;}var _1dc=this.zorder;if(_1dc==0){_1dc=_1d7.getStyleOfElement(_1d9,"z-index",null);}if(_1d6==false){if(epos.left==this.rect.left&&epos.top==this.rect.top&&_1da.left==this.srect.left&&_1da.top==this.srect.top&&_1db.width==this.rect.width&&_1db.height==this.rect.height){return false;}}if(this.container!=null){this.container.style.left=""+epos.left+"px";this.container.style.top=""+epos.top+"px";var _1dd=false;if(this.container.width!=_1db.width||this.container.height!=_1db.height){this.viewWidth=_1db.width*this.viewRatio;this.viewHeight=_1db.height*this.viewRatio;this.viewTranslateX=-((this.viewWidth-_1db.width)/2);this.viewTranslateY=-((this.viewHeight-_1db.height)/2);this.container.style.width=""+_1db.width+"px";this.container.style.height=""+_1db.height+"px";this.bcanvas.width=this.viewWidth;this.bcanvas.height=this.viewHeight;this.dcanvas.width=this.viewWidth;this.dcanvas.height=this.viewHeight;var ox=this.viewTranslateX;var oy=this.viewTranslateY;this.setViewStyle(this.bcanvas,1,ox,oy);this.setViewStyle(this.dcanvas,1,ox,oy);_1dd=true;}this.container.style.zIndex=_1dc;}else{this.bcanvas.style.left=""+epos.left+"px";this.bcanvas.style.top=""+epos.top+"px";var _1dd=false;if(this.bcanvas.width!=_1db.width||this.bcanvas.height!=_1db.height){this.bcanvas.width=_1db.width;this.bcanvas.height=_1db.height;_1dd=true;}this.bcanvas.style.zIndex=_1dc;this.dcanvas.style.left=""+epos.left+"px";this.dcanvas.style.top=""+epos.top+"px";this.dcanvas.width=_1db.width;this.dcanvas.height=_1db.height;this.dcanvas.style.zIndex=_1dc;}this.hcanvas.width=_1db.width;this.hcanvas.height=_1db.height;if(this.slayer!=null){this.slayer.style.left=""+epos.left+"px";this.slayer.style.top=""+epos.top+"px";this.slayer.width=_1db.width;this.slayer.height=_1db.height;this.slayer.style.zIndex=_1dc;}this.rect=new InkTool.InkRect(epos.left,epos.top,_1db.width,_1db.height);this.srect=new InkTool.InkRect(_1da.left,_1da.top,_1db.width,_1db.height);if(this.baseWidth>0){this.inkWidth=this.baseWidth;}else{this.inkWidth=Math.round(_1db.width/this.drawingContext.getZoomRatio());}if(this.baseHeight>0){this.inkHeight=this.baseHeight;}else{this.inkHeight=Math.round(_1db.height/this.drawingContext.getZoomRatio());}if(_1dd){if(this.autoZoomRatio){this.calcAutoZoomRatio();}else{this.setCurrentZoomAndOffset();}if(this.container!=null){var ofx=this.viewOffsetX+this.viewTranslateX/this.viewZoomRatio;var ofy=this.viewOffsetY+this.viewTranslateY/this.viewZoomRatio;this.setOffset(ofx,ofy);}else{this.redrawCurrentLayerByInk();}}return true;},relocation:function(){var _1de=InkTool.InkLib;var _1df=InkTool.InkCanvasLib;var _1e0;if(this.altid!=null){_1e0=_1de.getElementById(this.altid);}else{_1e0=_1de.getElementById(this.id);}if(_1e0!=null){var epos=_1de.getElementAbsoluteLocation(_1e0);var _1e1=_1de.getElementLocation(_1e0);this.rect.left=epos.left;this.rect.top=epos.top;this.srect.left=_1e1.left;this.srect.top=_1e1.top;}},display:function(flag){var _1e2=InkTool.InkLib;var _1e3=InkTool.InkCanvasLib;if(flag){_1e2.showElement(this.bcanvas);_1e2.showElement(this.dcanvas);if(this.slayer!=null){_1e2.showElement(this.slayer);}}else{_1e2.hideElement(this.bcanvas);_1e2.hideElement(this.dcanvas);if(this.slayer!=null){_1e2.hideElement(this.slayer);}}},clearInk:function(){this.clearInkOfCurrentLayer();},undoInk:function(){this.undoInkOfCurrentLayer();},redoInk:function(){this.redoInkOfCurrentLayer();},saveInkObject:function(){return {};},saveInkObjectLegacy:function(){return {};},saveInkObjectWithFeature:function(){return {};},saveInk:function(){return "";},saveInkLegacy:function(){return "";},saveInkWithFeature:function(){return "";},saveInkObjectLong:function(){return {};},saveInkLong:function(){return "";},saveInkObjectShort:function(mode){return {};},saveInkShort:function(){return "";},savePublicInk:function(){return "";},saveDebugCsv:function(){return "";},checkInkObject:function(_1e4){return this.checkInkShortObject(_1e4,false);},checkInk:function(_1e5){try{var _1e6=JSON.parse(_1e5);return this.checkInkShortObject(_1e6,false);}catch(e){return -2;}},checkInkShortObject:function(_1e7,_1e8){var _1e9=new InkTool.InkDrawing();if(_1e7.is==null||_1e7.is.length==null){return -2;}var _1ea=true;for(var _1eb=0;_1eb<_1e7.is.length;_1eb++){var _1ec=_1e7.is[_1eb];if(_1ec.st==null||_1ec.st.tp==null||_1ec.st.col==null||_1ec.st.w==null||_1ec.st.minw==null||_1ec.st.maxw==null){return -2;}var _1ed=_1ec.st.tp;if(_1e8==false){var _1ee=this.createStationeryByType(_1ed);if(_1ee.getPenType()==InkTool.InkPenType.None){_1ea=false;}}else{if(!(_1ed==101||_1ed==102||_1ed==103||_1ed==104||_1ed==105||_1ed==150||_1ed==107||_1ed==201||_1ed==202)){_1ea=false;}}if(_1ec.t==null){return -2;}if(_1ec.cs==null||_1ec.cs.length==null){return -2;}var _1ef=_1ec.t;var _1f0=_1ec.st.w;for(var _1f1=0;_1f1<_1ec.cs.length;_1f1++){var _1f2=_1ec.cs[_1f1];var mode=(_1f1==0)?0:1;var _1f3=_1f2.split(":");if(_1f3.length>=2){mode=Number(_1f3[1]);_1f2=_1f3[0];}var _1f4=_1f2.split("|");var _1f5=_1f4.length;var xp,yp,wd,pr,tm;if(_1f5<3){return -2;}xp=Number(_1f4[0]);yp=Number(_1f4[1]);if(_1f5==3){wd=_1f0;pr=0;tm=_1ef+Number(_1f4[2]);}else{if(_1f5==4){wd=Number(_1f4[2]);pr=0;tm=_1ef+Number(_1f4[3]);}else{if(_1f5>=5){wd=Number(_1f4[2]);pr=Number(_1f4[3]);tm=_1ef+Number(_1f4[4]);}}}if(Number.isNaN(xp)||Number.isNaN(yp)||Number.isNaN(wd)||Number.isNaN(pr)||Number.isNaN(tm)||Number.isNaN(mode)){return -2;}}}if(_1e7.w==null||_1e7.h==null){return -2;}if(_1ea==false){return -1;}else{return 0;}},loadInkObject:function(_1f6){this.loadInkShortObject(_1f6);},loadInk:function(_1f7){this.loadInkShort(_1f7);},loadInkLong:function(_1f8){var _1f9=JSON.parse(_1f8);this.loadInkLongObject(_1f9);},loadInkLongObject:function(_1fa){var _1fb=new InkTool.InkDrawing();for(var _1fc=0;_1fc<_1fa.is.length;_1fc++){var _1fd=_1fa.is[_1fc];var _1fe=_1fd.st.tp;var _1ff=this.createStationeryByType(_1fe);_1ff.setPenColor(new InkTool.InkColor(_1fd.st.col));_1ff.setPenWidth(_1fd.st.w);_1ff.setPenMinWidth(_1fd.st.minw);_1ff.setPenMaxWidth(_1fd.st.maxw);var _200=new InkTool.InkStroke(_1ff);for(var _201=0;_201<_1fd.cs.length;_201++){var cell=_1fd.cs[_201];var _202=new InkTool.InkCell(cell.m,cell.x,cell.y,cell.w,cell.p,cell.t);_200.addCell(_202);}_1fb.addDrawItem(_200);}this.inkWidth=_1fa.w;this.inkHeight=_1fa.h;this.loadInkObjectSub(_1fb);},loadInkShort:function(_203){var _204=JSON.parse(_203);this.loadInkShortObject(_204);},loadInkShortObject:function(_205){var _206=new InkTool.InkDrawing();for(var _207=0;_207<_205.is.length;_207++){var _208=_205.is[_207];var _209=_208.st.tp;var _20a=this.createStationeryByType(_209);_20a.setPenColor(new InkTool.InkColor(_208.st.col));_20a.setPenWidth(_208.st.w);_20a.setPenMinWidth(_208.st.minw);_20a.setPenMaxWidth(_208.st.maxw);var _20b=new InkTool.InkStroke(_20a);var _20c=_208.t;var _20d=_208.st.w;var _20e=false;var _20f=0;for(var _210=0;_210<_208.cs.length;_210++){var _211=_208.cs[_210];var mode=(_210==0)?0:1;var _212=_211.split(":");if(_212.length>=2){mode=Number(_212[1]);_211=_212[0];_20e=true;}var _213=_211.split("|");var _214=_213.length;var xp,yp,wd,pr,tm;xp=Number(_213[0]);yp=Number(_213[1]);if(_214==3){wd=_20d;pr=0;tm=_20c+Number(_213[2]);}else{if(_214==4){wd=Number(_213[2]);pr=0;tm=_20c+Number(_213[3]);}else{if(_214>=5){wd=Number(_213[2]);pr=Number(_213[3]);tm=_20c+Number(_213[4]);if(_212.length<2&&pr==0&&_210==_208.cs.length-1){mode=2;}}}}if(_210==_208.cs.length-1&&mode!=2){var ctm;if(_210==0){ctm=tm;}else{ctm=Math.round((_20f+tm)/2);}var _215=new InkTool.InkCell(mode,xp,yp,wd,pr,ctm);_20b.addCell(_215);var _216=new InkTool.InkCell(2,xp,yp,wd,pr,tm);_20b.addCell(_216);}else{var _215=new InkTool.InkCell(mode,xp,yp,wd,pr,tm);_20b.addCell(_215);}_20f=tm;}if(_20e==false&&_205.fdp){var _217=this.drawingContext.clone();_217.setFeatureDetectingParams(_205.fdp.bd,_205.fdp.st,_205.fdp.tm,_205.fdp.sp);for(var _210=0;_210<_20b.countCells();_210++){var _215=_20b.getCell(_210);_20a.strokeDispatch(_217,_215,2);}}_206.addDrawItem(_20b);}this.inkWidth=_205.w;this.inkHeight=_205.h;if(_205.tm){this.currentDate=new Date(_205.tm);}else{this.currentDate=null;}if(_205.glc){var _218=InkTool.InkGeolocationLib;if(_218!=null){this.currentPosition=_218.positionInkToInner(_205.glc);this.currentPositionCode=_218.positionCodeByInk(_205.glc);this.currentPositionMessage=_218.positionMessageByInk(_205.glc);}else{this.currentPosition=null;this.currentPositionCode=0;this.currentPositionMessage=null;}}else{this.currentPosition=null;this.currentPositionCode=0;this.currentPositionMessage=null;}this.loadInkObjectSub(_206);},createStationeryByType:function(_219){var _21a;switch(_219){case InkTool.InkPenType.PressSenseBallpointPen:case "pn01":_21a=new InkTool.PressSenseBallpointPen();break;case InkTool.InkPenType.PressSenseFeltPen:case "pn02":_21a=new InkTool.PressSenseFeltPen();break;case InkTool.InkPenType.PressSenseSignPen:case "pn06":_21a=new InkTool.PressSenseSignPen();break;case InkTool.InkPenType.PressSenseSchoolPen:case "pn07":_21a=new InkTool.PressSenseSchoolPen();break;case InkTool.InkPenType.Old_BallpointPen:case InkTool.InkPenType.SolidPen:case "hp00":_21a=new InkTool.SolidPen();break;case InkTool.InkPenType.Old_VariableBallpointPen:case InkTool.InkPenType.SpeedSenseBallpointPen:case "hp01":_21a=new InkTool.InkVariableBallpointPen();break;case InkTool.InkPenType.Old_FeltPen:case InkTool.InkPenType.Old_BrushPen:case InkTool.InkPenType.SpeedSenseFeltPen:case "hp02":_21a=new InkTool.InkFeltPen();break;case InkTool.InkPenType.Old_VariableFudePen:case InkTool.InkPenType.SpeedSenseFudePen:case "hp04":_21a=new InkTool.InkVariableFudePen();break;case InkTool.InkPenType.Old_VariableSignPen:case InkTool.InkPenType.SpeedSenseSignPen:case "hp06":_21a=new InkTool.InkVariableSignPen();break;case InkTool.InkPenType.SpeedSenseSchoolPen:case "hp07":_21a=new InkTool.SpeedSenseSchoolPen();break;case InkTool.InkPenType.Old_Pencil:case InkTool.InkPenType.Old_PencilEmulated:case InkTool.InkPenType.Pencil:case InkTool.InkPenType.PencilEmulated:case "cpn1":case "cpn2":_21a=new InkTool.InkPencil();break;case InkTool.InkPenType.Old_NormalEraser:case InkTool.InkPenType.SolidEraser:case "er03":_21a=new InkTool.InkNormalEraser();break;case InkTool.InkPenType.PressSenseNormalEraser:case "er02":_21a=new InkTool.PressSenseNormalEraser();break;case InkTool.InkPenType.Old_FeltPenV100:case InkTool.InkPenType.FeltPenV100:_21a=new InkTool.InkFeltPenV100();break;default:_21a=new InkTool.InkStationery();break;}return _21a;},loadInkObjectSub:function(_21b){if(this.autoZoomRatio){this.calcAutoZoomRatio();}else{this.setCurrentZoomAndOffset();}var _21c=this.currentLayer;if(_21c!=null){_21c.Drawing=_21b.clone();this.currentDrawing=_21c.Drawing;this.drawingBuffer=this.currentDrawing.clone();}this.redrawCurrentLayerByInk();},loadRecogInkObject:function(_21d){var _21e=new InkTool.InkDrawing();for(var _21f=0;_21f<_21d.strokes.length;_21f++){var _220=_21d.strokes[_21f];var _221=this.pen;var _222=new InkTool.InkStroke(_221);var _223=_220.time;for(var _224=0;_224<_220.cells.length;_224++){var _225=_220.cells[_224];var mode=(_224==0)?0:1;var _226=_221.getPenWidth();var xp,yp,wd,pr,tm;xp=_225.x;yp=_225.y;wd=_226;pr=0;tm=_223+_225.t;var _227=new InkTool.InkCell(mode,xp,yp,wd,pr,tm);_222.addCell(_227);if(_224==_220.cells.length-1&&mode!=2){var _228=new InkTool.InkCell(2,xp,yp,wd,pr,tm);_222.addCell(_228);}}_21e.addDrawItem(_222);}if(_21d.size!=null){this.inkWidth=_21d.size;this.inkHeight=_21d.size;}else{this.inkWidth=_21d.width;this.inkHeight=_21d.height;}this.loadInkObjectSub(_21e);},setCurrentPosition:function(){var _229=InkTool.InkGeolocationLib;if(_229==null){this.currentPositionCode=-1;this.currentPositionMessage=null;return -1;}if(_229.isSupportedGeolocation()==false){this.currentPositionCode=-1;this.currentPositionMessage=null;return -1;}if(_229.isSucceeded()){this.currentPosition=_229.getPosition();this.currentPositionCode=0;this.currentPositionMessage=null;return 0;}if(_229.isStarted()==false){this.currentPositionCode=-2;this.currentPositionMessage=null;return -2;}this.currentPositionCode=-3;this.currentPositionMessage=null;return -3;},setPosition:function(_22a){var _22b=InkTool.InkGeolocationLib;if(_22b==null){this.currentPositionCode=-1;this.currentPositionMessage=null;return -1;}this.currentPosition=_22b.positionApiToInner(_22a);this.currentPositionCode=100;this.currentPositionMessage=null;return 0;},getPosition:function(){return this.currentPosition;},clearPosition:function(){this.currentPosition=null;this.currentPositionCode=0;this.currentPositionMessage=null;},setCurrentDate:function(){this.currentDate=new Date();},setDate:function(date){this.currentDate=date;},getDate:function(){return this.currentDate;},clearDate:function(){this.currentDate=null;},isCanvasTag:function(elem){var _22c=elem;var tid=(elem?elem.id:"");if(InkTool.InkLib.needsEmulateCanvas()){if(this.id===tid){return true;}var _22d=null;while(elem!==null){if(elem.tagName===undefined){return false;}var _22e=elem.tagName.toLowerCase();if(_22e=="body"){return false;}else{if(_22e=="canvas"){_22d=elem;break;}else{if(this.id===elem.id){return true;}else{if(this.slayer!=null&&this.slayer.id===elem.id){return true;}}}}elem=elem.parentNode;}if(!_22d){return false;}if(this.dcanvas.id===_22d.id||this.bcanvas.id===_22d.id){return true;}else{return false;}}else{return (this.id===tid||this.dcanvas.id===tid||this.bcanvas.id===tid);}},isCanvasId:function(tid){if(InkTool.InkLib.needsEmulateCanvas()){return true;}else{return (this.dcanvas.id===tid||this.bcanvas.id===tid||this.id===tid);}},convertPositionDocumentToCanvas:function(dpos,_22f,_230){return {left:((dpos.left-_22f.srect.left-_22f.viewTranslateX)/_230.zoomRatio)+_230.offsetX,top:((dpos.top-_22f.srect.top-_22f.viewTranslateY)/_230.zoomRatio)+_230.offsetY};},convertPositionElementToCanvas:function(_231,pos){return {"left":(pos.left/_231.getZoomRatio())+_231.getOffsetX(),"top":(pos.top/_231.getZoomRatio())+_231.getOffsetY()};},convertPositionCanvasToElement:function(_232,pos){return {"left":(pos.left-_232.getOffsetX())*_232.getZoomRatio(),"top":(pos.top-_232.getOffsetY())*_232.getZoomRatio()};},doPenDown:function(_233,last){if(this.replayMode!=0){return false;}var _234=InkTool.InkLib;var _235=InkTool.InkCanvasLib;var dpos=(last)?_233.llastPos:_233.lastPos;var epos=this.convertPositionDocumentToCanvas(dpos,this,this.drawingContext);if(this.penDownInnerPreFunc!=null||this.penDownPreFunc!=null){var _236=(this.lastPenUpTime!=null)?this.lastPenUpTime:0;var _237=Date.now();if(_237-_236>this.preFuncIntervalTime){if(this.penDownInnerPreFunc!=null){if(this.penDownInnerPreFunc(this,epos)==false){this.hotspotMode=1;this.setupCanPenMove();return false;}}if(this.penDownPreFunc!=null){try{if(this.penDownPreFunc(this,epos)==false){this.hotspotMode=1;this.setupCanPenMove();return false;}}catch(e){alert("prependown handler error:"+e);return false;}}}}this.hotspotMode=0;this.setupCanPenMove();if(this.drawingMode==0||this.pen==null||_235.DocLastPenDownIgnored!=0){return false;}var _238=_233.List[this.id];_238.pen=this.pen;if(this.specialPens!=null){for(var idx=0;idx<this.specialPens.length;idx++){var _239=this.specialPens[idx];var _23a=_239.area;var _23b=_239.pen;if(_23a.containsPoint(epos.left,epos.top)){_238.pen=_23b;break;}}}_238.currentStatus=0;_238.isDrawing=true;_238.startTime=_233.getLastTime();this.DeviceType=_233.etype;var tm=_238.startTime;_238.currentStroke=new InkTool.InkStroke(_238.pen);if(this.currentDrawing!=null){this.currentDrawing.addDrawItem(_238.currentStroke);}var cell=new InkTool.InkCell(0,epos.left,epos.top,_238.pen.getPenWidth(),0,tm);if(cell!=null){_238.currentStroke.addCell(cell);if(_238.pen.hasFullDrawMode()===true&&this.useFullDraw){if(this.useEmulatingTimer==true){_238.arrayCell.push(cell);}else{_238.drawingContext.context=this.dcanvas.getContext("2d");_238.pen.drawStart(_238.drawingContext);_238.pen.strokeDispatch(_238.drawingContext,cell,1);_238.arrayCopy.push(cell);}}else{_238.drawingContext.context=this.bcanvas.getContext("2d");_238.pen.drawStart(_238.drawingContext);_238.pen.strokeDispatch(_238.drawingContext,cell,1);}}if(this.penDownInnerFunc!=null){this.penDownInnerFunc(this,epos);}if(this.penDownFunc!=null){try{this.penDownFunc(this,epos);}catch(e){alert("pendown handler error:"+e);}}_238.lastMovePos=epos;return true;},performPenDown:function(xp,yp){var epos={left:xp,top:yp};if(this.penDownInnerFunc!=null){this.penDownInnerFunc(this,epos);}if(this.penDownFunc!=null){try{this.penDownFunc(this,epos);}catch(e){alert("pendown handler error:"+e);}}},doPenMove:function(_23c){if(this.canPenMove==false){if(this.hotspotMode!=0&&this.hotspotMoveInnerFunc!=null){var epos=this.convertPositionDocumentToCanvas(_23c.lastPos,this,this.drawingContext);this.hotspotMoveInnerFunc(this,epos);}return false;}var _23d=InkTool.InkLib;var epos=this.convertPositionDocumentToCanvas(_23c.lastPos,this,this.drawingContext);var _23e=_23c.List[this.id];var tm=_23c.getLastTime();_23e.currentStatus=1;var cell=new InkTool.InkCell(1,epos.left,epos.top,_23e.pen.getPenWidth(),0,tm);if(cell!=null){_23e.currentStroke.addCell(cell);if(_23e.pen.hasFullDrawMode()===true&&this.useFullDraw){if(this.useEmulatingTimer==true){_23e.arrayCell.push(cell);}else{_23e.pen.strokeDispatch(_23e.drawingContext,cell,1);_23e.arrayCopy.push(cell);}}else{_23e.pen.strokeDispatch(_23e.drawingContext,cell,1);}}if(this.penMoveInnerFunc!=null){this.penMoveInnerFunc(this,epos);}if(this.penMoveFunc!=null){try{this.penMoveFunc(this,epos);}catch(e){alert("penmove handler error:"+e);}}_23e.lastMovePos=epos;return true;},performPenMove:function(xp,yp){var epos={left:xp,top:yp};if(this.penMoveInnerFunc!=null){this.penMoveInnerFunc(this,epos);}if(this.penMoveFunc!=null){try{this.penMoveFunc(this,epos);}catch(e){alert("penmove handler error:"+e);}}},doPenUp:function(_23f,mode){if(this.drawingMode==0||this.hotspotMode!=0||this.pen==null||this.replayMode!=0){if(this.hotspotMode!=0){if(this.hotspotUpInnerFunc!=null){var epos=this.convertPositionDocumentToCanvas(_23f.lastPos,this,this.drawingContext);this.hotspotUpInnerFunc(this,epos);}this.hotspotMode=0;this.setupCanPenMove();}return false;}var _240=InkTool.InkLib;var _241=_23f.List[this.id];var epos;if(mode==0){epos=this.convertPositionDocumentToCanvas(_23f.lastPos,this,this.drawingContext);_241.lastMovePos=epos;}else{epos=_241.lastMovePos;}_241.currentStatus=2;if(_241.isDrawing){_241.isDrawing=false;_241.endTime=this.lastPenUpTime=_23f.getLastTime();var tm=_241.endTime;var cell=new InkTool.InkCell(2,epos.left,epos.top,_241.pen.getPenWidth(),0,tm);if(cell!=null){_241.currentStroke.addCell(cell);if(_241.pen.hasFullDrawMode()===true&&this.useFullDraw){if(this.useEmulatingTimer==true){_241.arrayCell.push(cell);}else{_241.pen.strokeDispatch(_241.drawingContext,cell,1);_241.pen.drawEnd(_241.drawingContext);_241.arrayCopy.push(cell);}}else{_241.pen.strokeDispatch(_241.drawingContext,cell,1);_241.pen.drawEnd(_241.drawingContext);}}if(_241.currentStroke!=null){this.drawingBuffer=this.currentLayer.Drawing.clone();}if(this.penUpInnerFunc!=null){this.penUpInnerFunc(this,epos);}if(this.penUpFunc!=null){try{this.penUpFunc(this,epos);}catch(e){alert("penup handler error:"+e);}}}return true;},performPenUp:function(xp,yp){var epos={left:xp,top:yp};if(this.penUpInnerFunc!=null){this.penUpInnerFunc(this,epos);}if(this.penUpFunc!=null){try{this.penUpFunc(this,epos);}catch(e){alert("penup handler error:"+e);}}},performSignPadUp:function(xp,yp){var epos={left:xp,top:yp};if(this.signpadUpInnerFunc!=null){this.signpadUpInnerFunc(this,epos);}if(this.signpadUpFunc!=null){try{this.signpadUpFunc(this,epos);}catch(e){alert("signpad up handler error:"+e);}}},clearInkOfCurrentLayer:function(){this.clearupTracers();this.currentLayer.Drawing.clearDrawItems();this.drawingBuffer.clearDrawItems();this.clearScreen();return true;},undoInkOfCurrentLayer:function(){var _242=this.currentLayer.Drawing;var num=_242.countDrawItems();if(num==0){return false;}this.clearupTracers();_242.deleteDrawItem(num-1);this.redrawCurrentLayerByInk();return true;},redoInkOfCurrentLayer:function(){var _243=this.currentLayer.Drawing;var num=_243.countDrawItems();var bnum=this.drawingBuffer.countDrawItems();if(num>=bnum){return false;}this.clearupTracers();_243.addDrawItem(this.drawingBuffer.getDrawItem(num));this.redrawCurrentLayerByInk();return true;},clearupTracers:function(){this.traceInterval();this.traceTimeout();this.clearTracers();},countDrawItems:function(){var _244=this.currentLayer.Drawing;return _244.countDrawItems();},countDrawItemCells:function(){var _245=this.currentLayer.Drawing;return _245.countCells();},countDrawItemFeatureCells:function(mode){var _246=this.currentLayer.Drawing;return _246.countFeatureCells(mode);},clearScreen:function(){var bctx=this.bcanvas.getContext("2d");bctx.clearRect(0,0,this.bcanvas.width,this.bcanvas.height);if(this.isDrawing!==true){this.arrayCell.length=0;this.arrayCopy.length=0;}this.clearDrawingCanvas();},redrawCurrentLayerByInk:function(){var _247=InkTool.InkLib;var _248=this.currentLayer;if(_248==null){return false;}this.clearScreen();var _249,ctx;_249=this.bcanvas;ctx=_249.getContext("2d");var _24a=this.drawingContext.cloneWithContext(ctx);var _24b=_248.Drawing;return this.drawInkTo(_24a,_24b);},drawInkTo:function(_24c,_24d){var _24e=InkTool.InkLib;var _24f=InkTool.InkCanvasLib;var _250=InkTool.InkLib.needsEmulateCanvas();var num=_24d.countDrawItems();for(var _251=0;_251<num;_251++){var _252=_24d.getDrawItem(_251);var _253=_252.getStationery();if(_253.hasFullDrawMode()&&this.useFullDraw){_253.fullDrawStart(_24c);}else{_253.drawStart(_24c);}var cnum=_252.countCells();for(var _254=0;_254<cnum;_254++){var _255=_252.getCell(_254);if(_253.hasFullDrawMode()&&this.useFullDraw){_253.fullStrokeDispatch(_24c,_255);}else{_253.strokeDispatch(_24c,_255,0);}}if(_253.hasFullDrawMode()&&this.useFullDraw){_253.fullDrawEnd(_24c);}else{_253.drawEnd(_24c);}}return true;},clearDrawingCanvas:function(){var ctx=this.dcanvas.getContext("2d");ctx.clearRect(0,0,this.dcanvas.width,this.dcanvas.height);if(InkTool.InkLib.needsEmulateCanvas()){ctx.strokeStyle="rgba(255,255,255,0.01)";ctx.fillStyle="rgba(255,255,255,0.01)";ctx.globalCompositeOperation="source-over";ctx.fillRect(0,0,this.dcanvas.width,this.dcanvas.height);}},drawRecogInkTo:function(ctx,_256,_257,_258,_259){var _25a=this.drawingContext;var _25b=new InkTool.DrawingContext(ctx,_25a.getOffsetX()-_256,_25a.getOffsetY()-_257,_25a.getZoomRatio());_25b.setFeatureDetectingParams(_25a.getFeatureDetectingBendDist(),_25a.getFeatureDetectingStraightDist(),_25a.getFeatureDetectingTimeDist(),_25a.getFeatureDetectingSharpDist());var _25c=InkTool.InkLib;var _25d=InkTool.InkCanvasLib;var num=_259.strokes.length;for(var _25e=0;_25e<num;_25e++){var _25f=_259.strokes[_25e];var _260=_25f.stat.tp;var _261=this.createStationeryByType(_260);_261.setPenColor(new InkTool.InkColor(_25f.stat.col));_261.setPenWidth(_25f.stat.w);_261.setPenMinWidth(_25f.stat.minw);_261.setPenMaxWidth(_25f.stat.maxw);var _262=new InkTool.InkStroke(_261);var _263=_25f.time;var _264=_25f.stat.w;var cnum=_25f.cells.length;for(var _265=0;_265<cnum;_265++){var _266=_25f.cells[_265];var mode=(_265==0)?0:1;var xp=_266.x*_258;var yp=_266.y*_258;var wd=_264;var pr=0;var tm=_263+_266.t;var _267=new InkTool.InkCell(mode,xp,yp,wd,pr,tm);_262.addCell(_267);if(_265==_25f.cells.length-1&&mode!=2){var _268=new InkTool.InkCell(2,xp,yp,wd,pr,tm);_262.addCell(_268);}}for(var _265=0;_265<_262.countCells();_265++){var _267=_262.getCell(_265);_261.strokeDispatch(_25b,_267,2);}if(_261.hasFullDrawMode()&&this.useFullDraw){_261.fullDrawStart(_25b);}else{_261.drawStart(_25b);}for(var _265=0;_265<_262.countCells();_265++){var _266=_262.getCell(_265);if(_261.hasFullDrawMode()&&this.useFullDraw){_261.fullStrokeDispatch(_25b,_266);}else{_261.strokeDispatch(_25b,_266,0);}}if(_261.hasFullDrawMode()&&this.useFullDraw){_261.fullDrawEnd(_25b);}else{_261.drawEnd(_25b);}}return true;},clearTracers:function(){for(var _269 in this.traceList){packet=this.traceList[_269];delete this.traceList[_269];}},traceInterval:function(){var _26a=InkTool.InkLib;var _26b=InkTool.InkCanvasLib;for(var idx=0;idx<_26b.TouchTraceList.length;idx++){var _26c=_26b.TouchTraceList[idx];this.doTraceInterval(_26c.List[this.id]);}for(var idx=0;idx<_26b.PointerTraceList.length;idx++){var _26c=_26b.PointerTraceList[idx];this.doTraceInterval(_26c.List[this.id]);}this.doTraceInterval(_26b.PenTrace.List[this.id]);},doTraceInterval:function(_26d){var _26e=InkTool.InkLib;var _26f=InkTool.InkCanvasLib;if(_26d==null||_26d.pen==null||_26d.arrayCell.length==0){return false;}var _270,ctx;if(_26d.pen.hasFullDrawMode()===false||this.useFullDraw==false){_270=this.bcanvas;ctx=_270.getContext("2d");}else{_270=this.dcanvas;ctx=this.dcontext;}var _271=_26d.drawingContext;_271.context=ctx;_26d.pen.drawStart(_271);var _272=0;while(_272<16&&_26d.arrayCell.length>0){var cell=_26d.arrayCell.shift();_272++;if(_26d.pen.hasFullDrawMode()&&this.useFullDraw){_26d.arrayCopy.push(cell);}_26d.pen.strokeDispatch(_271,cell,1);}_26d.pen.drawEnd(_271);return true;},traceTimeout:function(){var _273=InkTool.InkLib;var _274=InkTool.InkCanvasLib;var _275=this.dcanvas;var _276=this.bcanvas;var bctx=_276.getContext("2d");var _277=false;for(var idx=0;idx<_274.TouchTraceList.length;idx++){var _278=_274.TouchTraceList[idx];if(this.doTraceTimeout(_278.List[this.id])==true){_277=true;}}for(var idx=0;idx<_274.PointerTraceList.length;idx++){var _278=_274.PointerTraceList[idx];if(this.doTraceTimeout(_278.List[this.id])==true){_277=true;}}if(this.doTraceTimeout(_274.PenTrace.List[this.id])==true){_277=true;}if(_277==true){this.clearDrawingCanvas();}},doTraceTimeout:function(_279){if(_279==null){return false;}var _27a=0;for(var _27b=0;_27b<_279.arrayCopy.length;_27b++){var stat=_279.arrayCopy[_27b].getMode();if(stat==2){_27a=_27b+1;}}if(_27a>0){var _27c=this.bcanvas;var bctx=_27c.getContext("2d");var _27d=this.drawingContext;var _27e=_27d.cloneWithContext(bctx);_27e.lastData=[];_279.pen.fullDrawStart(_27e);for(var _27b=0;_27b<_27a;_27b++){var cell=_279.arrayCopy.shift();_279.pen.fullStrokeDispatch(_27e,cell);}_279.pen.fullDrawEnd(_27e);return true;}else{return false;}},tracePausing:function(){var _27f=InkTool.InkLib;var _280=InkTool.InkCanvasLib;if(this.featureDetectingBendDist==0){return;}var crnt=Date.now();for(var idx=0;idx<_280.TouchTraceList.length;idx++){var _281=_280.TouchTraceList[idx];if(_281.crntMode>=0){this.doTracePausing(_281.List[this.id],crnt,0,null);}}for(var idx=0;idx<_280.PointerTraceList.length;idx++){var _281=_280.PointerTraceList[idx];if(_281.crntMode>=0){this.doTracePausing(_281.List[this.id],crnt,0,null);}}this.doTracePausing(_280.PenTrace.List[this.id],crnt,0,null);},doTracePausing:function(_282,crnt,mode,_283){var _284=InkTool.InkLib;var _285=InkTool.InkCanvasLib;if(_282.pen==null||_282.currentStroke==null){return false;}var _286=_282.currentStroke.countCells();if(_286==0){return false;}var cell=_282.currentStroke.getCell(_286-1);var xp,yp,wd,tm,stat;if(mode==0){xp=cell.getX();yp=cell.getY();wd=cell.getWidth();tm=cell.getTime();stat=cell.getMode();}else{var epos=this.convertPositionDocumentToCanvas(_283.lastPos,this,this.drawingContext);xp=epos.left;yp=epos.top;wd=cell.getWidth();tm=crnt;stat=0;}if(stat==2){return false;}if(mode==0){if(crnt-tm<this.featureDetectingTimeDist){return false;}var _287=0;for(var idx=_286-1;idx>=0;idx--){var _288=_282.currentStroke.getCell(idx);var _289=_288.getMode();var oxp=_288.getX();var oyp=_288.getY();if(stat==0||stat==1||oxp!=xp||oyp!=yp){break;}_287++;}if(_287>2){return false;}}var _28a=new InkTool.InkCell(3,xp,yp,wd,0,crnt);if(_28a!=null){_282.currentStroke.addCell(_28a);if(_282.pen.hasFullDrawMode()==true&&this.useFullDraw){if(this.useEmulatingTimer==true){_282.arrayCell.push(_28a);}else{_282.pen.strokeDispatch(_282.drawingContext,_28a,1);_282.pen.drawEnd(_282.drawingContext);_282.arrayCopy.push(_28a);}}else{_282.pen.strokeDispatch(_282.drawingContext,_28a,1);}return true;}else{return false;}},benchMarkCircles:function(ccol,_28b,_28c,_28d){},dummy:function(){}});}InkTool.InkLib.Class.extend(InkTool.InkCanvasBase,(function(){var iobj={saveInkObjectShort:function(mode){var _28e=new Object();if(this.viewMode!=0){_28e.w=this.rect.getWidth();_28e.h=this.rect.getHeight();}else{_28e.w=this.inkWidth;_28e.h=this.inkHeight;}_28e.v=this.Version;_28e.is=new Array();savesrc=this.currentDrawing.clone();for(var _28f=0;_28f<savesrc.is.length;_28f++){var sobj=new Object();var ssrc=savesrc.is[_28f];var _290=0;var col={"A":ssrc.st.col.A,"R":ssrc.st.col.R,"G":ssrc.st.col.G,"B":ssrc.st.col.B};sobj.st={"col":col,"maxw":ssrc.st.maxw,"minw":ssrc.st.minw,"tp":ssrc.st.tp,"w":ssrc.st.w};var _291=ssrc.st.isPressureSensitive();sobj.cs=new Array();for(var _292=0;_292<ssrc.cs.length;_292++){var csrc=ssrc.cs[_292];if(mode!=null&&mode!=0){if(csrc.m==-1){continue;}}else{if(csrc.m==2){continue;}}if(_292==0){_290=csrc.t;}var cstr;var crnt=csrc.t;if(mode==0&&_292==ssrc.cs.length-2&&ssrc.cs[_292+1].m==2){crnt=ssrc.cs[_292+1].t;}if(_291){cstr=csrc.x+"|"+csrc.y+"|"+csrc.w+"|"+csrc.p+"|"+(crnt-_290);}else{cstr=csrc.x+"|"+csrc.y+"|"+(crnt-_290);}if(mode!=null&&mode!=0){cstr+=":"+csrc.m;}sobj.cs.push(cstr);}sobj.t=_290;_28e.is.push(sobj);}if(mode==0&&this.featureDetectingBendDist>0){_28e.fdp={"bd":this.featureDetectingBendDist,"st":this.featureDetectingStraightDist,"tm":this.featureDetectingTimeDist,"sp":this.featureDetectingSharpDist};}if(this.currentPosition!=null||this.currentPositionCode!=0){var _293=InkTool.InkGeolocationLib;if(_293!=null){var _294=_293.positionInnerToInk(this.currentPosition,this.currentPositionCode,this.currentPositionMessage);if(_294!=null){_28e.glc=_294;}}}if(this.currentDate!=null){_28e.tm=this.currentDate.getTime();}return _28e;},saveInkObject:function(){if(this.featureDetectingBendDist==0){return this.saveInkObjectShort(0);}else{return this.saveInkObjectShort(1);}},saveInkObjectLegacy:function(){return this.saveInkObjectShort(0);},saveInkObjectWithFeature:function(){return this.saveInkObjectShort(1);},saveInk:function(){var _295=this.saveInkObject();var _296=JSON.stringify(_295);return _296;},saveInkLegacy:function(){var _297=this.saveInkObjectLegacy();var _298=JSON.stringify(_297);return _298;},saveInkWithFeature:function(){var _299=this.saveInkObjectWithFeature();var _29a=JSON.stringify(_299);return _29a;},saveInkObjectLong:function(){var _29b=this.currentDrawing.clone();if(this.viewMode!=0){_29b.w=this.rect.getWidth();_29b.h=this.rect.getHeight();}else{_29b.w=this.inkWidth;_29b.h=this.inkHeight;}_29b.v=this.Version;return _29b;},saveInkLong:function(){var _29c=this.saveInkObjectLong();var _29d=JSON.stringify(_29c);return _29d;},saveInkShort:function(){var _29e=this.saveInkObjectShort(1);var _29f=JSON.stringify(_29e);return _29f;},savePublicInk:function(){var _2a0=this.savePublicInkObject();var _2a1=JSON.stringify(_2a0);return _2a1;},savePublicInkObject:function(){var _2a2=new Object();if(this.viewMode!=0){_2a2.width=this.rect.getWidth();_2a2.height=this.rect.getHeight();}else{_2a2.width=this.inkWidth;_2a2.height=this.inkHeight;}_2a2.ver=InkTool.InkCanvasLib.PublicInkVersion;_2a2.strokes=new Array();savesrc=this.currentDrawing.clone();for(var _2a3=0;_2a3<savesrc.is.length;_2a3++){var sobj=new Object();var ssrc=savesrc.is[_2a3];var _2a4=0;if(ssrc.cs.length>0){_2a4=ssrc.cs[0].t;}sobj.time=_2a4;sobj.cells=new Array();for(var _2a5=0;_2a5<ssrc.cs.length;_2a5++){var csrc=ssrc.cs[_2a5];if(csrc.m==2){continue;}var crnt=csrc.t;if(_2a5==ssrc.cs.length-2&&ssrc.cs[_2a5+1].m==2){crnt=ssrc.cs[_2a5+1].t;}var cobj=new Object();cobj.x=csrc.x;cobj.y=csrc.y;cobj.t=(crnt-_2a4);sobj.cells.push(cobj);}_2a2.strokes.push(sobj);}return _2a2;},saveDebugCsv:function(){var resp="";return resp;},saveImage:function(){if(typeof (this.bcanvas.toDataURL)=="function"){var _2a6=[];for(var _2a7=0;_2a7<arguments.length;_2a7++){_2a6[_2a7]=arguments[_2a7];}return this.saveImageSub(96,null,_2a6);}else{return null;}},saveImageWithBGColor:function(){if(typeof (this.bcanvas.toDataURL)=="function"){var dpi=96;var _2a8=arguments[0];var _2a9=[];for(var _2aa=1;_2aa<arguments.length;_2aa++){_2a9[_2aa-1]=arguments[_2aa];}return this.saveImageSub(dpi,_2a8,_2a9);}else{return null;}},saveImageDPI:function(){if(typeof (this.bcanvas.toDataURL)=="function"){var dpi=arguments[0];var _2ab=[];for(var _2ac=1;_2ac<arguments.length;_2ac++){_2ab[_2ac-1]=arguments[_2ac];}return this.saveImageSub(dpi,null,_2ab);}else{return null;}},saveImageDPIWithBGColor:function(){if(typeof (this.bcanvas.toDataURL)=="function"){var dpi=arguments[0];var _2ad=arguments[1];var _2ae=[];for(var _2af=2;_2af<arguments.length;_2af++){_2ae[_2af-2]=arguments[_2af];}return this.saveImageSub(dpi,_2ad,_2ae);}else{return null;}},saveImageText:function(){var str=this.saveImageDPIWithBGColor.apply(this,arguments);var idx=str.indexOf(",");if(idx>=0){str=str.substring(idx+1);}return str;},saveImageSub:function(dpi,_2b0,_2b1){try{var _2b2=96;var _2b3,_2b4;if(this.viewMode!=0){_2b3=Math.round(this.rect.getWidth()*dpi/_2b2);_2b4=Math.round(this.rect.getHeight()*dpi/_2b2);}else{_2b3=Math.round(this.inkWidth*dpi/_2b2);_2b4=Math.round(this.inkHeight*dpi/_2b2);}var _2b5=InkTool.InkCanvasLib.createDummyCanvas(_2b3,_2b4);var _2b6=dpi/_2b2;var ctx=_2b5.getContext("2d");ctx.clearRect(0,0,_2b3,_2b4);var _2b7=this.currentLayer;if(_2b7!=null){var _2b8=new InkTool.DrawingContext(ctx,0,0,_2b6);_2b8.setFeatureDetectingParams(this.featureDetectingBendDist,this.featureDetectingStraightDist,this.featureDetectingTimeDist,this.featureDetectingSharpDist);var _2b9=_2b7.Drawing;this.drawInkTo(_2b8,_2b9);}var resp;if(_2b0==null){resp=_2b5.toDataURL.apply(_2b5,_2b1);}else{var _2ba=document.createElement("canvas");_2ba.width=_2b3;_2ba.height=_2b4;var _2bb=_2ba.getContext("2d");var _2bc=new InkTool.InkColor(_2b0);_2bb.fillStyle=_2bc.getRGBA();_2bb.fillRect(0,0,_2b3,_2b4);_2bb.drawImage(_2b5,0,0);resp=_2ba.toDataURL.apply(_2ba,_2b1);}InkTool.InkCanvasLib.releaseDummyCanvas();return resp;}catch(e){alert("saveImageSub error:"+e);return null;}},replayInk:function(_2bd,_2be,_2bf,_2c0){if(this.replayMode!=0){return false;}var _2c1=this.currentDrawing;var _2c2=_2c1.countDrawItems();if(_2c2==0){if(_2bf!=null){_2bf(this,0);}return false;}var _2c3=_2c1.getDrawItem(0);if(_2c3==null){if(_2bf!=null){_2bf(this,0);}return false;}var _2c4;var _2c5=_2c3.getCell(0);if(_2c5==null){_2c4=_2c3.getTime();if(_2c4==null){if(_2bf!=null){_2bf(this,0);}return false;}}else{_2c4=_2c5.getTime();}this.replayMode=1;this.replaySpeed=_2bd;this.replayMaxInterval=_2be;this.replayStrokeIndex=0;this.replayCellIndex=0;this.replayPackets=[];this.setupCanPenMove();this.replayStartTime=Date.now();this.replayTargetBaseTime=_2c4;this.replayLastTime=0;this.replayHandler=_2bf;this.replaySpecialHandler=_2c0;var _2c6=this.drawingContext;var _2c7=this;this.clearScreen();var _2c8=this.useFullDraw;this.replayTimer=setInterval(function(){var _2c9=Date.now();var _2ca=_2c7.replayTargetBaseTime+Math.round((_2c9-_2c7.replayStartTime)*_2c7.replaySpeed);for(var idx=_2c7.replayStrokeIndex;idx<_2c2;idx++){var _2cb=_2c1.getDrawItem(idx);var cpen=_2cb.getStationery();var _2cc=_2cb.getCell(0);var _2cd=(_2cc!=null)?_2cc.getTime():_2cb.getTime();if(_2cd==null){continue;}else{if(_2cd>_2ca){break;}}if(_2cc==null){if(_2c7.replaySpecialHandler!=null){_2c7.replaySpecialHandler(this,_2cb);}_2c7.replayStrokeIndex++;continue;}var _2ce,ctx;if(cpen.hasFullDrawMode()===false||_2c8==false){_2ce=_2c7.bcanvas;ctx=_2ce.getContext("2d");}else{_2ce=_2c7.dcanvas;ctx=_2c7.dcontext;}var _2cf=_2c6.cloneWithContext(ctx);var _2d0={"stroke":_2cb,"pen":cpen,"index":0,"finished":false,"drctx":_2cf};_2c7.replayPackets.push(_2d0);_2c7.replayStrokeIndex++;}for(var pct=0;pct<_2c7.replayPackets.length;pct++){var _2d0=_2c7.replayPackets[pct];_2d0.pen.drawStart(_2d0.drctx);}var _2d1=false;while(true){var _2d2=0;for(var pct=0;pct<_2c7.replayPackets.length;pct++){var _2d0=_2c7.replayPackets[pct];if(_2d0.finished==true){continue;}var _2d3=_2d0.pen;var _2d4=_2d0.stroke.getCell(_2d0.index);var _2d5=_2d0.stroke.countCells();var _2d6=_2d4.getTime();if(_2d6>_2ca){continue;}_2d3.strokeDispatch(_2d0.drctx,_2d4,0);_2d2++;_2d0.index++;_2c7.replayLastTime=_2c9;if(_2d0.index>=_2d5){_2d0.finished=true;_2d3.drawEnd(_2d0.drctx);}}if(_2d2==0){break;}}var _2d7=true;for(var pct=0;pct<_2c7.replayPackets.length;pct++){var _2d0=_2c7.replayPackets[pct];if(_2d0.finished==false){_2d0.pen.drawEnd(_2d0.drctx);_2d7=false;}}if(_2d7==true){for(var pct=0;pct<_2c7.replayPackets.length;pct++){var _2d0=_2c7.replayPackets[pct];var _2d3=_2d0.pen;var _2d5=_2d0.stroke.countCells();if(_2d3.hasFullDrawMode()&&_2c8==true){var _2d8=_2c7.bcanvas;var bctx=_2d8.getContext("2d");var _2d9=_2c6.cloneWithContext(bctx);_2d3.fullDrawStart(_2d9);for(var _2da=0;_2da<_2d5;_2da++){var _2db=_2d0.stroke.getCell(_2da);_2d3.fullStrokeDispatch(_2d9,_2db);}_2d3.fullDrawEnd(_2d9);}}_2c7.clearDrawingCanvas();_2c7.replayPackets=[];if(_2c7.replayStrokeIndex>=_2c2){if(_2c7.replayTimer!=null){clearInterval(_2c7.replayTimer);_2c7.replayTimer=null;}_2c7.replayMode=0;_2c7.setupCanPenMove();if(_2c7.replayHandler!=null){_2c7.replayHandler(_2c7,0);}}else{var _2dc=_2c1.getDrawItem(_2c7.replayStrokeIndex);var _2dd=_2dc.getCell(0);var _2d6=(_2dd!=null)?_2dd.getTime():_2dc.getTime();if(_2d6==null){_2d6=_2ca;}if(_2c9>=_2c7.replayLastTime+_2c7.replayMaxInterval){_2c7.replayTargetBaseTime+=(_2d6-_2ca);}}}},60);return true;},replayInkOld:function(_2de,_2df,_2e0){if(this.replayMode!=0){return false;}var _2e1=this.currentDrawing;var _2e2=_2e1.countDrawItems();if(_2e2==0){if(_2e0!=null){_2e0(this,0);}return false;}var _2e3=_2e1.getDrawItem(0);if(_2e3==null||_2e3.countCells()==0){if(_2e0!=null){_2e0(this,0);}return false;}var _2e4=_2e3.getCell(0);if(_2e4==null){if(_2e0!=null){_2e0(this,0);}return false;}this.replayMode=1;this.replaySpeed=_2de;this.replayMaxInterval=_2df;this.replayStrokeIndex=0;this.replayCellIndex=0;this.replayPackets=[];this.setupCanPenMove();this.replayStartTime=Date.now();this.replayTargetBaseTime=_2e4.getTime();this.replayLastTime=0;this.replayHandler=_2e0;var _2e5=this.drawingContext;var _2e6=_2e5.clone();var _2e7=this;this.clearScreen();var _2e8=this.useFullDraw;this.replayTimer=setInterval(function(){var _2e9=Date.now();var _2ea=_2e7.replayTargetBaseTime+Math.round((_2e9-_2e7.replayStartTime)*_2e7.replaySpeed);var _2eb=_2e1.getDrawItem(_2e7.replayStrokeIndex);var _2ec=_2eb.getStationery();var _2ed,ctx;if(_2ec.hasFullDrawMode()===false||_2e8==false){_2ed=_2e7.bcanvas;ctx=_2ed.getContext("2d");}else{_2ed=_2e7.dcanvas;ctx=_2e7.dcontext;}_2e6.context=ctx;_2ec.drawStart(_2e6);var _2ee=false;while(true){var _2ef=_2eb.getCell(_2e7.replayCellIndex);var _2f0=_2eb.countCells();var _2f1=_2ef.getTime();if(_2f1>_2ea){if(_2e9>=_2e7.replayLastTime+_2e7.replayMaxInterval){_2e7.replayTargetBaseTime+=(_2f1-_2ea);}else{break;}}_2e7.replayLastTime=_2e9;var xp=_2ef.getX();var yp=_2ef.getY();var wd=_2ef.getWidth();var tm=_2ef.getTime();if(_2e7.replayCellIndex==0){_2ec.strokeStart(_2e6,xp,yp,wd,tm);}else{if(_2e7.replayCellIndex<_2f0-1){_2ec.strokeMove(_2e6,xp,yp,wd,tm);}else{_2ec.strokeEnd(_2e6,xp,yp,wd,tm);}}_2e7.replayCellIndex++;if(_2e7.replayCellIndex>=_2f0){_2ec.drawEnd(_2e6);if(_2ec.hasFullDrawMode()&&_2e8){var _2f2=_2e7.bcanvas;var bctx=_2f2.getContext("2d");var _2f3=_2e5.cloneWithContext(bctx);_2ec.fullDrawStart(_2f3);for(var _2f4=0;_2f4<_2f0;_2f4++){var _2f5=_2eb.getCell(_2f4);var xp=_2f5.getX();var yp=_2f5.getY();var wd=_2f5.getWidth();var tm=_2f5.getTime();if(_2f4==0){_2ec.fullStrokeStart(_2f3,xp,yp,wd,tm);}else{if(_2f4<_2f0-1){_2ec.fullStrokeMove(_2f3,xp,yp,wd,tm);}else{_2ec.fullStrokeEnd(_2f3,xp,yp,wd,tm);}}}_2ec.fullDrawEnd(_2f3);_2e7.clearDrawingCanvas();}_2e7.replayStrokeIndex++;_2e7.replayCellIndex=0;if(_2e7.replayStrokeIndex>=_2e2){_2ee=true;break;}_2eb=_2e1.getDrawItem(_2e7.replayStrokeIndex);_2ec=_2eb.getStationery();if(_2ec.hasFullDrawMode()===false||_2e8==false){_2ed=_2e7.bcanvas;ctx=_2ed.getContext("2d");}else{_2ed=_2e7.dcanvas;ctx=_2e7.dcontext;}_2e6.context=ctx;_2ec.drawStart(_2e6);}}if(_2ee){if(_2e7.replayTimer!=null){clearInterval(_2e7.replayTimer);_2e7.replayTimer=null;}_2e7.replayMode=0;_2e7.setupCanPenMove();if(_2e7.replayHandler!=null){_2e7.replayHandler(_2e7,0);}}else{_2ec.drawEnd(_2e6);}},60);return true;},stopReplay:function(){if(this.replayMode==0){return;}if(this.replayTimer!=null){clearInterval(this.replayTimer);this.replayTimer=null;}this.replayMode=0;this.setupCanPenMove();if(this.replayHandler!=null){this.replayHandler(this,1);}this.redrawCurrentLayerByInk();},changeReplay:function(_2f6,_2f7){this.replaySpeed=_2f6;this.replayMaxInterval=_2f7;},isReplaying:function(){return (this.replayMode!=0);},getReplayCurrentStroke:function(){if(this.replayMode==0){return -1;}else{return this.replayStrokeIndex;}},getReplayMaxStroke:function(){return this.getNumStrokes();},dummy:function(){}};var resp={};if(InkTool.InkFlags.InkTool===true||InkTool.InkFlags.InkPDF===true){resp.saveInkObjectShort=iobj.saveInkObjectShort;}if(InkTool.InkFlags.InkTool===true){resp.saveInkObject=iobj.saveInkObject;resp.saveInkObjectLegacy=iobj.saveInkObjectLegacy;resp.saveInkObjectWithFeature=iobj.saveInkObjectWithFeature;resp.saveInk=iobj.saveInk;resp.saveInkLegacy=iobj.saveInkLegacy;resp.saveInkWithFeature=iobj.saveInkWithFeature;resp.saveInkObjectLong=iobj.saveInkObjectLong;resp.saveInkLong=iobj.saveInkLong;resp.saveInkShort=iobj.saveInkShort;resp.savePublicInk=iobj.savePublicInk;resp.savePublicInkObject=iobj.savePublicInkObject;resp.saveDebugCsv=iobj.saveDebugCsv;resp.saveImage=iobj.saveImage;resp.saveImageWithBGColor=iobj.saveImageWithBGColor;resp.saveImageDPI=iobj.saveImageDPI;resp.saveImageDPIWithBGColor=iobj.saveImageDPIWithBGColor;resp.saveImageText=iobj.saveImageText;resp.saveImageSub=iobj.saveImageSub;resp.replayInk=iobj.replayInk;resp.replayInkOld=iobj.replayInkOld;resp.stopReplay=iobj.stopReplay;resp.changeReplay=iobj.changeReplay;resp.isReplaying=iobj.isReplaying;resp.getReplayCurrentStroke=iobj.getReplayCurrentStroke;resp.getReplayMaxStroke=iobj.getReplayMaxStroke;}return resp;})());InkTool.InkCanvasLib.registerCanvasClass("standard",InkTool.InkCanvasBase);if(typeof InkTool.KumonData==="undefined"){InkTool.KumonData=InkTool.InkLib.Class.create(null,{initialize:function(_1){this.tx=_1.tx;this.sd=_1.sd;this.qu=_1.qu;this.ar=_1.ar;this.tr=_1.tr;this.si=_1.si;this.txtRect=_1.txtRect;}});}if(typeof InkTool.InkText==="undefined"){InkTool.InkText=InkTool.InkLib.Class.create(InkTool.InkStationery,{initialize:function(){this.tp=InkTool.InkPenType.Old_KesText;this.col=new InkTool.InkColor("black");this.w=1;this.minw=1;this.maxw=1;},getInfo:function(){return "type="+this.tp+":color="+this.col.getRGBA()+":width="+this.w+"("+this.minw+"-"+this.maxw+")"+"("+"tx="+this.tx+":qu="+this.qu+":ar="+this.ar+":tr="+this.tr+")";},hasFullDrawMode:function(){return false;}});}if(typeof InkTool.InkSound==="undefined"){InkTool.InkSound=InkTool.InkLib.Class.create(InkTool.InkStationery,{initialize:function(){this.tp=InkTool.InkPenType.Old_KesSound;this.col=new InkTool.InkColor("black");this.w=1;this.minw=1;this.maxw=1;},getInfo:function(){return "type="+this.tp+":color="+this.col.getRGBA()+":width="+this.w+"("+this.minw+"-"+this.maxw+")"+"("+"sd="+this.tx+":qu="+this.qu+":si="+this.si+")";},});}if(typeof InkTool.InkTextDiv==="undefined"){InkTool.InkTextDiv=InkTool.InkLib.Class.create(InkTool.InkStationery,{initialize:function(_2,_3,_4){this.div=_2;this.qu=_3;this.ar=_4;},});}if(typeof InkTool.InkCanvasKumon==="undefined"){InkTool.InkCanvasKumon=InkTool.InkLib.Class.create(InkTool.InkCanvasBase,{initialize:function(){InkTool.InkCanvasBase.prototype.initialize.apply(this,arguments);this.studyMode=true;this.retryNumber=0;this.isTextInk=false;},relayout:function(){InkTool.InkCanvasBase.prototype.relayout.apply(this,arguments);},display:function(_5){InkTool.InkCanvasBase.prototype.display.apply(this,arguments);},getStudyMode:function(){return this.studyMode;},setStudyMode:function(_6){this.studyMode=_6;},getRetryNumber:function(){return this.retryNumber;},setRetryNumber:function(no){var _7=InkTool.InkLib;var _8=_7.parseNumber(no);if(_7.isNaN(_8)){return false;}this.retryNumber=_8;return true;},clearInk:function(){InkTool.InkCanvasBase.prototype.clearInk.apply(this,arguments);this.isTextInk=false;},addSoundData:function(_9,_a,_b,_c){var _d=InkTool.InkLib;var _e=_d.parseNumber(_9);var _f=_d.parseNumber(_a);var stm=_d.parseNumber(_b);var ptm=_d.parseNumber(_c);if(_d.isNaN(_e)||_d.isNaN(_f)||_d.isNaN(stm)||_d.isNaN(ptm)){return false;}var _10=new InkTool.InkSound();var _11=new InkTool.InkStroke(_10);_11.t=stm;_11.kmn={"qu":_e,"ar":-1,"sd":ptm,"si":_f};this.clearupTracers();this.currentLayer.Drawing.addDrawItem(_11);this.drawingBuffer.addDrawItem(_11);return true;},addTextData:function(_12,_13,_14,_15,_16){var _17=InkTool.InkLib;var qno=_17.parseNumber(_12);var ano=_17.parseNumber(_13);var itm=_17.parseNumber(_15);if(_17.isNaN(qno)||_17.isNaN(ano)||_17.isNaN(itm)||_14==null||(typeof _16!=="string")){return false;}var _18={"x":_17.parseNumber(_14.x),"y":_17.parseNumber(_14.y),"width":_17.parseNumber(_14.width),"height":_17.parseNumber(_14.height)};if(_17.isNaN(_18.x)||_17.isNaN(_18.y)||_17.isNaN(_18.width)||_17.isNaN(_18.height)){return false;}var _19=new InkTool.InkText();var _1a=new InkTool.InkStroke(_19);_1a.t=itm;_1a.kmn={"qu":qno,"ar":ano,"sd":-1,"si":-1,"tx":_16,"txtRect":_18};this.clearupTracers();this.currentLayer.Drawing.addDrawItem(_1a);this.drawingBuffer.addDrawItem(_1a);return true;},saveInkObject:function(){var _1b=new Object();if(this.viewMode!=0){_1b.w=this.rect.getWidth();_1b.h=this.rect.getHeight();}else{_1b.w=this.inkWidth;_1b.h=this.inkHeight;}_1b.v="1.0";_1b.is=new Array();savesrc=this.currentDrawing.clone();for(var _1c=0;_1c<savesrc.is.length;_1c++){var _1d=new Object();var _1e=savesrc.is[_1c];var _1f=0;if(_1e.t!=null){_1f=_1e.t;}var col={"ok":true,"A":_1e.st.col.A,"R":_1e.st.col.R,"G":_1e.st.col.G,"B":_1e.st.col.B};_1d.st={"col":col,"maxw":_1e.st.maxw,"minw":_1e.st.minw,"tp":this.mapPenTypeToOld(_1e.st.tp),"w":_1e.st.w};_1d.cs=new Array();for(var _20=0;_20<_1e.cs.length;_20++){var _21=_1e.cs[_20];if(_21.m==2){continue;}if(_20==0){_1f=_21.t;}var _22;var _23=_21.t;if(_20==_1e.cs.length-2&&_1e.cs[_20+1].m==2){_23=_1e.cs[_20+1].t;}_22=_21.x+"|"+_21.y+"|"+(_23-_1f);_1d.cs.push(_22);}_1d.t=_1f;if(this.studyMode==true){if(_1e.kmn!=null){_1d.kmn=_1e.kmn;if(_1d.kmn.tr==null){_1d.kmn.tr=this.retryNumber;}}else{_1d.kmn={"qu":-1,"ar":-1,"tr":this.retryNumber};}}_1b.is.push(_1d);}return _1b;},mapPenTypeToOld:function(_24){var _25;switch(_24){case InkTool.InkPenType.PressSenseBallpointPen:case "pn01":_25=InkTool.InkPenType.Old_BallpointPen;break;case InkTool.InkPenType.PressSenseFeltPen:case "pn02":_25=InkTool.InkPenType.Old_FeltPen;break;case InkTool.InkPenType.PressSenseSignPen:case "pn06":_25=InkTool.InkPenType.Old_FeltPen;break;case InkTool.InkPenType.PressSenseSchoolPen:case "pn07":_25=InkTool.InkPenType.Old_BallpointPen;break;case InkTool.InkPenType.Old_BallpointPen:case InkTool.InkPenType.SolidPen:case "hp00":_25=InkTool.InkPenType.Old_BallpointPen;break;case InkTool.InkPenType.Old_VariableBallpointPen:case InkTool.InkPenType.SpeedSenseBallpointPen:case "hp01":_25=InkTool.InkPenType.Old_BallpointPen;break;case InkTool.InkPenType.Old_FeltPen:case InkTool.InkPenType.Old_BrushPen:case InkTool.InkPenType.SpeedSenseFeltPen:case "hp02":_25=InkTool.InkPenType.Old_FeltPen;break;case InkTool.InkPenType.Old_VariableFudePen:case InkTool.InkPenType.SpeedSenseFudePen:case "hp04":_25=InkTool.InkPenType.Old_FeltPen;break;case InkTool.InkPenType.Old_VariableSignPen:case InkTool.InkPenType.SpeedSenseSignPen:case "hp06":_25=InkTool.InkPenType.Old_FeltPen;break;case InkTool.InkPenType.SpeedSenseSchoolPen:case "hp07":_25=InkTool.InkPenType.Old_BallpointPen;break;case InkTool.InkPenType.Old_Pencil:case InkTool.InkPenType.Pencil:case "cpn1":_25=InkTool.InkPenType.Old_Pencil;break;case InkTool.InkPenType.Old_PencilEmulated:case InkTool.InkPenType.PencilEmulated:case "cpn2":_25=InkTool.InkPenType.Old_PencilEmulated;break;case InkTool.InkPenType.Old_NormalEraser:case InkTool.InkPenType.SolidEraser:case "er03":_25=InkTool.InkPenType.Old_NormalEraser;break;case InkTool.InkPenType.PressSenseNormalEraser:case "er02":_25=InkTool.InkPenType.Old_NormalEraser;break;case InkTool.InkPenType.Old_FeltPenV100:case InkTool.InkPenType.FeltPenV100:_25=InkTool.InkPenType.Old_FeltPen;break;case InkTool.InkPenType.Old_KesSound:_25=InkTool.InkPenType.Old_KesSound;break;case InkTool.InkPenType.Old_KesText:_25=InkTool.InkPenType.Old_KesText;break;default:_25=InkTool.InkPenType.Old_None;break;}return _25;},loadInkShortObject:function(_26){this.isTextInk=false;var _27=0;var _28=new InkTool.InkDrawing();for(var _29=0;_29<_26.is.length;_29++){var _2a=_26.is[_29];var _2b=_2a.st.tp;var _2c;var _2d=false;switch(_2b){case InkTool.InkPenType.Old_KesSound:_2c=new InkTool.InkSound();_2d=true;break;case InkTool.InkPenType.Old_KesText:_2c=new InkTool.InkText();if(this.isTextInk==false){this.isTextInk=true;}_2d=true;break;default:_2c=this.createStationeryByType(_2b);break;}_2c.setPenColor(new InkTool.InkColor(_2a.st.col));_2c.setPenWidth(_2a.st.w);_2c.setPenMinWidth(_2a.st.minw);_2c.setPenMaxWidth(_2a.st.maxw);var _2e=new InkTool.InkStroke(_2c);var _2f=_2a.t;var _30=_2a.st.w;if(_2d){_2e.t=_2f;}_2e.kmn=_2a.kmn;if(_2e.kmn!=null){if(_2e.st.tp==InkTool.InkPenType.Old_KesText&&_2e.kmn.tx==null){_2e.kmn.tx="";}if(_2e.kmn.tr!=null&&_2e.kmn.tr>_27){_27=_2e.kmn.tr;}}var _31=false;var _32=0;for(var _33=0;_33<_2a.cs.length;_33++){var _34=_2a.cs[_33];var _35=(_33==0)?0:1;var _36=_34.split(":");if(_36.length>=2){_35=Number(_36[1]);_34=_36[0];_31=true;}var _37=_34.split("|");var _38=_37.length;var xp,yp,wd,pr,tm;xp=Number(_37[0]);yp=Number(_37[1]);if(_38==3){wd=_30;pr=0;tm=_2f+Number(_37[2]);}else{if(_38==4){wd=Number(_37[2]);pr=0;tm=_2f+Number(_37[3]);}else{if(_38>=5){wd=Number(_37[2]);pr=Number(_37[3]);tm=_2f+Number(_37[4]);if(_36.length<2&&pr==0&&_33==_2a.cs.length-1){_35=2;}}}}if(_33==_2a.cs.length-1&&_35!=2){var ctm;if(_33==0){ctm=tm;}else{ctm=Math.round((_32+tm)/2);}var _39=new InkTool.InkCell(_35,xp,yp,wd,pr,ctm);_2e.addCell(_39);var _3a=new InkTool.InkCell(2,xp,yp,wd,pr,tm);_2e.addCell(_3a);}else{var _39=new InkTool.InkCell(_35,xp,yp,wd,pr,tm);_2e.addCell(_39);}_32=tm;}if(_31==false&&_26.fdp){var _3b=this.drawingContext.clone();_3b.setFeatureDetectingParams(_26.fdp.bd,_26.fdp.st,_26.fdp.tm,_26.fdp.sp);for(var _33=0;_33<_2e.countCells();_33++){var _39=_2e.getCell(_33);_2c.strokeDispatch(_3b,_39,2);}}_28.addDrawItem(_2e);}this.inkWidth=_26.w;this.inkHeight=_26.h;if(_26.tm){this.currentDate=new Date(_26.tm);}else{this.currentDate=null;}if(_26.glc){var _3c=InkTool.InkGeolocationLib;if(_3c!=null){this.currentPosition=_3c.positionInkToInner(_26.glc);this.currentPositionCode=_3c.positionCodeByInk(_26.glc);this.currentPositionMessage=_3c.positionMessageByInk(_26.glc);}else{this.currentPosition=null;this.currentPositionCode=0;this.currentPositionMessage=null;}}else{this.currentPosition=null;this.currentPositionCode=0;this.currentPositionMessage=null;}this.loadInkObjectSub(_28);},dummy:function(){}});}InkTool.InkCanvasLib.registerCanvasClass("standard",InkTool.InkCanvasKumon);